/* Copyright (c) 2011, Geert Bergman (geert@scrivo.nl)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 3. Neither the name of "Scrivo" nor the names of its contributors may be
 *    used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */
var SUI={control:{},dialog:{},form:{},imgDir:"",defineClass:function(a){if(a.baseClass){var b=function(){};b.prototype=a.baseClass.prototype;a.initializer.prototype=new b;a.initializer.prototype.constructor=a.initializer;a.initializer.base=a.baseClass}for(var c in a)"initializer"!=c&&"baseClass"!=c&&(a.initializer.prototype[c]=a[c]);a.initializer.initializeBase=function(a){this.base.prototype.constructor.apply(a,[].slice.call(arguments,1))};a.initializer.parentMethod=function(a,b){return this.base.prototype[b].apply(a,
[].slice.call(arguments,2))};return a.initializer},initialize:function(){if(!this._initialized){this._initialized=!0;SUI.browser.getBrowser();SUI.browser.patchNoArrayIndexOf();SUI.browser.patchSubstrIE();SUI.browser.getVieportSize();SUI.browser.addEventListener(window,"resize",function(){SUI.browser.getVieportSize()});document.addEventListener?document.addEventListener("DOMContentLoaded",function(){SUI.onStart()},!1):window.onload=function(){SUI.onStart()};var a=document.location.href,b=a.indexOf("/sui/");
this.imgDir=-1!==b?a.substr(0,b+5)+"img":"img"}},ltrim:function(a){return a.replace(/^[\s\xA0\t\r\n]+/,"")},rtrim:function(a){return a.replace(/[\s\xA0\t\r\n]+$/,"")},trim:function(a){return this.ltrim(this.rtrim(a))},onStart:function(){},_initialized:!1};SUI.i18n={ok:"OK",cancel:"Cancel",dateFormat:"d-m-y",timeFormat:"h:i",captionAlert:"System notification",captionWindow:"Dialog window",arrDaysShort:"ma,tu,we,th,fr,sa,su".split(","),arrMonths:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),weekShort:"w",time:"Time",exactMinutes:"Exact time (min).",prevMonth:"Go to previous month",nextMonth:"Go to next month",prevYear:"Go to previous year",nextYear:"Go to next year",goToday:"Select current date",captionDateTime:"Date and time selection",
captionDate:"Date selection",captionTime:"Time selection",selDateTime:"Select date and time",selDate:"Select date",selTime:"Select time",hsvHue:"Hue",hsvSaturation:"Satuarion",hsvValue:"Value",hsvCode:"Code",hsvColor:"Color",rgbRed:"Red",rgbGreen:"Green",rgbBlue:"Blue",dlgConfirm:"Are you sure?",dlgCaptConfirm:"Please confirm",dlgCaptPrompt:"Input required",dlgPrompt:"Enter value:",dlgAlert:"Duh",setLocale:function(a,b){for(var c in a)b[c]&&a[c]&&(a[c]instanceof Object?this.setLocale(a[c],b[c]):a[c]=
b[c])}};
SUI.resource={lvSortUp:"pointer_down.png",lvSortDown:"pointer_up.png",lvLoading:"wait_icon_grey_64.gif",tbMenu:"pointer_down.png",acClosed:"pointer_left.png",acDown:"pointer_down.png",tpScrollLeft:"pointer_left.png",tpScrollRight:"pointer_right.png",blHandle:"handle.png",calPrev:"pointer_left.png",calNext:"pointer_right.png",calToday:"calendar_today.png",calDate:"calendar.png",calTime:"clock.png",pmSub:"pointer_right.png",tvClosed:"pointer_right.png",tvOpen:"pointer_down.png",tvNone:"blank.png",tvLoadingAni:"loading2.gif",
tvLoadingBg:"loading2.png",tvPage:"page.png",tvFolder:"folder.png",wnClose:"close2.png",mbQuestion:"question_32.png",mbError:"error_32.png",mbAlert:"alert_32.png",mbOK:"ok_32.png",ecAnchor:"anchor.png",ecAbbr:"abbreviation.png",ecLang:"language.png",hsvSatVal:"colorsatval.png",hsvHue:"colorhue.png",hsvChSatVal:"colorcrosshair.png",hsvChHue:"huecrosshair.png",rgbBar:"colorrgb.png",rgbCh:"rgbcrosshair.png"};SUI.browser={isGecko:!1,isIE:!1,isOpera:!1,isWebKit:!1,version:null,patchNoArrayIndexOf:function(){if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;0<arguments.length&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==1/0&&d!==-(1/0)&&(d=(0<d||-1)*Math.floor(Math.abs(d))));if(d>=c)return-1;for(d=0<=d?d:Math.max(c-Math.abs(d),0);d<c;d++)if(d in b&&b[d]===a)return d;return-1}},patchSubstrIE:function(){if(SUI.browser.isIE)String.prototype.substr=
function(a,b){if(!b)b=this.length;0>a&&(a=this.length+a,0>a&&(a=0));return this.substring(a,a+b)}},getBrowser:function(){var a,b;a=navigator.userAgent;0<=a.indexOf("Opera")?this.isOpera=!0:0<=(b=a.indexOf("MSIE"))?(this.isIE=!0,this.version=parseFloat(a.substr(b+4))):0<=a.indexOf("WebKit")?this.isWebKit=!0:(this.isGecko=!0,this.version=6.1)},addEventListener:function(a,b,c){this.isIE&&9>this.version?a==window||"IFRAME"==a.tagName?a.attachEvent("on"+b,c):("input"==b&&(b="propertychange"),a["on"+b]=
c):a.addEventListener(b,c,!1)},removeEventListener:function(a,b,c){this.isIE&&9>this.version?a==window?a.detachEvent("on"+b,c):("input"==b&&(b="propertychange"),a["on"+b]=null):a.removeEventListener(b,c,!1)},noPropagation:function(a){if(!a)a=window.event;this.isIE&&9>this.version?a.cancelBubble=!0:a&&a.stopPropagation()},_id:1,newId:function(){return"scrivo-ui-"+this._id++},createElement:function(a,b){var c=document.createElement(a?a:"DIV");b&&this.setAttributes(c,b);SUI.style.addClass(c,"sui-font");
if(this.isIE)c.unselectable=!0;if(a){if("INPUT"==a||"TEXTAREA"==a)if(SUI.style.addClass(c,"select"),this.isIE)c.unselectable=!1}else SUI.style.addClass(c,"no-select"),c.style.overflow="hidden";SUI.browser.addEventListener(c,"contextmenu",function(a){SUI.browser.isIE?window.event.returnValue=!1:a.preventDefault()});c.style.position="absolute";c.style.margin="0px";c.style.padding="0px";c.style.cursor="default";c.id=this.newId();return c},currentStyle:function(a,b){if(SUI.browser.isIE)return b?a.currentStyle[b]:
a.currentStyle;var b=b?b.replace(/([A-Z])/g,"-$1").toLowerCase():null,c=a.ownerDocument.defaultView.getComputedStyle(a,null);return b?c.getPropertyValue(b):c},mergeAttributes:function(a,b){if(SUI.browser.isIE)a.mergeAttributes(b);else for(var c=0;c<b.attributes.length;c++){var d=b.attributes[c];"class"===d.name||"className"===d.name?SUI.style.addClass(a.className,b.className):a.setAttribute(d.name,b.getAttribute(d.name))}},setAttributes:function(a,b){for(var c in b)b.hasOwnProperty(c)&&("class"===
c||"className"===c?SUI.style.setClass(a,null===b[c]?"":b[c]):null===b[c]?a.removeAttribute(c):a.setAttribute(c,b[c]))},removeNode:function(a,b){if(a.removeNode)return a.removeNode(b);if(b)return a.parentNode.removeChild(a);var c=document.createRange();c.selectNodeContents(a);return a.parentNode.replaceChild(c.extractContents(),a)},viewportWidth:0,viewportHeight:0,getVieportSize:function(){SUI.browser.isIE?(this.viewportWidth=document.documentElement.clientWidth,this.viewportHeight=document.documentElement.clientHeight):
(this.viewportWidth=window.innerWidth,this.viewportHeight=window.innerHeight)},viewportScrollX:function(){return SUI.browser.isIE?document.documentElement.scrollLeft:window.scrollX},viewportScrollY:function(){return SUI.browser.isIE?document.documentElement.scrollTop:window.scrollY},getX:function(a){if(SUI.browser.isIE&&!a)a=window.event;return a.clientX+this.viewportScrollX()},getY:function(a){if(SUI.browser.isIE&&!a)a=window.event;return a.clientY+this.viewportScrollY()}};SUI.xhr={tableToObjArr:function(a){var b=[];if(a.length){header=a[0];for(var c=1;c<a.length;c++){for(var d={},e=0;e<header.length;e++)d[header[e]]=a[c][e];b.push(d)}}return b},queryString:function(a){var b=[],c;for(c in a)if(a.hasOwnProperty(c))if(a[c]instanceof Array)for(var d=0;d<a[c].length;d++)b.push(c+"[]="+encodeURIComponent(a[c][d]));else b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")},doGet:function(a,b,c){var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
b&&(a+="?"+this.queryString(b));d.onreadystatechange=function(){4==d.readyState&&c(eval("("+d.responseText+")"))};d.open("GET",a,!0);d.send(null)},doPost:function(a,b,c){var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.onreadystatechange=function(){4==d.readyState&&c(eval("("+d.responseText+")"))};d.open("POST",a,!0);d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.send(this.queryString(b))}};SUI.style={setRect:function(a,b,c,d,e){2==arguments.length?(a.style.top=b.style.top,a.style.left=b.style.left,a.style.width=b.style.width,a.style.height=b.style.height):(a.style.top=parseInt(b,10)+"px",a.style.left=parseInt(c,10)+"px",a.style.width=parseInt(d,10)+"px",a.style.height=parseInt(e,10)+"px")},setClass:function(a,b){a.className=b},addClass:function(a,b){if(a.className){if(-1==a.className.indexOf(b))a.className=SUI.trim(b+" "+a.className)}else a.className=b},removeClass:function(a,b){if(-1!=
a.className.indexOf(b)){var c=a.className.replace(RegExp(b,"g"),"");a.className=SUI.trim(c.replace(/\s\s+/g," "))}""==SUI.trim(a.className)&&a.removeAttribute("className")},textLength:function(a){var b=document.createElement("DIV");b.style.position="absolute";b.style.left="-1000px";b.style.fontSize="14px";b.style.fontFamily="Arial, sans-serif";b.innerHTML=a;document.body&&document.body.appendChild(b);a=b.clientWidth;document.body&&document.body.removeChild(b);return a},scrollbarWidth:function(){var a=
SUI.browser.createElement();a.style.left="100px";a.style.width="50px";a.style.height="50px";document.body&&document.body.appendChild(a);a.style.overflow="hidden";var b=a.clientWidth;a.style.overflow="scroll";b-=a.clientWidth;document.body&&document.body.removeChild(a);return b}};SUI.color={colToCol:function(a){return SUI.color.rgbToCol(SUI.color.colToRgb(a))},colToHsv:function(a){return SUI.color.rgbToHsv(SUI.color.colToRgb(a))},colToRgb:function(a){var b=16,c=/^#(\w{1})(\w{1})(\w{1})$/.exec(a);if(c)for(a=1;3>=a;a++)c[a]=c[a]+""+c[a];else if(c=/^#(\w{2})(\w{2})(\w{2})$/.exec(a),!c&&(b=10,c=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/.exec(a),!c))return{r:0,g:0,b:0};return{r:parseInt(c[1],b)/255,g:parseInt(c[2],b)/255,b:parseInt(c[3],b)/255}},hsvToCol:function(a){return SUI.color.rgbToCol(SUI.color.hsvToRgb(a))},
hsvToRgb:function(a){if(0==a.s)return{r:a.v,g:a.v,b:a.v};a.h/=60;var b=Math.floor(a.h),c=a.h-b,d=a.v*(1-a.s*c),e=a.v*(1-a.s),c=a.v*(1-a.s*(1-c));switch(b){case 1:return{r:d,g:a.v,b:e};case 2:return{r:e,g:a.v,b:c};case 3:return{r:e,g:d,b:a.v};case 4:return{r:c,g:e,b:a.v};case 5:return{r:a.v,g:e,b:d};default:return{r:a.v,g:c,b:e}}},rgbToCol:function(a){return"#"+(16777216+65536*(255*a.r|0)+256*(255*a.g|0)+(255*a.b|0)).toString(16).substr(1)},rgbToHsv:function(a){var b=(a.r>a.g?a.r:a.g)>a.b?a.r>a.g?
a.r:a.g:a.b,c={h:0,s:0,v:0},d=b-((a.r<a.g?a.r:a.g)<a.b?a.r<a.g?a.r:a.g:a.b);c.v=b;if(!d||0==c.v)return c.h=360,c;c.s=d/c.v;c.h=a.r==b?(a.g-a.b)/d:a.g==b?2+(a.b-a.r)/d:4+(a.r-a.g)/d;c.h*=60;0>c.h&&(c.h+=360);return c}};SUI.date={format:function(a,b){var c=b;if("date"===b||void 0===b)c=SUI.i18n.dateFormat;else if("datetime"===b)c=SUI.i18n.dateFormat+" "+SUI.i18n.timeFormat;else if("time"===b)c=SUI.i18n.timeFormat;for(var d="",e=0;e<c.length;e++)switch(c.charAt(e)){case "d":d+=SUI.date.padZero(a.getDate());break;case "m":d+=SUI.date.padZero(a.getMonth()+1);break;case "y":d+=SUI.date.padZero(a.getFullYear(),4);break;case "h":d+=SUI.date.padZero(a.getHours());break;case "i":d+=SUI.date.padZero(a.getMinutes());break;
case "s":d+=SUI.date.padZero(a.getSeconds());break;default:d+=c.charAt(e)}return d},padZero:function(a,b){return isNaN(a)?"":("0000"+a).substr(-(b||2))},parseSqlDate:function(a){return!a||10>a.length?null:new Date(parseInt(a.substr(0,4),10),parseInt(a.substr(5,2),10)-1,parseInt(a.substr(8,2),10),12<a.length?parseInt(a.substr(11,2),10):0,15<a.length?parseInt(a.substr(14,2),10):0,18<a.length?parseInt(a.substr(17,2),10):0)},toSqlDate:function(a,b){return SUI.date.format(a,b?"y-m-d h:i:s":"y-m-d")}};SUI.cryptography={BITS_BASE:26,BASE:67108864,MAX_DIGIT:67108863,DIGIT_TO_STR:"0123456789abcdefghijklmnopqrstuvwxyz",DIGIT_TO_BASE64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",STR_TO_DIGIT:[],BASE64_TO_DIGIT:[],trim:function(a){for(;0<a.length&&!a[a.length-1];)a.pop();return a},convertBase:function(a,b,c){for(var d=[];a.length;){for(var e=[],f=0,g=!1,h=a.length-1;0<=h;h--){var f=f*b+a[h],i=f/c|0;i&&!g&&(g=!0);g&&e.unshift(i);f%=c}a=e;d.push(f)}return this.trim(d)},random:function(a,
b){for(var c=[],d=b?1<<b:65536,e=0;e<a;e++)c.push(Math.random()*d|0);return this.convertBase(c,d,this.BASE)},fromString:function(a,b){if(!this.STR_TO_DIGIT.length){for(var c=0;c<this.DIGIT_TO_STR.length;c++){var d=this.DIGIT_TO_STR.charAt(c);this.STR_TO_DIGIT[d]=this.STR_TO_DIGIT[d.toUpperCase()]=c}for(c=0;c<this.DIGIT_TO_BASE64.length;c++)this.BASE64_TO_DIGIT[this.DIGIT_TO_BASE64.charAt(c)]=c}d=[];b=!b?16:b;for(c=a.length-1;0<=c;c--){var e=64===b?this.BASE64_TO_DIGIT[a.charAt(c)]:this.STR_TO_DIGIT[a.charAt(c)];
void 0!==e&&d.push(e)}c=this.convertBase(d,b,this.BASE);64==b&&d.length%4&&(c=this.shiftRight(c,2*(4-d.length%4)));return c},toString:function(a,b,c){b=!b?16:b;c=!c?1:c;if(64===b){for(var c=(this.bitLength(a)+23)%24,d=8>c?"==":16>c?"=":"",a=this.shiftLeft(a,2*d.length),a=this.convertBase(a,this.BASE,b),b="",e=a.length-1;0<=e;e--)b+=this.DIGIT_TO_BASE64.charAt(a[e]);for(b+=d;b.length%4;)b="A"+b;return b}a=this.convertBase(a,this.BASE,b);b="";for(e=a.length-1;0<=e;e--)b+=this.DIGIT_TO_STR.charAt(a[e]);
d="";for(e=b.length;e<c;e++)d+=this.DIGIT_TO_STR.charAt(0);return d+b},testBit:function(a,b){return a[b/this.BITS_BASE|0]&1<<b%this.BITS_BASE?!0:!1},bitLength:function(a){for(var b=a.length*this.BITS_BASE-1;0<=b&&!this.testBit(a,b);b--);return b+1},compare:function(a,b){for(var c=Math.max(a.length-1,b.length-1);0<=c;c--){var d=(a[c]||0)-(b[c]||0);if(d)return d}return 0},shiftRight:function(a,b){if(!b)return a.slice();for(var c=b/this.BITS_BASE|0,d=b%this.BITS_BASE,e=2<<d-1,d=2<<this.BITS_BASE-d-1,
f=[],g=a.length-1;g>=c;g--)f[g-c]=(f[g-c]||0)+(a[g]/e|0),0<=g-c-1&&(f[g-c-1]=a[g]%e*d);return this.trim(f)},shiftLeft:function(a,b){if(!b)return a.slice();for(var c=b/this.BITS_BASE|0,d=b%this.BITS_BASE,e=2<<d-1,d=2<<this.BITS_BASE-d-1,f=[],g=0;g<a.length;g++){f[g+c]=(f[g+c]||0)+a[g]%d*e;var h=a[g]/d|0;h&&(f[g+c+1]=h)}return f},add:function(a,b){for(var c=[],d=0,e=Math.max(a.length,b.length)-1,f=0;f<=e;f++)d=(a[f]||0)+(b[f]||0)+d,c[f]=d&this.MAX_DIGIT,d=d<this.BASE?0:1;d&&(c[e+1]=d);return c},subtract:function(a,
b){if(0<this.compare(b,a))throw"subtracting by a larger value";for(var c=[],d=0,e=Math.max(a.length,b.length)-1,f=0;f<=e;f++)d=(a[f]||0)-(b[f]||0)+d,c[f]=(0<=d?d:d+this.BASE)&this.MAX_DIGIT,d=0<=d?0:-1;return this.trim(c)},multiply:function(a,b){for(var c=[],d=b.length-1,e=0;e<=d;e++){for(var f=0,g=a.length-1,h=0;h<=g;h++)f=(c[e+h]||0)+(a[h]||0)*(b[e]||0)+f,c[e+h]=f&this.MAX_DIGIT,f=f/this.BASE|0;f&&(c[e+g+1]=f)}return c},square:function(a){for(var b=[],c=a.length-1,d=0;d<=c;d++){var e=(b[2*d]||0)+
(a[d]||0)*(a[d]||0);b[2*d]=e&this.MAX_DIGIT;for(var e=e/this.BASE|0,f=d+1;f<=c;f++)e=(b[d+f]||0)+2*(a[f]||0)*(a[d]||0)+e,b[d+f]=e&this.MAX_DIGIT,e=e/this.BASE|0;e&&(b[d+c+1]=e)}return b},divide:function(a,b){if(b.length){if(0<this.compare(b,a))return{quotient:[],remainder:a.slice()}}else throw"division by zero";for(var c=b.length-1,d=0,e=b[c],f=this.BASE>>1;e<f;e*=2)d++;d?(b=this.shiftLeft(b,d),a=this.shiftLeft(a,d)):a=a.slice();var f=a.length-1,e=[],g=[];g.length=f-c;for(g=g.concat(b);0<=this.compare(a,
g);)e[f-c]=(e[f-c]||0)+1,a=this.subtract(a,g);for(;f>=c+1;f--){var h=[this.MAX_DIGIT];if((a[f]||0)!=(b[c]||0))h[0]=((a[f]||0)*this.BASE+(a[f-1]||0))/(b[c]||0)|0;for(var g=[a[f-2]||0,a[f-1]||0,a[f]||0],i=[b[c-1]||0,b[c]||0],j=this.multiply(h,i);0<this.compare(j,g);)h[0]--,j=this.multiply(h,i);g=[];g.length=f-c-1;g=g.concat(b);i=this.multiply(h,g);0>this.compare(a,i)&&(h[0]--,i=this.subtract(i,g));a=this.subtract(a,i);e[f-c-1]=h[0]}d&&(a=this.shiftRight(a,d));return{quotient:e,remainder:a}},modularExponentiate:function(a,
b,c){for(var d=[1],e=this.bitLength(b)-1;0<=e;e--)if(d=this.divide(this.square(d),c).remainder,this.testBit(b,e))d=this.divide(this.multiply(d,a),c).remainder;return d},extendedGdc:function(a){if(0===a[1])return[1,0];var b=this.extendedGdc([a[1],a[0]%a[1]]);return[b[1],b[0]-(a[0]/a[1]|0)*b[1]]},montgomeryPrepare:function(a){a=this.extendedGdc([a[0],this.BASE]);if(!a[1])throw"modulus and base are not coprime";return 0>a[0]?-a[0]:this.BASE-a[0]},montgomeryConvert:function(a,b){var c=[];c.length=b.length;
return this.divide(c.concat(a),b).remainder},montgomeryReduce:function(a,b,c){var d=b.length;if(a.length>2*d)throw"modular reduction: T >= mR";for(var a=a.slice(),e=0;e<d;e++){for(var f=a[e]*c&this.MAX_DIGIT,g=0,h=0;g<b.length;g++)h=(a[g+e]||0)+(b[g]||0)*f+h,a[g+e]=h&this.MAX_DIGIT,h=h/this.BASE|0;for(a[g+e]=(a[g+e]||0)+h;a[g+e]>=this.BASE;g++)a[g+e]-=this.BASE,a[g+e+1]=(a[g+e+1]||0)+1}a=a.slice(d);0<=this.compare(a,b)&&(a=this.subtract(a,b));return a},montgomeryModularExponentiate:function(a,b,c,
d){for(var a=this.montgomeryConvert(a,c),e=this.montgomeryConvert([1],c),f=this.bitLength(b)-1;0<=f;f--)e=this.montgomeryReduce(this.square(e),c,d),this.testBit(b,f)&&(e=this.montgomeryReduce(this.multiply(e,a),c,d));return this.montgomeryReduce(e,c,d)},barrettPrepare:function(a){var b=[];b[2*a.length]=1;return this.divide(b,a).quotient},barrettReduce:function(a,b,c){c=this.multiply(a.slice(b.length-1),c).slice(b.length+1);a=a.slice(0,b.length+1);c=this.multiply(c,b).slice(0,b.length+1);if(0<this.compare(c,
a)){var d=[];d[b.length+1]=1;a=this.add(a,d)}for(a=this.subtract(a,c);0<=this.compare(a,b);)a=this.subtract(a,b);return a},barrettModularExponentiate:function(a,b,c,d){for(var e=[1],f=this.bitLength(b)-1;0<=f;f--)e=this.barrettReduce(this.square(e),c,d),this.testBit(b,f)&&(e=this.barrettReduce(this.multiply(e,a),c,d));return e}};SUI.rsa={encrypt:function(a,b,c,d){for(var e=Cryptography,a=this.pkcs1v1_5EncodedChunks(a,d/8),b=e.fromString(b,64),c=e.fromString(c,64),d=e.montgomeryPrepare(b),f=0,g=[];f<a.length;f++){var h=e.convertBase(a[f].reverse(),256,e.BASE),h=e.montgomeryModularExponentiate(h,c,b,d);g.push(e.toString(h,64))}return g},prepareChunks:function(a,b){for(var c=[],d=[],e,f=unescape(encodeURIComponent(a)),g=0;!isNaN(e=f.charCodeAt(g));g++)0==g%b&&(d=[],c.push(d)),d.push(e);return c},pkcs1v1_5EncodedChunks:function(a,
b){for(var c=this.prepareChunks(a,b-11),d=[],e=0;e<c.length;e++){for(var f=[0,2],g=b-c[e].length-3;0<g;g--)f.push(Math.floor(254*Math.random())+1);f.push(0);d.push(f.concat(c[e]))}return d}};SUI.Event=SUI.defineClass({initializer:function(a,b){this.elListener=a;this.event=b?b:window.event;if((this.target=this.event.srcElement?this.event.srcElement:this.event.target)&&3==this.target.nodeType)this.target=this.target.parentNode},elListener:null,event:null,target:null});SUI.ActionList=SUI.defineClass({initializer:function(a){this._list=[];for(var b=0;b<a.length;b++)this.add(a[b])},add:function(a){this._list[a.actionId]={handler:a.handler,enabled:a.enabled||!0,selected:a.selected||!1,title:a.title||"Action "+a.action,icon:a.icon||null,listeners:[]}},doAction:function(a){if(this._list[a].enabled)this._list[a].handler();else throw"Action ["+a+"] not enabled";},enable:function(a){for(var b in a)if(a.hasOwnProperty(b)){this._list[b].enabled=a[b];for(var c=0;c<this._list[b].listeners.length;c++)this._list[b].listeners[c].enable(a[b])}},
get:function(a){return this._list[a]},select:function(a){for(var b in a){this._list[b].selected=a[b];for(var c=0;c<this._list[b].listeners.length;c++)this._list[b].listeners[c].select(a[b])}},_list:null});SUI.Border=SUI.defineClass({initializer:function(a,b,c,d){for(var e=0;void 0!==arguments[e]&&e<arguments.length;e++){var f=arguments[e];if(0===e)this.top=this.right=this.bottom=this.left=f;else if(1===e)this.right=this.left=f;else if(2===e)this.bottom=f;else if(3===e)this.left=f}this.width=this.right+this.left;this.height=this.top+this.bottom},set:function(a){a.style.borderWidth=this.top+"px "+this.right+"px "+this.bottom+"px "+this.left+"px";a.style.borderStyle="solid"},bottom:0,height:0,left:0,
right:0,top:0,width:0});SUI.Padding=SUI.defineClass({baseClass:SUI.Border,initializer:function(a,b,c,d){SUI.Padding.initializeBase(this,a,b,c,d)},growH:function(a){var b=a/2|0;this.top+=b;if(0>this.top)this.top=0;this.bottom+=a-b;if(0>this.bottom)this.bottom=0;this.height=this.top+this.bottom},growW:function(a){var b=a/2|0;this.left+=b;if(0>this.left)this.left=0;this.right+=a-b;if(0>this.right)this.right=0;this.width=this.right+this.left},set:function(a){a.style.paddingTop=(0>this.top?0:this.top)+"px";a.style.paddingBottom=
(0>this.bottom?0:this.bottom)+"px";a.style.paddingLeft=(0>this.left?0:this.left)+"px";a.style.paddingRight=(0>this.right?0:this.right)+"px"}});SUI.Box=SUI.defineClass({initializer:function(a){if(!a)throw"creating a box without argument object";this.anchor={left:!0,right:!1,top:!0,bottom:!1};this.bin=[];this._el=SUI.browser.createElement(a.tag||null,a.elemAttr||null);if(a.id)this._el.id=a.id;if(a.anchor)this.anchor=a.anchor;a.bottom&&this.bottom(a.bottom);a.left&&this.left(a.left);a.right&&this.right(a.right);a.top&&this.top(a.top);a.maxHeight&&this.maxHeight(a.maxHeight);a.minHeight&&this.minHeight(a.minHeight);a.minWidth&&this.minWidth(a.minWidth);
a.maxWidth&&this.maxWidth(a.maxWidth);a.border&&this.border(a.border);a.padding&&this.padding(a.padding);a.height&&this.height(a.height);a.width&&this.width(a.width);a.parent&&this.parent(a.parent)},absPos:function(){var a=0,b=0,c=0,d=this._el;if(d.offsetParent){do a+=d.offsetLeft,c=parseInt(SUI.browser.currentStyle(d,"borderLeftWidth"),10),a+=isNaN(c)?0:c,b+=d.offsetTop,c=parseInt(SUI.browser.currentStyle(d,"borderTopWidth"),10),b+=isNaN(c)?0:c;while(null!==(d=d.offsetParent))}return{l:a,t:b}},addClass:function(a){SUI.style.addClass(this._el,
a)},addListener:function(a,b){if(!this.listeners)this.listeners={};this.listeners[a]||(this.listeners[a]=[]);this.listeners[a].push(b)},border:function(a){if(void 0!==a&&"string"===typeof a)throw"Convert to type Border please";return void 0!==a?(this._border=a)&&null:this._border},callListener:function(a){var b=[].slice.call(arguments,1);this[a]&&this[a].apply(this,b);if(this.listeners&&this.listeners[a]&&this.listeners[a].length)for(var c=0;c<this.listeners[a].length;c++)this.listeners[a][c].apply(this,
b)},bottom:function(a){return void 0!==a?(this._bottom=a)&&null:this._bottom},clientHeight:function(){return this.height()-(this._border?this._border.height:0)-(this._padding?this._padding.height:0)},clientWidth:function(){return this.width()-(this._border?this._border.width:0)-(this._padding?this._padding.width:0)},display:function(){0<this.width()&&0<this.height()&&this.setDim()},draw:function(){this.layOut();this.display()},el:function(){return this._el},height:function(a){return void 0!==a?(a=
a<this._minHeight?this._minHeight:a>this._maxHeight?this._maxHeight:a,isNaN(a)&&console.log("height: NaN"),void 0===a&&console.log("height: undefined"),this._height=a,null):this._height},layOut:function(){},left:function(a){return void 0!==a?(this._left=a)&&null:this._left},maxHeight:function(a){if(void 0!==a){this._maxHeight=a;if(this._height>this._maxHeight)this._height=this._maxHeight;return null}return this._maxHeight},maxWidth:function(a){if(void 0!==a){this._maxWidth=a;if(this._width>this._maxWidth)this._width=
this._maxWidth;return null}return this._maxWidth},minHeight:function(a){if(void 0!==a){this._minHeight=a;if(this._height<this._minHeight)this._height=this._minHeight;return null}return this._minHeight},minWidth:function(a){if(void 0!==a){this._minWidth=a;if(this._width<this._minWidth)this._width=this._minWidth;return null}return this._minWidth},padding:function(a){if(void 0!==a){if("string"===typeof a)throw"Convert to type Padding please";this._padding=a;return null}return this._padding},parent:function(a){return void 0!==
a?(this._parent=a,this._parent.el().appendChild(this._el),null):this._parent},removeBox:function(){this._parent.el().removeChild(this._el)},removeClass:function(a){SUI.style.removeClass(this._el,a)},right:function(a){return void 0!==a?(this._right=a)&&null:this._right},setDim:function(){this.setPos();var a=this.clientWidth();isNaN(a)&&(console.log(a),a=0);0>a&&(this._padding.growW(a),a=0);this._el.style.width=a+"px";a=this.clientHeight();0>a&&(this._padding.growH(a),a=0);this._el.style.height=a+"px";
this._border&&this._border.set(this._el);this._padding&&this._padding.set(this._el)},setPos:function(){var a=this.parent()instanceof SUI.Box&&this.parent().padding();this._el.style.top=(a?a.top:0)+this.top()+"px";this._el.style.left=(a?a.left:0)+this.left()+"px"},setRect:function(a,b,c,d){1===arguments.length?(this.top(a.top()),this.left(a.left()),this.width(a.width()),this.height(a.height())):(this.top(parseInt(a,10)),this.left(parseInt(b,10)),this.width(parseInt(c,10)),this.height(parseInt(d,10)))},
top:function(a){return void 0!==a?(this._top=a)&&null:this._top},width:function(a){return void 0!==a?(a=a<this._minWidth?this._minWidth:a>this._maxWidth?this._maxWidth:a,isNaN(a)&&console.log("width: NaN"),this._width=a,null):this._width},_border:new SUI.Border,_bottom:0,_el:null,_height:0,_left:0,_listeners:null,_maxHeight:1E6,_maxWidth:1E5,_minHeight:0,_minWidth:0,_padding:new SUI.Padding,_parent:null,_right:0,_top:0,_width:0});SUI.TextBox=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){SUI.TextBox.initializeBase(this,a);this.el().innerHTML=a.text||""},text:function(a){if(void 0===a)return this.el().innerHTML;this.el().innerHTML=a;return null}});SUI.Dragger=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){SUI.Dragger.initializeBase(this,a);this._yMin=this._xMin=0;this._xMax=SUI.browser.viewportWidth;this._yMax=SUI.browser.viewportHeight},EAST:"e",HORIZONTAL:"h",NORTH:"n",SOUTH:"s",VERTICAL:"v",WEST:"w",direction:function(a){this._dir=a},onEndDrag:function(){},onDrag:function(){},start:function(a){this.el().style.zIndex=1E3;this._xPos=SUI.browser.getX(a.event);this._yPos=SUI.browser.getY(a.event);this._lStart=this.left();this._hStart=
this.height();this._tStart=this.top();this._wStart=this.width();var b=this;SUI.browser.addEventListener(document,"mousemove",this._ehDrag=function(a){b._drag(new SUI.Event(this,a))||SUI.browser.noPropagation(a)});SUI.browser.addEventListener(document,"mouseup",this._ehEndDrag=function(a){b._endDrag()||SUI.browser.noPropagation(a)})},xMax:function(a){this._xMax=a},xMin:function(a){this._xMin=a},yMax:function(a){this._yMax=a},yMin:function(a){this._yMin=a},_dir:"",_ehDrag:null,_ehEndDrag:null,_hStart:0,
_lStart:0,_tStart:0,_wStart:0,_xMax:0,_xMin:0,_xPos:0,_yMax:0,_yMin:0,_yPos:0,_bounds:function(a,b,c){return a<b?b:a>c?c:a},_drag:function(a){var b=SUI.browser.getX(a.event),a=SUI.browser.getY(a.event);if(-1!=this._dir.indexOf("h")){var c=this._lStart+b-this._xPos,c=this._bounds(c,this._xMin,this._xMax);this.left(c)}-1!=this._dir.indexOf("v")&&(c=this._tStart+a-this._yPos,c=this._bounds(c,this._yMin,this._yMax),this.top(c));if(-1!=this._dir.indexOf("e")){var d=this._wStart+b-this._xPos,d=this._bounds(d,
this._xMin,this._xMax);this.width(d)}-1!=this._dir.indexOf("w")&&(d=this._wStart-b+this._xPos,d=this._bounds(d,this._xMin,this._xMax),c=this._lStart-(d-this._wStart),this.width(d),this.left(c));-1!=this._dir.indexOf("n")&&(b=this._hStart-a+this._yPos,b=this._bounds(b,this._yMin,this._yMax),c=this._tStart-(b-this._hStart),this.height(b),this.top(c));-1!=this._dir.indexOf("s")&&(b=this._hStart+a-this._yPos,b=this._bounds(b,this._yMin,this._yMax),this.height(b));this.setDim();this.callListener("onDrag")},
_endDrag:function(){SUI.browser.removeEventListener(document,"mousemove",this._ehDrag);SUI.browser.removeEventListener(document,"mouseup",this._ehEndDrag);this.callListener("onEndDrag")}});SUI.AnchorLayout=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){if(!a.anchor)a.anchor={left:!0,right:!0,top:!0,bottom:!0};SUI.AnchorLayout.initializeBase(this,a);this.children=[]},children:null,add:function(a,b){this.children.push(a);a.parent(b||this)},display:function(){SUI.AnchorLayout.parentMethod(this,"display");for(var a=0;a<this.children.length;a++)this.children[a].display()},layOut:function(){this._layoutChildren()},remove:function(a,b){var c=this.children.indexOf(a);if(-1===c)throw"Trying to remove a nonexisting SUI.AnchorLayout";
(b||this).el().removeChild(a.el());this.children.splice(c,1)},_layoutChildren:function(){for(var a=0;a<this.children.length;a++){var b=this.children[a];b.anchor.left&&b.anchor.right?b.width(b.parent().clientWidth()-b.left()-b.right()):b.anchor.right?b.left(b.parent().clientWidth()-b.width()-b.right()):b.anchor.left&&b.right(b.parent().clientWidth()-b.width()-b.left());b.anchor.top&&b.anchor.bottom?b.height(b.parent().clientHeight()-b.top()-b.bottom()):b.anchor.bottom?b.top(b.parent().clientHeight()-
b.height()-b.bottom()):b.anchor.top&&b.bottom(b.parent().clientHeight()-b.height()-b.top());b.layOut()}}});SUI.SplitLayout=SUI.defineClass({baseClass:SUI.AnchorLayout,initializer:function(a){SUI.SplitLayout.initializeBase(this,a);this.center=new SUI.Box({parent:this});a.center&&a.center.box&&this.add(a.center.box,"center");if(a.north)this.north=new SUI.Box({parent:this}),this.north.height(a.north.height),a.north.box&&this.add(a.north.box,"north");if(a.south)this.south=new SUI.Box({parent:this}),this.south.height(a.south.height),a.south.box&&this.add(a.south.box,"south");if(a.west)this.west=new SUI.Box({parent:this}),
this.west.width(a.west.width),a.west.box&&this.add(a.west.box,"west");if(a.east)this.east=new SUI.Box({parent:this}),this.east.width(a.east.width),a.east.box&&this.add(a.east.box,"east")},center:null,east:null,north:null,south:null,west:null,add:function(a,b,c){if(b=this[b]){var d=this.get(b);b.onRemove?(this._faData={frame:b,loc:d,child:a,onRemove:c},b.callListener("onRemove",d)):(d&&this.remove(d,b),SUI.SplitLayout.parentMethod(this,"add",a,b),this._minsizeCalc(),b.onRemove=c||null)}else throw"Splitlayout: Adding to an inexisting location";
},display:function(){this.setDim();this.north&&this.north.setDim();this.south&&this.south.setDim();this.west&&this.west.setDim();this.east&&this.east.setDim();this.center.setDim();SUI.SplitLayout.parentMethod(this,"display")},get:function(a){for(var b=0;b<this.children.length;b++)if(this.children[b].parent()==a)return this.children[b];return null},layOut:function(){var a=this._prepareLayout(),b=a.w,a=a.h,c=0,d=0,e=b.w,f=a.h;this.setRect(this.top(),this.left(),b.w,a.h);this.north&&(this.north.setRect(0,
0,b.w,a.nh),c+=a.nh,f-=c);this.south&&(this.south.setRect(a.h-a.sh,0,b.w,a.sh),f-=a.sh);this.west&&(this.west.setRect(c,0,b.ew,f),d+=b.ew,e-=d);this.east&&(this.east.setRect(c,b.w-b.ww,b.ww,f),e-=b.ww);this.center.setRect(c,d,e,f);SUI.SplitLayout.parentMethod(this,"layOut")},finishAdd:function(){if(this._faData)this.remove(this._faData.loc,this._faData.frame),SUI.SplitLayout.parentMethod(this,"add",this._faData.child,this._faData.frame),this._minsizeCalc(),this._faData.frame.onRemove=this._faData.onRemove||
null,this._faData=null},_borderWidth:0,_faData:null,_correctHeight:function(a){var b=this.north?this.north.height():0,c=this.south?this.south.height():0,d=b+c+this.center.minHeight()+(this.north?this._borderWidth:0)+(this.south?this._borderWidth:0),a=this._correctSizeCalc(a,d,this.minHeight(),b,c,this.north?this.north.minHeight():0,this.south?this.south.minHeight():0,this.north?!0:!1,this.south?!0:!1);return{h:a.t,nh:a.nw,sh:a.se}},_correctWidth:function(a){var b=this.west?this.west.width():0,c=this.east?
this.east.width():0,d=b+c+this.center.minWidth()+(this.west?this._borderWidth:0)+(this.east?this._borderWidth:0),a=this._correctSizeCalc(a,d,this.minWidth(),b,c,this.west?this.west.minWidth():0,this.east?this.east.minWidth():0,this.west?!0:!1,this.east?!0:!1);return{w:a.t,ew:a.nw,ww:a.se}},_correctSizeCalc:function(a,b,c,d,e,f,g,h,i){c>a?(h&&(d=f),i&&(e=g),a=c):b>a&&(b=h&&i?Math.ceil((b-a)/2):b-a,h&&(d-=b,d<f&&(i&&(b+=f-d),d=f)),i&&(e-=b,e<g&&(h&&(d-=g-e,d<f&&(d=f)),e=g)));return{t:a,nw:d,se:e}},
_minsizeCalc:function(){this.minWidth(this.center.minWidth());this.minHeight(this.center.minHeight());this.north&&this.minHeight(this.minHeight()+this.north.minHeight()+this._borderWidth);this.south&&this.minHeight(this.minHeight()+this.south.minHeight()+this._borderWidth);this.west&&this.minWidth(this.minWidth()+this.west.minWidth()+this._borderWidth);this.east&&this.minWidth(this.minWidth()+this.east.minWidth()+this._borderWidth)},_prepareLayout:function(){for(var a=0;a<this.children.length;a++){var b=
this.children[a];b.parent().minWidth()<b.minWidth()&&b.parent().minWidth(b.minWidth());b.parent().maxWidth()>b.maxWidth()&&b.parent().maxWidth(b.maxWidth());b.parent().minHeight()<b.minHeight()&&b.parent().minHeight(b.minHeight());b.parent().maxHeight()>b.maxHeight()&&b.parent().maxHeight(b.maxHeight())}return{w:this._correctWidth(this.width()),h:this._correctHeight(this.height())}}});SUI.BorderLayout=SUI.defineClass({baseClass:SUI.SplitLayout,initializer:function(a){SUI.BorderLayout.initializeBase(this,a);this.addClass("sui-borderlayout");this.anchor={left:!0,right:!0,top:!0,bottom:!0};this.center=new SUI.Box({parent:this});a.center&&a.center.box&&this.add(a.center.box,"center");if(a.north)this.north=new SUI.Box({parent:this}),this.north.height(a.north.height),this._createBorder(this.north),a.north.box&&this.add(a.north.box,"north");if(a.south)this.south=new SUI.Box({parent:this}),
this.south.height(a.south.height),this._createBorder(this.south),a.south.box&&this.add(a.south.box,"south");if(a.west)this.west=new SUI.Box({parent:this}),this.west.width(a.west.width),this._createBorder(this.west),a.west.box&&this.add(a.west.box,"west");if(a.east)this.east=new SUI.Box({parent:this}),this.east.width(a.east.width),this._createBorder(this.east),a.east.box&&this.add(a.east.box,"east")},BORDER_WIDTH:6,HANDLE_LENGTH:48,display:function(){this.setDim();this.north&&(this.north.setDim(),
this.north.paneBorder.setDim(),this.north.handle.setDim());this.south&&(this.south.setDim(),this.south.paneBorder.setDim(),this.south.handle.setDim());this.west&&(this.west.setDim(),this.west.paneBorder.setDim(),this.west.handle.setDim());this.east&&(this.east.setDim(),this.east.paneBorder.setDim(),this.east.handle.setDim());this.center.setDim();SUI.SplitLayout.parentMethod(this,"display")},layOut:function(){var a=this._prepareLayout(),b=a.w,a=a.h,c=0,d=0,e=b.w,f=a.h,g=0;this.setRect(this.top(),this.left(),
b.w,a.h);g=this.HANDLE_LENGTH>b.w?b.w:this.HANDLE_LENGTH;this.north&&(this.north.setRect(0,0,b.w,a.nh),c+=a.nh+this.BORDER_WIDTH,f-=c,this.north.paneBorder.setRect(a.nh,0,b.w,this.BORDER_WIDTH),this.north.handle.setRect(0,Math.floor((b.w-g)/2),g,this.BORDER_WIDTH));this.south&&(this.south.setRect(a.h-a.sh,0,b.w,a.sh),f-=a.sh+this.BORDER_WIDTH,this.south.paneBorder.setRect(a.h-a.sh-this.BORDER_WIDTH,0,b.w,this.BORDER_WIDTH),this.south.handle.setRect(0,Math.floor((b.w-g)/2),g,this.BORDER_WIDTH));g=
this.HANDLE_LENGTH>f?f:this.HANDLE_LENGTH;this.west&&(this.west.setRect(c,0,b.ew,f),d+=b.ew+this.BORDER_WIDTH,e-=d,this.west.paneBorder.setRect(c,b.ew,this.BORDER_WIDTH,f),this.west.handle.setRect(Math.floor((f-g)/2),0,this.BORDER_WIDTH,g));this.east&&(this.east.setRect(c,b.w-b.ww,b.ww,f),e-=b.ww+this.BORDER_WIDTH,this.east.paneBorder.setRect(c,b.w-b.ww-this.BORDER_WIDTH,this.BORDER_WIDTH,f),this.east.handle.setRect(Math.floor((f-g)/2),0,this.BORDER_WIDTH,g));this.center.setRect(c,d,e,f);SUI.SplitLayout.parentMethod(this,
"layOut")},_createBorder:function(a){a.paneBorder=new SUI.Box({parent:this});a.paneBorder.addClass("sui-borderlayout-border");a.paneBorder.el().style.cursor=a===this.east||a===this.west?"col-resize":"row-resize";a.handle=new SUI.Box({parent:a.paneBorder});a.handle.addClass("sui-borderlayout-handle");a.handle.el().style.cursor=a.paneBorder.el().style.cursor;a.handle.el().style.backgroundImage="url("+SUI.imgDir+"/"+SUI.resource.blHandle+")";var b=this;SUI.browser.addEventListener(a.paneBorder.el(),
"mousedown",function(c){b._doMouseDown(new SUI.Event(this,c),a)||SUI.browser.noPropagation(c)})},_doMouseDown:function(a,b){var c=new SUI.Dragger({parent:this});c.setRect(b.paneBorder);c.addClass("sui-borderlayout-dragger");this.west===b&&(c.xMin(this.west.minWidth()),c.xMax(this.center.left()+this.center.width()-this.center.minWidth()-this.BORDER_WIDTH),c.direction(c.HORIZONTAL));this.east===b&&(c.xMin(this.center.left()+this.center.minWidth()),c.xMax(this.east.left()+this.east.width()-this.east.minWidth()-
this.BORDER_WIDTH),c.direction(c.HORIZONTAL));this.north===b&&(c.yMin(this.north.minHeight()),c.yMax(this.center.top()+this.center.height()-this.center.minHeight()-this.BORDER_WIDTH),c.direction(c.VERTICAL));this.south===b&&(c.yMin(this.center.top()+this.center.minHeight()),c.yMax(this.south.top()+this.south.height()-this.south.minHeight()-this.BORDER_WIDTH),c.direction(c.VERTICAL));var d=new SUI.Box({parent:this});d.setRect(0,0,this.width(),this.height());d.el().style.cursor=b.paneBorder.el().style.cursor;
d.setDim();c.el().style.cursor=b.paneBorder.el().style.cursor;c.setDim();var e=this;c.addListener("onEndDrag",function(){e._endDrag(b,c,d)});c.start(a,this)},_endDrag:function(a,b,c){b.removeBox();c.removeBox();this.north===a&&(c=this.north.paneBorder.top()-b.top(),this.north.height(this.north.height()-c));this.south===a&&(c=this.south.paneBorder.top()-b.top(),this.south.height(this.south.height()+c));this.west===a&&(c=this.west.paneBorder.left()-b.left(),this.west.width(this.west.width()-c));this.east===
a&&(c=this.east.paneBorder.left()-b.left(),this.east.width(this.east.width()+c));this.draw()}});SUI.Panel=SUI.defineClass({baseClass:SUI.AnchorLayout,initializer:function(a){SUI.Panel.initializeBase(this,a);this.addClass("sui-panel");this.border(a.border);this.padding(a.padding);this.inner=new SUI.Box({parent:this});this.inner.addClass("sui-panel-inner");a.innerBorder&&this.inner.border(a.innerBorder);a.color?this.inner.el().style.backgroundColor=a.color:this.inner.addClass("sui-panel-gradient")},add:function(a){SUI.Panel.parentMethod(this,"add",a,this.inner)},clientBox:function(){return this.inner},
display:function(){this.setDim();"sui"==this._type&&(this.inner.setDim(),SUI.Panel.parentMethod(this,"display"))},layOut:function(){"sui"==this._type&&(this.inner.setRect(0,0,this.clientWidth(),this.clientHeight()),SUI.Panel.parentMethod(this,"layOut"))},content:function(a){"html"!==this._type&&this._createHTMLPanel();if(void 0===a)return this.inner.el().innerHTML;this.inner.el().innerHTML=a;if(SUI.browser.isIE&&this.inner.el().unselectable)for(var a=this.inner.el().getElementsByTagName("*"),b=0;b<
a.length;b++)a[b].unselectable=!0;return null},_createHTMLPanel:function(){this._type="html";this.el().style.backgroundColor=this.inner.el().style.backgroundColor;-1!==this.inner.el().className.indexOf("sui-panel-gradient")&&(this.inner.removeClass("sui-panel-gradient"),this.addClass("sui-panel-gradient"));this.el().style.overflow="auto";this.inner.el().style.width="auto";this.inner.el().style.height="auto";this.inner.el().style.position="relative";this.inner.el().style.top=0;this.inner.el().style.left=
0;this.inner.el().style.overflow="visible"},_type:"sui"});SUI.Window=SUI.defineClass({baseClass:SUI.AnchorLayout,initializer:function(a){SUI.Window.windowStack||this._initWindowStack();a.minWidth=a.minWidth||200;a.minHeight=a.minHeight||100;SUI.Window.initializeBase(this,a);this.el().style.overflow="visible";a.top||this.center();this._resizable=a.resizable?!0:!1;this._buildControl(a)},BORDER_WIDTH:3,CLOSE_RIGHT:2,CLOSE_SIZE:20,CLOSE_TOP:1,CORNER_SIZE:16,INNER_BORDER_OUTLINE:1,OUTER_BORDER_OUTLINE:1,CAPTION_HEIGHT:23,CAPTION_PADDING_TOP:3,CAPTION_PADDING_LEFT:5,
add:function(a){SUI.Window.parentMethod(this,"add",a,this.body)},caption:function(a){if(void 0===a)return this._caption.el().innerHTML;this._caption.el().innerHTML=a;return null},center:function(){this.top(SUI.browser.viewportScrollY()+((SUI.browser.viewportHeight-this.height())/3|0));this.left(SUI.browser.viewportScrollX()+((SUI.browser.viewportWidth-this.width())/2|0));0>this.top()&&this.top(0);0>this.left()&&this.left(0)},close:function(){document.body.removeChild(this._overlay);this.removeBox();
SUI.Window.windowStack.pop();SUI.Window.windowStack.length&&SUI.style.addClass(SUI.Window.windowStack[SUI.Window.windowStack.length-1]._overlay,"sui-overlay-disable");for(var a=0;a<this._disabledElements.length;a++)this._disabledElements[a].el.tabIndex=this._disabledElements[a].ti.tabIndex;this._disabledElements=null},clientAreaPosition:function(){var a=this._draggerBorderWidth();return{top:a+this.CAPTION_HEIGHT,left:a,right:a,bottom:a}},display:function(){this.setDim();this._caption.setDim();this._mainArea.setDim();
this.body.setDim();this._resizable&&(this._n.setDim(),this._e.setDim(),this._s.setDim(),this._w.setDim(),this._nw.setDim(),this._ne.setDim(),this._se.setDim(),this._sw.setDim());SUI.Window.parentMethod(this,"display")},layOut:function(){this._caption.setRect(0,0,this.clientWidth(),this.CAPTION_HEIGHT);SUI.style.setRect(this._closeIcon,this.CLOSE_TOP,this.clientWidth()-this.CLOSE_SIZE-this.CLOSE_RIGHT,this.CLOSE_SIZE,this.CLOSE_SIZE);this._mainArea.setRect(this.CAPTION_HEIGHT,0,this.clientWidth(),
this.clientHeight()-this.CAPTION_HEIGHT);this.body.setRect(this._mainArea.top()+this._mainArea.border().top+this._mainArea.padding().top,this._mainArea.left()+this._mainArea.border().left+this._mainArea.padding().left,this._mainArea.clientWidth(),this._mainArea.clientHeight());if(this._resizable){var a=this.OUTER_BORDER_OUTLINE,b=this._draggerBorderWidth();this._n.setRect(-a,-a,this.width(),b);this._e.setRect(-a,this.width()-b-a,b,this.height());this._s.setRect(this.height()-b-a,-a,this.width(),b);
this._w.setRect(-a,-a,b,this.height());this._nw.setRect(-a,-a,this.CORNER_SIZE,this.CORNER_SIZE);this._ne.setRect(-a,this.clientWidth()+a-this.CORNER_SIZE,this.CORNER_SIZE,this.CORNER_SIZE);this._se.setRect(this.clientHeight()+a-this.CORNER_SIZE,this.clientWidth()+a-this.CORNER_SIZE,this.CORNER_SIZE,this.CORNER_SIZE);this._sw.setRect(this.clientHeight()+a-this.CORNER_SIZE,-a,this.CORNER_SIZE,this.CORNER_SIZE)}SUI.Window.parentMethod(this,"layOut")},onClose:function(){},show:function(){if(!this._disabledElements){this._disabledElements=
[];for(var a=document.getElementsByTagName("*"),b;b<a.length;b++)if(void 0!==a[b].tabIndex&&-1!=a[b].tabIndex)this._disabledElements.push({ti:a[b].tabIndex,el:a[b]}),a[b].tabIndex=-1;SUI.Window.windowStack.length&&SUI.style.removeClass(SUI.Window.windowStack[SUI.Window.windowStack.length-1]._overlay,"sui-overlay-disable");this._overlay=SUI.browser.createElement();SUI.style.setRect(this._overlay,0,0,SUI.browser.viewportWidth,SUI.browser.viewportHeight);SUI.style.addClass(this._overlay,"sui-overlay-disable");
this._overlay.style.position="fixed";document.body.appendChild(this._overlay);SUI.Window.windowStack.push(this);this.parent({el:function(){return document.body}});this.draw()}},_disabledElements:null,_overlay:null,_resizable:!0,_addResizeHandler:function(a,b){var c=this;SUI.browser.addEventListener(a,"mousedown",function(a){c._startDragBorder(new SUI.Event(this,a),b)||SUI.browser.noPropagation(a)})},_addWindowEvents:function(){var a=this;SUI.browser.addEventListener(this._caption.el(),"mousedown",
function(b){a._startDragWindow(new SUI.Event(this,b))||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this._closeIcon,"click",function(b){a.callListener("onClose");a.close()||SUI.browser.noPropagation(b)})},_buildControl:function(a){this.addClass("sui-window-border");this.border(new SUI.Border(this.OUTER_BORDER_OUTLINE));this._mainArea=new SUI.Box({parent:this});this._mainArea.addClass("sui-window");this._mainArea.border(new SUI.Border(this.INNER_BORDER_OUTLINE));this._mainArea.padding(new SUI.Padding(this.BORDER_WIDTH));
this._caption=new SUI.Box({parent:this});this._caption.addClass("sui-window-caption sui-window-border");this._caption.el().innerHTML=a.caption||SUI.i18n.captionWindow;this._caption.padding(new SUI.Padding(this.CAPTION_PADDING_TOP,0,0,this.CAPTION_PADDING_LEFT));this._caption.el().style.cursor="move";if(this._resizable){this._n=new SUI.Box({parent:this});this._e=new SUI.Box({parent:this});this._s=new SUI.Box({parent:this});this._w=new SUI.Box({parent:this});this._nw=new SUI.Box({parent:this});this._ne=
new SUI.Box({parent:this});this._se=new SUI.Box({parent:this});this._sw=new SUI.Box({parent:this});for(var b=[this._n,this._e,this._s,this._w,this._nw,this._ne,this._se,this._sw],c="n,e,s,w,nw,ne,se,sw".split(","),d=0;d<b.length;d++)b[d].el().style.cursor=c[d]+"-resize",this._addResizeHandler(b[d].el(),c[d])}this._closeIcon=document.createElement("INPUT");this._closeIcon.type="image";this._closeIcon.src=SUI.imgDir+"/"+SUI.resource.wnClose;this._closeIcon.style.position="absolute";this.el().appendChild(this._closeIcon);
this.body=new SUI.Box({parent:this});this.body.addClass("body sui-window-body");a.padding&&this.body.padding(a.padding);this._addWindowEvents()},_draggerBorderWidth:function(){return this.OUTER_BORDER_OUTLINE+this.INNER_BORDER_OUTLINE+this.BORDER_WIDTH},_endDrag:function(a){this.setRect(this.top()+a.top(),this.left()+a.left(),a.width(),a.height());a.removeBox();this.draw()},_initWindowStack:function(){if(!SUI.Window.windowStack)SUI.Window.windowStack=[],SUI.browser.addEventListener(window,"resize",
function(a){for(var b=0;b<SUI.Window.windowStack.length;b++)SUI.style.setRect(SUI.Window.windowStack[b]._overlay,0,0,SUI.browser.viewportWidth-0,SUI.browser.viewportHeight-0);SUI.browser.noPropagation(a)}),SUI.browser.addEventListener(window.document,"keydown",function(a){var b=new SUI.Event(this,a);if(SUI.Window.windowStack.length){var c=SUI.Window.windowStack[SUI.Window.windowStack.length-1];27==b.event.keyCode&&(c.callListener("onClose"),c.close());SUI.browser.noPropagation(a)}})},_startDragBorder:function(a,
b){var c=new SUI.Dragger({parent:this,width:this.width(),height:this.height(),border:new SUI.Border(this._draggerBorderWidth())});c.addClass("sui-window-dragger");c.el().style.cursor=a.elListener.style.cursor;c.direction(b);var d,e;-1!=b.indexOf("w")||-1!=b.indexOf("n")?(d=this.left()+this.width(),e=this.top()+this.height()):(d=SUI.browser.viewportWidth-this.left()-1,e=SUI.browser.viewportHeight-this.top()-1);d>this.maxWidth()&&(d=this.maxWidth());e>this.maxHeight()&&(e=this.maxHeight());c.xMin(this.minWidth());
c.yMin(this.minHeight());c.xMax(d);c.yMax(e);c.setDim();var f=this;c.addListener("onEndDrag",function(){f._endDrag(c)});c.start(a,this)},_startDragWindow:function(a){var b=new SUI.Dragger({parent:this,width:this.width(),height:this.height(),border:new SUI.Border(this._draggerBorderWidth())});b.addClass("sui-window-dragger");b.el().style.cursor=this._caption.el().style.cursor;b.direction(b.HORIZONTAL+b.VERTICAL);b.xMin(-this.left()-this.OUTER_BORDER_OUTLINE);b.xMax(SUI.browser.viewportWidth-this.width()-
this.left()-this.OUTER_BORDER_OUTLINE);b.yMin(-this.top()-this.OUTER_BORDER_OUTLINE);b.yMax(SUI.browser.viewportHeight-this.height()-this.top()-this.OUTER_BORDER_OUTLINE);b.setDim();var c=this;b.addListener("onEndDrag",function(){c._endDrag(b)});b.start(a,this)}});SUI.Accordion=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){if(!a.anchor)a.anchor={left:!0,right:!0,top:!0,bottom:!0};SUI.Accordion.initializeBase(this,a);if(!a.selected)a.selected=0;this._buildControl(a)},ITEM_BORDER_BOTTOM_WIDTH:1,ITEM_HEIGHT:24,ITEM_PADDING_TOP:4,ITEM_PADDING_LR:5,ICON_SIZE:16,add:function(a,b){this._items[b].content.add(a)},display:function(){this.setDim();for(var a=0;a<this._items.length;a++)this._items[a].header.setDim(),this._items[a].headertext.setDim();this._selectedItem.content.display()},
layOut:function(){for(var a=0,b=0;a<this._items.length;a++)if(this._items[a].header.setRect(b,0,this.width(),this.ITEM_HEIGHT),this._items[a].headertext.setRect(this.ITEM_PADDING_TOP,this.ITEM_PADDING_LR,this.width()-2*this.ITEM_PADDING_LR-this.ICON_SIZE,this.ITEM_HEIGHT-this.ITEM_PADDING_TOP),SUI.style.setRect(this._items[a].headersign,this.ITEM_PADDING_TOP,this.width()-this.ITEM_PADDING_LR-this.ICON_SIZE,this.ICON_SIZE,this.ICON_SIZE),b+=this.ITEM_HEIGHT,this._items[a].headersign.src=SUI.imgDir+
"/"+SUI.resource.acClosed,this._items[a].content.el().style.display="none",this._selectedItem===this._items[a]){this._items[a].headersign.src=SUI.imgDir+"/"+SUI.resource.acDown;this._items[a].content.el().style.display="block";var c=this._contentHeight();this._items[a].content.setRect(b,0,this.width(),c);b+=c}this._selectedItem.content.layOut()},_items:null,_selectedItem:null,_addOnClickHeader:function(a){var b=this;SUI.browser.addEventListener(a.header.el(),"click",function(c){b._doClick(a)||SUI.browser.noPropagation(c)})},
_buildControl:function(a){this._items=[];this._selectedItem=null;for(var b=0;b<a.items.length;b++){var c={title:"Item "+b,box:null},d;for(d in a.items[b])a.items[b].hasOwnProperty(d)&&(c[d]=a.items[b][d]);this._items.push(c)}for(b=0;b<this._items.length;b++)if(this._items[b].header=new SUI.Box({parent:this}),this._addOnClickHeader(this._items[b]),this._items[b].header.addClass("sui-ac-header"),this._items[b].header.border(new SUI.Border(0,0,this.ITEM_BORDER_BOTTOM_WIDTH)),this._items[b].headertext=
new SUI.Box({parent:this._items[b].header}),this._items[b].headertext.el().innerHTML=this._items[b].title,this._items[b].headersign=SUI.browser.createElement("IMG"),this._items[b].header.el().appendChild(this._items[b].headersign),this._items[b].content=new SUI.AnchorLayout({parent:this}),this._items[b].content.addClass("sui-ac-content"),this._items[b].content.border(new SUI.Border(0,0,this.ITEM_BORDER_BOTTOM_WIDTH)),this._items[b].content.el().style.overflow="auto",this._items[b].content.el().style.display=
"none",this._items[b].box&&this.add(this._items[b].box,b),b===a.selected)this._selectedItem=this._items[b];if(!this._selectedItem)this._selectedItem=this._items[0]},_doClick:function(a){this._selectedItem=a;this.draw()},_contentHeight:function(){return this.height()-this._items.length*this.ITEM_HEIGHT+this.ITEM_BORDER_BOTTOM_WIDTH}});SUI.PopupMenu=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){SUI.PopupMenu.initializeBase(this,a);this._main=!0!==a.sub;this._actionList=a.actionlist||null;this.items=[];this._buildControl(a.items)},BORDER_WIDTH:1,ICON_SIZE:16,ICONBAR_WIDTH:23,ITEM_BORDER_WIDTH:1,ITEM_HEIGHT:22,ITEM_PADDING:2,MENU_PADDING:1,SEPARATOR_LINE_HEIGHT:1,SEPARATOR_HEIGHT:5,display:function(){this.setDim();this.iconbar.setDim();for(var a=0;a<this.items.length;a++)this.items[a].bar.setDim(),this.items[a].separator||
this.items[a].titlediv.setDim()},layOut:function(){this.height(this.border().height+this.padding().height);for(var a=0;a<this.items.length;a++)this.items[a].separator?this.height(this.height()+this.SEPARATOR_HEIGHT):this.height(this.height()+this.ITEM_HEIGHT);this.top()+this.height()>SUI.browser.viewportHeight&&this.top(SUI.browser.viewportHeight-this.height());this.left()+this.width()>SUI.browser.viewportWidth&&this.left(SUI.browser.viewportWidth-this.width());this.iconbar.setRect(0,0,this.ICONBAR_WIDTH,
this.clientHeight()+this.padding().height);for(var b=0,a=0;a<this.items.length;a++)this.items[a].separator?(this.items[a].bar.setRect(b,0+this.ICONBAR_WIDTH+this.SEPARATOR_HEIGHT,this.clientWidth()-this.ICONBAR_WIDTH- -2*this.SEPARATOR_HEIGHT,(this.SEPARATOR_HEIGHT/2|0)+this.SEPARATOR_LINE_HEIGHT),b+=this.SEPARATOR_HEIGHT):(this.items[a].bar.setRect(b,0,this.clientWidth(),this.ITEM_HEIGHT),this.items[a].titlediv.setRect(0,this.ICONBAR_WIDTH,this.clientWidth()-this.ICONBAR_WIDTH,this.ITEM_HEIGHT),
b+=this.ITEM_HEIGHT,this.items[a].bar.removeClass("sui-popup-item-selected"),this.items[a].bar.removeClass("sui-popup-item-disabled"),SUI.browser.isIE&&this.items[a].titlediv.removeClass("sui-popup-item-disabled"),this._isEnabled(this.items[a])||(this.items[a].bar.addClass("sui-popup-item-disabled"),SUI.browser.isIE&&this.items[a].titlediv.addClass("sui-popup-item-disabled")))},removeMenu:function(){if(SUI.PopupMenu.activeMenu)SUI.PopupMenu.activeMenu._removeMenu(),SUI.PopupMenu.activeMenu.callListener("onRemoveMenu"),
SUI.PopupMenu.activeMenu=null},showMenu:function(a,b){if(this._main){this.removeMenu();var c=this;SUI.browser.addEventListener(document,"mousedown",function(a){c.removeMenu()||SUI.browser.noPropagation(a)});SUI.PopupMenu.activeMenu=this}this.parent({el:function(){return document.body}});this.left(b);this.top(a);this.draw()},onRemoveMenu:function(){},_activeSubmenuItem:null,_addEventHandlers:function(a){var b=this;SUI.browser.addEventListener(a.bar.el(),"mousedown",function(c){b._selectItem(a)||SUI.browser.noPropagation(c)});
SUI.browser.addEventListener(a.bar.el(),"mouseover",function(c){b._highlightItem(a)||SUI.browser.noPropagation(c)});SUI.browser.addEventListener(a.bar.el(),"mouseout",function(c){b._restoreItem(a)||SUI.browser.noPropagation(c)})},_buildControl:function(a){this.border(new SUI.Border(this.BORDER_WIDTH));this.padding(new SUI.Padding(this.MENU_PADDING));this.addClass("sui-popup");this.iconbar=new SUI.Box({parent:this});this.iconbar.addClass("sui-popup-iconbar");for(var b=!1,c=0;c<a.length;c++){var d=
{separator:a[c].separator||!1,icon:a[c].icon||null,enabled:!a[c].disabled||!1,title:a[c].title||"Item "+c,sub:!1};if(void 0!==a[c].actionId&&this._actionList){var e=this._actionList.get(a[c].actionId);d.actionId=a[c].actionId;d.title=e.title;d.icon=e.icon;d.handler=e.handler}else if(void 0!==a[c].handler)d.handler=a[c].handler;else if(void 0!==a[c].items)a[c].sub=!0,d.submenu=new SUI.PopupMenu(a[c]),b=!0;this.items.push(this._createItem(d))}this.width(this.width()+this.ICONBAR_WIDTH+2*(this.ITEM_PADDING+
this.MENU_PADDING+this.ITEM_BORDER_WIDTH+this.BORDER_WIDTH)+(b?this.ICON_SIZE:0))},_createItem:function(a){if(a.separator)a.bar=new SUI.Box({parent:this}),a.bar.border(new SUI.Border(0,0,this.SEPARATOR_LINE_HEIGHT)),a.bar.addClass("sui-popup-separator");else{a.bar=new SUI.Box({parent:this});a.bar.border(new SUI.Border(this.ITEM_BORDER_WIDTH));a.bar.addClass("sui-popup-item");a.titlediv=new SUI.Box({parent:a.bar});a.titlediv.padding(new SUI.Padding(this.ITEM_PADDING));a.titlediv.el().innerHTML=a.title;
if(a.submenu)a.titlediv.el().style.backgroundImage="url("+SUI.imgDir+"/"+SUI.resource.pmSub+")";if(a.icon){var b=document.createElement("IMG");b.src=SUI.imgDir+"/"+a.icon;b.style.padding=this.ITEM_PADDING+"px";a.bar.el().appendChild(b)}this._addEventHandlers(a)}b=SUI.style.textLength(a.title);b>this.width()&&this.width(b);return a},_highlightItem:function(a){if(this._isEnabled(a)){if(this._activeSubmenuItem&&this._activeSubmenuItem!==a)this._activeSubmenuItem.submenu._removeMenu(),this._activeSubmenuItem.bar.removeClass("sui-popup-item-selected"),
this._activeSubmenuItem=null;a.bar.addClass("sui-popup-item-selected");if(a.submenu&&!this._activeSubmenuItem){var b=this.top()+a.bar.top()-this.BORDER_WIDTH,c=this.left()+this.clientWidth();a.submenu.showMenu(b,c);this._activeSubmenuItem=a}}},_isEnabled:function(a){return a.actionId?this._actionList.get(a.actionId).enabled:a.enabled},_removeMenu:function(){if(this._activeSubmenuItem)this._activeSubmenuItem.submenu._removeMenu(),this._activeSubmenuItem=null;this.removeBox()},_restoreItem:function(a){this._activeSubmenuItem!==
a&&a.bar.removeClass("sui-popup-item-selected")},_selectItem:function(a){this._isEnabled(a)&&!a.submenu&&(this.removeMenu(),a.handler(this))}});SUI.Toolbar=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){if(!a.anchor)a.anchor={right:!0,left:!0,top:!0,bottom:!1};if(!a.height)a.height=this.TOOLBAR_HEIGHT;SUI.Toolbar.initializeBase(this,a);this.actionList=a.actionlist||null;this.minHeight(this.height());this.maxHeight(this.height());this._tools=[];for(var b=0;b<a.tools.length;b++)this._tools.push(a.tools[b]),a.tools[b].parent(this),this.actionList&&a.tools[b].setAction&&a.tools[b].setAction(this.actionList);this.border(new SUI.Border(0,
0,this.TOOLBAR_BORDER_BOTTOM_WIDTH,0));this.padding(new SUI.Padding(this.BUTTON_PADDING));var c=this;this.menuButton=new SUI.ToolbarButton({title:"",icon:SUI.resource.tbMenu,handler:function(){c._handleSubMenu()}});this.menuButton.parent(this);this.addClass("sui-tb-toolbar")},BUTTON_PADDING:2,TOOLBAR_BORDER_BOTTOM_WIDTH:1,TOOLBAR_HEIGHT:31,display:function(){this.setDim();for(var a=0;a<this._menuStart&&a<this._tools.length;a++)this._tools[a].display();this.menuButton.setDim()},layOut:function(){this.menuButton.el().style.display=
"none";for(var a=0,b=0;b<this._tools.length;b++)this._tools[b].left(a),this._tools[b].layOut(),this._tools[b].el().style.display="block",a+=this._tools[b].width()+this.BUTTON_PADDING;this._menuStart=this._tools.length;if(a>this.width()){for(b=this._tools.length-1;0<b&&!(a-=this._tools[b].width()+this.BUTTON_PADDING,a<this.width()-this.menuButton.width());b--);for(this._menuStart=b;b<this._tools.length;b++)this._tools[b].el().style.display="none";this.menuButton.left(this.clientWidth()-this.menuButton.width());
this.menuButton.el().style.display="block"}},_menuStart:0,_subMenu:null,_tools:null,_handleSubMenu:function(){if(this._subMenu)this._subMenu.removeMenu(),this._subMenu=null;else{this.menuButton.select(!0);for(var a=[],b=this._menuStart;b<this._tools.length;b++)if(this._tools[b].menuItemData){var c=this._tools[b].menuItemData();a.push(c)}this._subMenu=new SUI.PopupMenu({actionlist:this.actionList,items:a});var d=this;this._subMenu.addListener("onRemoveMenu",function(){d._subMenu=null;d.menuButton.select(!1)});
a=this.menuButton.absPos();this._subMenu.showMenu(a.t+this.menuButton.height()-1,a.l-1)}}});SUI.ToolbarSeparator=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){SUI.Toolbar.initializeBase(this,a);this.width(this.SEPERATOR_WIDTH+2*this.SEPARATOR_PADDING_H);this.height(this.SEPARATOR_HEIGHT);this.line=new SUI.Box({parent:this});this.line.border(new SUI.Border(0,this.SEPERATOR_WIDTH/2|0));this.line.addClass("sui-tb-separator")},SEPARATOR_HEIGHT:26,SEPARATOR_PADDING_H:3,SEPARATOR_PADDING_V:3,SEPERATOR_WIDTH:2,display:function(){this.setDim();this.line.setDim()},layOut:function(){this.line.setRect(this.SEPARATOR_PADDING_V,
this.SEPARATOR_PADDING_H,this.SEPERATOR_WIDTH,this.SEPARATOR_HEIGHT-2*this.SEPARATOR_PADDING_V)},menuItemData:function(){return{separator:!0}}});SUI.ToolbarButton=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){if(!a.width)a.width=this.BUTTON_SIZE;if(!a.height)a.height=this.BUTTON_SIZE;SUI.ToolbarButton.initializeBase(this,a);this._actionId=a.actionId||null;this._handler=a.handler||null;this._title=a.title||null;this._icon=a.icon||null;this.border(new SUI.Border(this.BORDER_WIDTH));this.padding(new SUI.Padding((this.clientWidth()-this.ICON_SIZE)/2|0));var b=document.createElement("IMG");if(this._icon)b.src=SUI.imgDir+"/"+this._icon;
this.el().appendChild(b);this.el().title=this._title||"";this.addClass("sui-tb-button");this.enable(a.disabled?!1:!0);this._addEventListeners()},BUTTON_SIZE:26,ICON_SIZE:16,BORDER_WIDTH:1,enabled:function(){return this._enabled},enable:function(a){(this._enabled=a)?this.removeClass("sui-tb-button-disabled"):this.addClass("sui-tb-button-disabled")},menuItemData:function(){return{icon:this._icon,title:this._title,actionId:this._actionId,handler:this._handler,disabled:!this._enabled}},select:function(a){(this._selected=
a)?this._showPressed():this._showUnpressed()},setAction:function(a){var b=a.get(this._actionId);if(b){if(!this._title)this._title=b.title,this.el().title=this._title||"";if(!this._icon)this._icon=SUI.imgDir+"/"+b.icon,this.el().firstChild.src=this._icon;this.enable(b.enabled);this._handler=b.handler;a.get(this._actionId).listeners.push(this)}},_actionId:null,_handler:null,_icon:null,_selected:!1,_title:null,_addEventListeners:function(){var a=this;SUI.browser.addEventListener(this.el(),"mouseover",
function(b){a._addHighlight()||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this.el(),"mouseout",function(b){a._removeHighlight()||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this.el(),"mousedown",function(b){a._showPressed()||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this.el(),"mouseup",function(b){a._showUnpressed()||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this.el(),"click",function(b){a._execute()||SUI.browser.noPropagation(b)})},
_addHighlight:function(){this.addClass("sui-tb-button-highlight")},_execute:function(){if(this._enabled)this._selected=!1,this._handler&&this._handler()},_removeHighlight:function(){this.removeClass("sui-tb-button-highlight");this._showUnpressed()},_showPressed:function(){this.addClass("sui-tb-button-pressed")},_showUnpressed:function(){this._selected||this.removeClass("sui-tb-button-pressed")}});SUI.TreeView=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){if(!a.anchor)a.anchor={right:!0,left:!0,top:!0,bottom:!0};SUI.TreeView.initializeBase(this,a);this._xhr=a.xhr||this._xhr;this._dataUrl=a.dataUrl||null;this.el().style.overflow="auto";this.addClass("sui-tv");this._openNodes=[]},ROW_HEIGHT:19,ROW_PADDING_TOP:1,ROW_BORDER_WIDTH:1,TEXT_PADDING_LEFT:2,TEXT_PADDING_RIGHT:4,ICONS_SIZE:16,contextMenuData:function(){return this._contextData},iconFunction:function(a){this._iconFunc=a},
loadData:function(a){a.parent=this.el();a.parent.firstChild&&a.parent.removeChild(a.parent.firstChild);a.depth=0;a.dataUrl=this._dataUrl||a.dataUrl;if(a.openNodes)for(var b=0;b<a.openNodes.length;b++)this._openNodes[a.openNodes[b]]=!0;this._loadData(a)},onContextMenu:function(){},onSelect:function(){},onSelectionChange:function(){},selectContextMenuNode:function(){this._selectNode(this._contextNode,this._contextData)},selectedData:function(){return this._selectedData},_selectedData:null,_selectedNode:null,
_contextData:null,_contextNode:null,_addEventListeners:function(a,b,c,d,e,f){var g=this;SUI.browser.addEventListener(a,"click",function(b){g._selectNode(a,f)||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(a,"mouseover",function(b){g._addHighlight(a)||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(a,"mouseout",function(b){g._removeHighlight(a)||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(a,"contextmenu",function(b){g._handleContextMenu(new SUI.Event(this,
b),a,f)||(SUI.browser.noPropagation(b),g._preventDefault(b))});-1!==b.className.indexOf("sui-tv-exp")&&SUI.browser.addEventListener(b,"click",function(b){g._openCloseNode(a,e,f)||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(b,"contextmenu",function(a){g._preventDefault(a)});SUI.browser.addEventListener(d,"contextmenu",function(a){g._preventDefault(a)});SUI.browser.addEventListener(c,"contextmenu",function(a){g._preventDefault(a)})},_addHighlight:function(a){a!==this._selectedNode&&
(SUI.style.addClass(a,"sui-tv-row-highlight"),this._sizeToNodeContents(a))},_createNodeList:function(a,b){var c=SUI.browser.createElement("UL");c.style.position="static";a.parent.appendChild(c);if(a.depth){var d=a.parent.firstChild.firstChild;d.nextSibling.src=SUI.imgDir+"/"+this._iconFunc(a.pType);d.nextSibling.style.backgroundImage="none";d.src=SUI.imgDir+"/"+SUI.resource.tvOpen}for(d=0;d<b.length;d++){var e=SUI.browser.createElement("LI");e.style.position="static";var f=SUI.browser.createElement("DIV");
f.style.position="static";f.style.height=this.ROW_HEIGHT-2*this.ROW_BORDER_WIDTH+"px";f.style.borderTopWidth=f.style.borderBottomWidth=this.ROW_BORDER_WIDTH+"px";f.style.borderLeftWidth=f.style.borderRightWidth="0px";f.style.paddingTop=this.ROW_PADDING_TOP+"px";f.style.paddingLeft=a.depth*this.ICONS_SIZE+"px";SUI.style.addClass(f,"sui-tv-row");var g=SUI.browser.createElement("IMG");g.style.position="static";g.src=SUI.imgDir+"/"+this._iconFunc(b[d].type);var h=SUI.browser.createElement("IMG");h.style.position=
"static";b[d].childListUrl&&""!==b[d].childListUrl?(h.src=this._openNodes[b[d].id]?SUI.imgDir+"/"+SUI.resource.tvOpen:SUI.imgDir+"/"+SUI.resource.tvClosed,SUI.style.addClass(h,"sui-tv-exp")):h.src=SUI.imgDir+"/"+SUI.resource.tvNone;var i=SUI.browser.createElement("SPAN");i.style.cssText=b[d].style;i.style.position="static";i.style.paddingLeft=this.TEXT_PADDING_LEFT+"px";i.style.paddingRight=this.TEXT_PADDING_RIGHT+"px";i.innerHTML=b[d].title;f.appendChild(h);f.appendChild(g);f.appendChild(i);e.appendChild(f);
c.appendChild(e);if(b[d].id==a.selected)SUI.style.addClass(f,"sui-tv-row-selected"),this._selectedData=b[d],this._selectedNode!==f&&this.callListener("onSelectionChange"),this._selectedNode=f;this._addEventListeners(f,h,g,i,a,b[d]);this._openNodes[b[d].id]&&b[d].childListUrl&&""!==b[d].childListUrl&&this._loadData({parent:e,dataUrl:b[d].childListUrl,pType:b[d].type,depth:a.depth+1,selected:a.selected})}},_handleContextMenu:function(a,b,c){this._contextNode=b;this._contextData=c;this.callListener("onContextMenu",
SUI.browser.getX(a.event),SUI.browser.getY(a.event))},_iconFunc:function(a){return 1==a?SUI.resource.tvPage:SUI.resource.tvFolder},_loadData:function(a){if(a.parent.firstChild){var b=a.parent.firstChild.firstChild.nextSibling;b.src=SUI.imgDir+"/"+SUI.resource.tvLoadingAni;b.style.backgroundImage="url("+SUI.imgDir+"/"+SUI.resource.tvLoadingBg+")"}var c=this;this._xhr(a.dataUrl,function(b){c._createNodeList(a,b.data)})},_openCloseNode:function(a,b,c){a.nextSibling?"none"==a.nextSibling.style.display?
(a.nextSibling.style.display="block",a.firstChild.src=SUI.imgDir+"/"+SUI.resource.tvOpen,this._openNodes[c.id]=!0):(a.nextSibling.style.display="none",a.firstChild.src=SUI.imgDir+"/"+SUI.resource.tvClosed,this._openNodes[c.id]=!1):(this._openNodes[c.id]=!0,this._loadData({parent:a.parentNode,dataUrl:c.childListUrl,pType:c.type,depth:b.depth+1}))},_preventDefault:function(a){if(SUI.browser.isIE){if(!a)a=window.event;a.returnValue=!1}else a.preventDefault()},_removeHighlight:function(a){SUI.style.removeClass(a,
"sui-tv-row-highlight")},_selectNode:function(a,b){SUI.style.removeClass(a,"sui-tv-row-highlight");this._selectedNode&&SUI.style.removeClass(this._selectedNode,"sui-tv-row-selected");SUI.style.addClass(a,"sui-tv-row-selected");this._sizeToNodeContents(a);this._selectedData=b;a!==this._selectedNode&&this.callListener("onSelectionChange");this._selectedNode=a;this.callListener("onSelect")},_sizeToNodeContents:function(a){var b=parseInt(a.style.paddingLeft,10);a.style.width=this.el().scrollWidth-b+"px"},
_xhr:function(a,b){SUI.xhr.doGet(a,null,b)}});SUI.TabPanel=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){if(!a.anchor)a.anchor={left:!0,right:!0,top:!0,bottom:!0};SUI.TabPanel.initializeBase(this,a);a.onSelectTab&&this.addListener("onSelectTab",a.onSelectTab);this._buildControl(a)},PANEL_PADDING:4,TAB_BORDER_BOTTOM_WIDTH:1,TAB_BORDER_WIDTH:1,TAB_HILIGHT_HEIGHT:5,TAB_MARGIN_TOP:3,TABBAR_HEIGHT:29,TABTEXT_PADDING_TOP:5,TABTEXT_PADDING_LEFT:7,SCROLL_IMG_PADDING_LEFT:1,SCROLL_IMG_PADDING_TOP:5,SCROLLER_WIDTH:20,SELTAB_MARGIN_TOP:0,add:function(a,
b){this._tabs[b].content.add(a)},display:function(){if(!(0>=this.width()||0>=this.height())){this.setDim();this.tabstripvpt.setDim();this.tabstrip.setDim();for(var a=0;a<this._tabs.length;a++)this._tabs[a].tab.setDim(),this._tabs[a].tabtext.setDim();this.clientArea.setDim();this._selectedTab.content.display();this.highlight.setDim();this.scrollRight.setDim();this.scrollLeft.setDim()}},layOut:function(){this.tabstripvpt.setRect(0,0,this.width(),this.TABBAR_HEIGHT);this.clientArea.setRect(this.TABBAR_HEIGHT,
0,this.width(),this.height()-this.TABBAR_HEIGHT);for(var a=0,b=0;a<this._tabs.length;a++)this._tabs[a].tab.left(b),this._tabs[a].tab.width(this._tabs[a].textLength+2*this.TABTEXT_PADDING_LEFT+2*this.TAB_BORDER_WIDTH),this._tabs[a].tabtext.setRect(this.TABTEXT_PADDING_TOP,this.TABTEXT_PADDING_LEFT,this._tabs[a].textLength,this._tabHeight()-this.TABTEXT_PADDING_TOP-this.TAB_BORDER_WIDTH),this._tabs[a].content.setRect(0,0,this.clientArea.clientWidth(),this.clientArea.clientHeight()),this._selectedTab===
this._tabs[a]?(this._layOutSelectedTab(this._selectedTab),this._tabs[a].content.layOut()):this._layOutNormalTab(this._tabs[a]),b+=this._tabs[a].tab.width()-this.TAB_BORDER_WIDTH;this.tabstrip.setRect(0,0,b+this.TAB_BORDER_WIDTH,this.TABBAR_HEIGHT);this.tabstripvpt.width()<this.tabstrip.width()?(this.scrollRight.el().style.display="block",this.scrollLeft.el().style.display="block",this.scrollRight.setRect(this.TAB_MARGIN_TOP,this.width()-this.SCROLLER_WIDTH,this.SCROLLER_WIDTH,this.TABBAR_HEIGHT-this.TAB_MARGIN_TOP),
this.scrollLeft.setRect(this.scrollRight),this.scrollLeft.left(this.scrollLeft.left()-this.SCROLLER_WIDTH+this.TAB_BORDER_WIDTH),this.tabstrip.width(this.tabstrip.width()+2*this.SCROLLER_WIDTH),this._enableScrollers()):(this.scrollRight.el().style.display="none",this.scrollLeft.el().style.display="none",this.tabstrip.width(this.tabstripvpt.width()))},onSelectTab:function(){},clientAreaPosition:function(){return{top:this.TABBAR_HEIGHT+this.clientArea.border().top+this.clientArea.padding().top,left:this.clientArea.border().left+
this.clientArea.padding().left,right:this.clientArea.border().right+this.clientArea.padding().right,bottom:this.clientArea.border().bottom+this.clientArea.padding().bottom}},selectedTab:function(a){return void 0!==a?(this._selectedTab=a)&&null:this._selectedTab},selectedTabIndex:function(a){return void 0!==a?(this._selectedTab=this._tabs[a])&&null:this._tabs.indexOf(this._selectedTab)},selectTab:function(a){this._selectedTab=a;this.callListener("onSelectTab",a);this.draw()},_selectedTab:null,_addOnClickTab:function(a){var b=
this;SUI.browser.addEventListener(a.tab.el(),"click",function(c){b.selectTab(a)||SUI.browser.noPropagation(c)})},_buildControl:function(a){this._tabs=[];this.addClass("sui-tp-tabpanel");this.tabstripvpt=new SUI.Box({parent:this});this.tabstripvpt.el().style.overflow="hidden";this.tabstripvpt.addClass("sui-tp-tabstripvpt");this.tabstrip=new SUI.Box({parent:this.tabstripvpt});this.tabstrip.border(new SUI.Border(0,0,this.TAB_BORDER_BOTTOM_WIDTH,0));this.tabstrip.addClass("sui-tp-tabstrip");this.clientArea=
new SUI.Box({parent:this});this.clientArea.addClass("sui-tp-border");this.clientArea.border(new SUI.Border(0,this.TAB_BORDER_WIDTH,this.TAB_BORDER_WIDTH));this.clientArea.padding(new SUI.Padding(a.panelMargin||this.PANEL_PADDING));for(var b=0;b<a.tabs.length;b++){var c={title:"Item "+b,box:null},d;for(d in a.tabs[b])a.tabs[b].hasOwnProperty(d)&&(c[d]=a.tabs[b][d]);this._createTab(c);if(b===a.selected)this._selectedTab=c;this._tabs.push(c);c.box&&this.add(c.box,b)}this.highlight=new SUI.Box({parent:this.tabstripvpt});
this.highlight.border(new SUI.Border(this.TAB_BORDER_WIDTH));this.highlight.addClass("sui-tp-tabhighlight");if(!this._selectedTab&&this._tabs.length)this._selectedTab=this._tabs[0];if(!this._selectedTab)throw"SUI.TabPanel: index for selected tab out of range";this.scrollLeft=this._createScroller(SUI.resource.tpScrollLeft,this._scrollLeft);this.scrollRight=this._createScroller(SUI.resource.tpScrollRight,this._scrollRight)},_createTab:function(a){a.tab=new SUI.Box({parent:this.tabstripvpt});a.tab.addClass("sui-tp-tab");
a.tab.border(new SUI.Border(this.TAB_BORDER_WIDTH,this.TAB_BORDER_WIDTH,0,this.TAB_BORDER_WIDTH));a.textLength=SUI.style.textLength(a.title);a.tabtext=new SUI.TextBox({parent:a.tab,text:a.title});a.content=new SUI.AnchorLayout({parent:this.clientArea});a.content.addClass("sui-tp-tabcontent");a.content.el().style.overflow="auto";a.content.el().style.backgroundColor="transparent";a.content.el().style.display="none";this._addOnClickTab(a)},_createScroller:function(a,b){var c=this,d=new SUI.Box({parent:this});
d.addClass("sui-tp-scroller");d.border(new SUI.Border(this.TAB_BORDER_WIDTH,this.TAB_BORDER_WIDTH,this.TAB_BORDER_BOTTOM_WIDTH));var e=document.createElement("IMG");e.src=SUI.imgDir+"/"+a;e.style.marginTop=this.SCROLL_IMG_PADDING_TOP+"px";e.style.marginLeft=this.SCROLL_IMG_PADDING_LEFT+"px";d.el().appendChild(e);SUI.browser.addEventListener(d.el(),"click",function(a){b.call(c)||SUI.browser.noPropagation(a)});return d},_enableScrollers:function(){this.tabstripvpt.el().scrollLeft?this.scrollLeft.removeClass("sui-tp-scroller-disabled"):
this.scrollLeft.addClass("sui-tp-scroller-disabled");this._tabRight(this._tabs[this._tabs.length-1])<this._leftScrollerLeft()?this.scrollRight.addClass("sui-tp-scroller-disabled"):this.scrollRight.removeClass("sui-tp-scroller-disabled")},_layOutNormalTab:function(a){a.tab.removeClass("sui-tp-tabselected");a.tab.setRect(this.TAB_MARGIN_TOP,a.tab.left(),a.tab.width(),this._tabHeight());a.tabtext.top(this.TABTEXT_PADDING_TOP);a.content.el().style.display="none"},_layOutSelectedTab:function(a){a.tab.addClass("sui-tp-tabselected");
a.tab.setRect(this.SELTAB_MARGIN_TOP,a.tab.left(),a.tab.width(),this.TABBAR_HEIGHT-this.SELTAB_MARGIN_TOP);a.tabtext.top(this.TABTEXT_PADDING_TOP+this.TAB_MARGIN_TOP-this.SELTAB_MARGIN_TOP);a.content.el().style.display="block";this.highlight.setRect(a.tab);this.highlight.height(this.TAB_HILIGHT_HEIGHT)},_leftScrollerLeft:function(){return this.tabstripvpt.el().scrollLeft+this.scrollLeft.left()},_scrollLeft:function(){for(var a=0;a<this._tabs.length&&!(this._tabRight(this._tabs[a])>=this._leftScrollerLeft());a++);
this.tabstripvpt.el().scrollLeft=this._tabs[a].tab.left()-this.scrollLeft.left()+this.TAB_BORDER_WIDTH;this._enableScrollers()},_scrollRight:function(){for(var a=0;a<this._tabs.length-1&&!(this._tabRight(this._tabs[a])>this._leftScrollerLeft());a++);this.tabstripvpt.el().scrollLeft=this._tabRight(this._tabs[a])-this.scrollLeft.left();this._enableScrollers()},_tabHeight:function(){return this.TABBAR_HEIGHT-this.TAB_BORDER_BOTTOM_WIDTH-this.TAB_MARGIN_TOP},_tabRight:function(a){return a.tab.left()+
a.tab.width()}});SUI.ListView=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){if(!a.anchor)a.anchor={right:!0,left:!0,top:!0,bottom:!0};SUI.ListView.initializeBase(this,a);this._buildControl(a)},CELL_PADDING_TOP:1,CELL_PADDING_SIDES:5,HEADER_BORDER_BOTTOM_WIDTH:1,HEADER_HEIGHT:21,HEADER_PADDING_TOP:2,HEADER_PADDING_SHORT:2,HEADER_PADDING_LONG:16,HEADER_SORT_ICON_MARGIN_TOP:2,HEADER_SORT_ICON_SIZE:16,HEADER_SPACER_WIDTH:3,ICON_SIZE:16,SEPARATOR_MARGIN_V:3,SEPARATOR_WIDTH:2,ROW_BORDER_WIDTH:1,ROW_HEIGHT:20,
display:function(){this.setDim();this.headervpt.setDim();this.header.setDim();for(var a=0;a<this.colums.length;a++)this.colums[a].header.setDim(),this.colums[a].headerTitle.setDim(),this.colums[a].spacer.setDim(),this.colums[a].separator.setDim();this.listvpt.setDim();this.list.setDim();this._firstDisplay&&this._focussedRow?this._scrollIntoView(this._focussedRow)||this._renderRows():this._renderRows();this._firstDisplay=!1},layOut:function(){var a=this.HEADER_HEIGHT-this.HEADER_BORDER_BOTTOM_WIDTH;
this.headervpt.setRect(0,0,this.width(),this.HEADER_HEIGHT);this.header.setRect(0,0,1E4,a);for(var b=0,c=0;c<this.colums.length;c++){this.colums[c].left=b;var d=this.colums[c].width-2*this.HEADER_SPACER_WIDTH;this.colums[c].header.setRect(0,b+this.HEADER_SPACER_WIDTH,d,a);this.colums[c].spacer.setRect(0,b+this.HEADER_SPACER_WIDTH+d,2*this.HEADER_SPACER_WIDTH,a);this.colums[c].separator.setRect(this.SEPARATOR_MARGIN_V,this.HEADER_SPACER_WIDTH-this.SEPARATOR_WIDTH/2,this.SEPARATOR_WIDTH,a-2*this.SEPARATOR_MARGIN_V);
var b=b+this.colums[c].width,e=d=0;"right"===this.colums[c].align?(d=this.HEADER_PADDING_LONG,e=this.HEADER_PADDING_SHORT,this.colums[c].header.addClass("sui-lv-header-sort-left"),this.colums[c].header.el().style.backgroundPosition="0px "+this.HEADER_SORT_ICON_MARGIN_TOP+"px"):(d=this.HEADER_PADDING_SHORT,e=this.HEADER_PADDING_LONG,this.colums[c].header.addClass("sui-lv-header-sort-right"),this.colums[c].header.el().style.backgroundPosition=this.colums[c].width-this.HEADER_SORT_ICON_SIZE-2*this.HEADER_SPACER_WIDTH+
"px "+this.HEADER_SORT_ICON_MARGIN_TOP+"px");this.colums[c].headerTitle.setRect(this.HEADER_PADDING_TOP,d,this.colums[c].header.width()-e-d,this.colums[c].header.height()-this.HEADER_PADDING_TOP)}this.listvpt.setRect(this.HEADER_HEIGHT,0,this.width(),this.height()-this.HEADER_HEIGHT);this.list.setRect(0,0,b,this.list.height());this._rowDraw++},loadData:function(a,b,c){var d=this.list.width();this.list.removeBox();this.list=new SUI.Box({parent:this.listvpt});this.list.el().style.overflow="visible";
this.listvpt.el().style.backgroundImage="none";this.listvpt.removeClass("sui-lv-loading");this.data=a?a:[];this.list.setRect(0,0,d,this.data.length*this.ROW_HEIGHT);for(a=0;a<this.data.length;a++)this.data[a].rowPtr={row:null,drw:0,sel:!1,cells:[]};d=[];void 0!==b&&b&&(d=this._multiselect?b:[b[0]]);b=void 0!==c?this.data[c]:null;this._focussedRow=null;this.selectedRows=[];if(b)this.data[c].rowPtr.sel=!0,this.selectedRows.push(this.data[c]);if(this._multiselect||1!==this.selectedRows.length)for(a=
0;a<d.length;a++)if(a!==c)this.data[d[a]].rowPtr.sel=!0,this.selectedRows.push(this.data[d[a]]);this._sortCol&&this._sort();this._focussedRow=b},onClick:function(){},onDblClick:function(){},onContextMenu:function(){},onSelectionChange:function(){},setIsLoadingImage:function(){var a=this.list.width(),b=this.list.height();this.list.removeBox();this.list=new SUI.Box({parent:this.listvpt});this.list.setRect(0,0,a,b);this.listvpt.addClass("sui-lv-loading");this.listvpt.el().style.backgroundImage="url("+
SUI.imgDir+"/"+SUI.resource.lvLoading+")"},_firstDisplay:!0,_focussedRow:null,_isFocussed:!1,_multiselect:!0,_multiSelStartRow:null,_rowDraw:0,_rowDrawing:!1,_scrollBarWidth:0,_scrollOffsetLeft:0,_scrollOffsetTop:0,_sortCol:null,_sortUp:!0,_addFocusRectangle:function(){this._isFocussed=!0;this._focussedRow&&this._focussedRow.rowPtr.row&&this._focussedRow.rowPtr.row.addClass("sui-lv-row-focus")},_addHeaderEventHandlers:function(a){var b=this;SUI.browser.addEventListener(a.header.el(),"click",function(c){b._sortColumn(a)||
SUI.browser.noPropagation(c)});SUI.browser.addEventListener(a.header.el(),"mousedown",function(c){b._highlightHeader(a.header)||SUI.browser.noPropagation(c)});SUI.browser.addEventListener(a.spacer.el(),"mousedown",function(c){b._resizeColumn(new SUI.Event(this,c),a)||SUI.browser.noPropagation(c)});SUI.browser.addEventListener(a.header.el(),"mouseout",function(c){b._restoreHeader(a.header)||SUI.browser.noPropagation(c)});SUI.browser.addEventListener(a.header.el(),"mouseup",function(c){b._restoreHeader(a.header)||
SUI.browser.noPropagation(c)})},_addListEventHandlers:function(){var a=this;SUI.browser.addEventListener(this.el(),"focus",function(b){a._addFocusRectangle(new SUI.Event(this,b))||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this.el(),"blur",function(b){a._removeFocusRectangle(new SUI.Event(this,b))||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this.el(),"keydown",function(b){SUI.browser.isGecko||a._handleKeyStroke(new SUI.Event(this,b))||SUI.browser.noPropagation(b)});
SUI.browser.addEventListener(this.listvpt.el(),"keypress",function(b){SUI.browser.isGecko&&(a._handleKeyStroke(new SUI.Event(this,b))||SUI.browser.noPropagation(b))});SUI.browser.addEventListener(this.listvpt.el(),"scroll",function(b){a._handleScroll(new SUI.Event(this,b))||SUI.browser.noPropagation(b)})},_addRowEventHandlers:function(a){var b=this;SUI.browser.addEventListener(a.rowPtr.row.el(),"click",function(c){b._handleRowClick(new SUI.Event(this,c),a)||SUI.browser.noPropagation(c)});SUI.browser.addEventListener(a.rowPtr.row.el(),
"contextmenu",function(c){b._handleRowContextMenu(new SUI.Event(this,c),a)||SUI.browser.noPropagation(c)});SUI.browser.addEventListener(a.rowPtr.row.el(),"dblclick",function(c){b._handleRowDblClick(new SUI.Event(this,c),a)||SUI.browser.noPropagation(c)})},_buildColumns:function(a){for(var b=0;b<a.cols.length;b++){var c={title:"Kolom "+b,key:b,width:100,minWidth:10,maxWidth:1E3,icon:!1,align:"left",sort:"text",format_func:null},d;for(d in a.cols[b])a.cols[b].hasOwnProperty(d)&&(c[d]=a.cols[b][d]);
this.colums.push(c)}for(b=0;b<this.colums.length;b++)if(this.colums[b].header=new SUI.Box({parent:this.header}),this.colums[b].headerTitle=new SUI.TextBox({parent:this.colums[b].header}),this.colums[b].headerTitle.text(this.colums[b].title),this.colums[b].headerTitle.el().style.overflow="hidden",this.colums[b].headerTitle.el().style.whiteSpace="nowrap",this.colums[b].headerTitle.el().style.textAlign=this.colums[b].align,this.colums[b].spacer=new SUI.Box({parent:this.header}),this.colums[b].spacer.addClass("sui-lv-header-spacer"),
this.colums[b].spacer.el().style.cursor="col-resize",this.colums[b].separator=new SUI.Box({parent:this.colums[b].spacer}),this.colums[b].separator.border(new SUI.Border(0,this.SEPARATOR_WIDTH/2|0)),this.colums[b].separator.addClass("sui-lv-header-separator"),this._addHeaderEventHandlers(this.colums[b]),a.sort&&this.colums[b].key===a.sort)this._sortCol=this.colums[b],this.colums[b].header.el().style.backgroundImage="url("+SUI.imgDir+"/"+this.ICON_SORT_UP+")"},_buildControl:function(a){this.selectedRows=
[];this._scrollBarWidth=SUI.style.scrollbarWidth();this.colums=[];if(void 0!==a.multiselect)this._multiselect=a.multiselect;this.el().tabIndex=1;this.addClass("no-focus");this.headervpt=new SUI.Box({parent:this});this.headervpt.border(new SUI.Border(0,0,this.HEADER_BORDER_BOTTOM_WIDTH,0));this.headervpt.addClass("sui-lv-header");this.headervpt.el().style.overflow="hidden";this.header=new SUI.Box({parent:this.headervpt});this.listvpt=new SUI.Box({parent:this});this.listvpt.addClass("no-focus");this.listvpt.addClass("sui-lv-viewport");
this.listvpt.el().style.overflow="auto";this.listvpt.el().tabIndex=-1;this.list=new SUI.Box({parent:this.listvpt});this._addListEventHandlers();this._buildColumns(a);this.loadData(a.data,a.selected,a.focussed)},_createCell:function(a,b,c,d){var e=new SUI.TextBox({parent:a.row});e.text(c.format_func?c.format_func(b,c.key):b[c.key]?b[c.key]:"");e.el().style.textAlign=c.align;e.el().style.overflow="hidden";e.el().style.whiteSpace="nowrap";var f=this;SUI.browser.addEventListener(e.el(),"mouseover",function(a){f._setTitleOnOverflow(e)||
SUI.browser.noPropagation(a)});c.icon?(b=c.icon instanceof Function?c.icon(b,c.key):b[c.icon],e.el().style.backgroundImage="url("+SUI.imgDir+"/"+b+")",e.padding(new SUI.Padding(this.CELL_PADDING_TOP,this.CELL_PADDING_SIDES,0,this.ICON_SIZE+this.CELL_PADDING_SIDES))):e.padding(new SUI.Padding(this.CELL_PADDING_TOP,this.CELL_PADDING_SIDES,0));a.cells[d]=e},_deSelectRows:function(a){if(void 0!==a)a.rowPtr.row&&a.rowPtr.row.removeClass("sui-lv-row-selected"),a.rowPtr.sel=!1,a=this.selectedRows.indexOf(a),
-1!==a&&this.selectedRows.splice(a,1);else{for(a=0;a<this.selectedRows.length;a++)this.selectedRows[a].rowPtr.row&&this.selectedRows[a].rowPtr.row.removeClass("sui-lv-row-selected"),this.selectedRows[a].rowPtr.sel=!1;this.selectedRows=[]}},_handleRowClick:function(a,b){this._selectAndFocusRows(b,a.event.ctrlKey,a.event.shiftKey);this.callListener("onClick",b)},_handleRowContextMenu:function(a,b){-1===this.selectedRows.indexOf(b)&&this._selectAndFocusRows(b,a.event.ctrlKey,a.event.shiftKey);this.callListener("onContextMenu",
SUI.browser.getX(a.event),SUI.browser.getY(a.event))},_handleRowDblClick:function(a,b){this._selectAndFocusRows(b,a.event.ctrlKey,a.event.shiftKey);this.callListener("onDblClick",b)},_handleScroll:function(a){if(this._scrollOffsetLeft!==a.target.scrollLeft)this._scrollOffsetLeft=a.target.scrollLeft,this.headervpt.el().scrollLeft=this._scrollOffsetLeft;if(this._scrollOffsetTop!==a.target.scrollTop)this._scrollOffsetTop=a.target.scrollTop,this._renderRows()},_endDrag:function(a,b){a.removeBox();b.width=
a.left()-b.left+this.HEADER_SPACER_WIDTH;this.draw()},_focusRow:function(a){if(this._focussedRow!==a)this._focussedRow&&this._focussedRow.rowPtr.row&&this._focussedRow.rowPtr.row.removeClass("sui-lv-row-focus"),(this._focussedRow=a)&&this._focussedRow.rowPtr.row&&this._focussedRow.rowPtr.row.addClass("sui-lv-row-focus")},_getRowIndexNextPage:function(a){var b=this.data.indexOf(this._focussedRow),c=this.listvpt.height()/this.ROW_HEIGHT|0;34===a&&(b+=c,b>this.data.length-1&&(b=this.data.length-1));
33===a&&(b-=c,0>b&&(b=0));return b},_getRowIndexNextRow:function(a){var b=this.data.indexOf(this._focussedRow);40===a&&b<this.data.length-1&&b++;38===a&&0<b&&b--;return b},_highlightHeader:function(a){a.addClass("sui-lv-header-button-pressed")},_handleKeyStroke:function(a){var b=!0;this._setMultiSelStartRow(a.event.ctrlKey,a.event.shiftKey);var c=a.event.keyCode?a.event.keyCode:a.event.charCode;switch(c){case 40:case 38:b=this._selectNextRow(c,a.event.ctrlKey,a.event.shiftKey);break;case 32:b=this._toggleSelection(c,
a.event.ctrlKey);break;case 34:case 33:b=this._selectNextPageRow(c);break;case 65:case 97:b=this._selectAll(c,a.event.ctrlKey)}if(!b)SUI.browser.isIE?a.event.returnValue=!1:a.event.preventDefault();return b},_removeFocusRectangle:function(){this._isFocussed=!1;this._focussedRow&&this._focussedRow.rowPtr.row&&this._focussedRow.rowPtr.row.removeClass("sui-lv-row-focus")},_renderRows:function(){if(!this._rowDrawing){this._rowDrawing=!0;for(var a=this.listvpt.el().scrollTop/this.ROW_HEIGHT|0,b=this.height()/
this.ROW_HEIGHT|0,c=a;c<a+b&&c<this.data.length;c++){var d=0,e=this.data[c],f=e.rowPtr;if(f.drw!==this._rowDraw){if(0===f.drw)f.row=new SUI.Box({parent:this.list}),f.row.el().style.display="none",f.row.addClass("sui-lv-row"),f.row.border(new SUI.Border(this.ROW_BORDER_WIDTH,0)),e.rowPtr=f,this._addRowEventHandlers(e);for(var g=0;g<this.colums.length;g++){0===f.drw&&this._createCell(f,e,this.colums[g],g);var h=this.colums[g].width;f.cells[g].setRect(0,d,h,this.ROW_HEIGHT-2*this.ROW_BORDER_WIDTH-this.CELL_PADDING_TOP);
d+=h;f.cells[g].setDim()}f.row.removeClass("sui-lv-row-even");f.row.removeClass("sui-lv-row-odd");f.row.addClass("sui-lv-row sui-lv-row-"+(c%2?"even":"odd"));d<this.width()&&(d=this.width()-(this.listvpt.height()<this.list.height()?this._scrollBarWidth:0));f.row.setRect(this.ROW_HEIGHT*c,0,d,this.ROW_HEIGHT);f.row.setDim();this._focussedRow&&this._isFocussed&&f===this._focussedRow.rowPtr&&f.row.addClass("sui-lv-row-focus");f.sel&&f.row.addClass("sui-lv-row-selected");f.drw=this._rowDraw;f.row.el().style.display=
"block"}}this._rowDrawing=!1}},_resizeColumn:function(a,b){var c=b.left-this.HEADER_SPACER_WIDTH,d=c+b.minWidth;if(d<this.headervpt.el().scrollLeft)d=this.headervpt.el().scrollLeft;c+=b.maxWidth;c>this.headervpt.width()+this.headervpt.el().scrollLeft-2*this.HEADER_SPACER_WIDTH&&(c=this.headervpt.width()+this.headervpt.el().scrollLeft-2*this.HEADER_SPACER_WIDTH);var e=new SUI.Dragger({parent:this.header});e.setRect(b.spacer);e.addClass("sui-lv-header-dragger");e.el().style.cursor=b.spacer.el().style.cursor;
e.direction(e.HORIZONTAL);e.xMin(d);e.xMax(c);e.setDim();var f=this;e.addListener("onEndDrag",function(){f._endDrag(e,b)});e.start(a,this)},_restoreHeader:function(a){a.removeClass("sui-lv-header-button-pressed")},_scrollIntoView:function(a){var b=!1;if(a){a=this.data.indexOf(a);if((a+1)*this.ROW_HEIGHT>this._scrollOffsetTop+this.listvpt.el().clientHeight)this._scrollOffsetTop=(a+1)*this.ROW_HEIGHT-this.listvpt.el().clientHeight,this.listvpt.el().scrollTop=this._scrollOffsetTop,this._renderRows(),
b=!0;if(a*this.ROW_HEIGHT<this._scrollOffsetTop)this._scrollOffsetTop=a*this.ROW_HEIGHT,this.listvpt.el().scrollTop=this._scrollOffsetTop,this._renderRows(),b=!0}return b},_selectAll:function(a,b){if(this._multiselect&&b){for(var c=0;c<this.data.length;c++)this._selectRow(this.data[c]);this._rowDraw++;this._renderRows();return!1}return!0},_selectAndFocusRows:function(a,b,c){this._setMultiSelStartRow(b,c);if(this._multiselect&&c&&this._multiSelStartRow){c=this.data.indexOf(this._multiSelStartRow);
b=this.data.indexOf(a);if(c>b)var d=c,c=b,b=d;for(this._deSelectRows();c<=b;c++)this._selectRow(this.data[c])}else this._multiselect&&b?a.rowPtr.sel?this._deSelectRows(a):this._selectRow(a):(this._deSelectRows(),this._selectRow(a));this._focusRow(a)},_selectNextPageRow:function(a){return this._focussedRow?(a=this._getRowIndexNextPage(a),this._deSelectRows(),this._selectRow(this.data[a]),this._focusRow(this.data[a]),this._scrollIntoView(this._focussedRow),!1):!0},_selectNextRow:function(a,b,c){if(this._focussedRow){if(0===
this.selectedRows.length)this._selectRow(this._focussedRow);else{a=this._getRowIndexNextRow(a);if(this._multiselect&&c){c=this.data.indexOf(this._multiSelStartRow);b=this.data.indexOf(this.data[a]);if(c>b)var d=c,c=b,b=d;for(this._deSelectRows();c<=b;c++)this._selectRow(this.data[c])}else if(!this._multiselect||!b)this._deSelectRows(),this._selectRow(this.data[a]);this._focusRow(this.data[a])}this._scrollIntoView(this._focussedRow)}else this._focusRow(this.data[0]);return!1},_selectRow:function(a){if(this.selectedRows[this.selectedRows.length-
1]!==a)this.selectedRows.push(a),a.rowPtr.row&&a.rowPtr.row.addClass("sui-lv-row-selected"),this.callListener("onSelectionChange"),a.rowPtr.sel=!0},_setMultiSelStartRow:function(a,b){if(this._multiselect&&(a||b)){if(!this._multiSelStartRow)this._multiSelStartRow=this._focussedRow}else this._multiSelStartRow=null},_setTitleOnOverflow:function(a){var b=a.el().clientWidth-a.el().scrollWidth;a.el().title=0<=b?"":a.text().replace(/<[^>]+>/g,"")},_sortColumn:function(a){if(a!==this._sortCol){if(this._sortCol)this._sortCol.header.el().style.backgroundImage=
"";this._sortUp=!0;this._sortCol=a}else this._sortUp=!this._sortUp;this._sort();this.draw()},_sort:function(){var a=this._sortCol.key,b=this._sortUp?1:-1;this._sortCol.header.el().style.backgroundImage=this._sortUp?"url("+SUI.imgDir+"/"+SUI.resource.lvSortUp+")":"url("+SUI.imgDir+"/"+SUI.resource.lvSortDown+")";for(var c=0;c<this.data.length;c++)if(this.data[c].rowPtr.row)this.data[c].rowPtr.row.el().style.display="none";"text"===this._sortCol.sort?this.data.sort(function(c,e){var f=""+c[a],g=""+
e[a];return b*(f.toLowerCase()<g.toLowerCase()?-1:f.toLowerCase()>g.toLowerCase()?1:0)}):"number"===this._sortCol.sort?this.data.sort(function(c,e){return b*(c[a]-e[a])}):this._sortCol.sort(this.data,a,b);this._scrollIntoView(this._focussedRow)},_toggleSelection:function(a,b){return this._multiselect&&this._focussedRow&&b?(this._focussedRow.rowPtr.sel?this._deSelectRows(this._focussedRow):this._selectRow(this._focussedRow),!1):!0}});SUI.form.Form=SUI.defineClass({baseClass:SUI.AnchorLayout,initializer:function(a){a.tag="FORM";a.elemAttr={method:"post",enctype:a.upload?"multipart/form-data":null,encoding:a.upload?"multipart/form-data":null,action:a.action||null,target:a.target||null};SUI.form.Form.initializeBase(this,a)}});SUI.form.Input=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){a.tag="INPUT";a.height=a.height||this.HEIGHT;a.width=a.width||this.WIDTH;SUI.form.Input.initializeBase(this,a);this.border(null);if(a.maxLength)this.el().maxLength=a.maxLength;if(a.name)this.el().name=a.name},HEIGHT:22,WIDTH:200,display:function(){this.setPos();this.el().style.width=this.width()+(this.el().clientWidth-this.el().offsetWidth)+"px";this.el().style.height=this.height()+(this.el().clientHeight-this.el().offsetHeight)+
"px"}});SUI.form.TextArea=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){a.tag="TEXTAREA";a.height=a.height||this.HEIGHT;a.width=a.width||this.WIDTH;SUI.form.TextArea.initializeBase(this,a);this.border(null);if(a.name)this.el().name=a.name},HEIGHT:50,WIDTH:200,display:function(){this.setPos();this.el().style.width=this.width()+(this.el().clientWidth-this.el().offsetWidth)+"px";this.el().style.height=this.height()+(this.el().clientHeight-this.el().offsetHeight)+"px"}});SUI.form.Button=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){a.height=a.height||this.HEIGHT;a.width=a.width||this.WIDTH;a.tag="BUTTON";a.elemAttr={type:"button"};SUI.form.Button.initializeBase(this,a);this.border(null);this.span=SUI.browser.createElement("SPAN");this.span.style.position="relative";this.span.innerHTML=a.title||"";this.el().appendChild(this.span)},WIDTH:100,HEIGHT:26});SUI.form.RadioButton=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){a.tag="INPUT";a.elemAttr={type:"radio",checked:a.checked||null,name:a.name||null};SUI.form.RadioButton.initializeBase(this,a)},TOP_PATCH:2,display:function(){this.el().style.top=this.TOP_PATCH+this.top()+"px";this.el().style.left=this.left()+"px"}});SUI.form.CheckBox=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){a.tag="INPUT";a.elemAttr={type:"checkbox",checked:a.checked||null,name:a.name||null};SUI.form.CheckBox.initializeBase(this,a)},TOP_PATCH:2,display:function(){this.el().style.top=this.TOP_PATCH+this.top()+"px";this.el().style.left=this.left()+"px"}});SUI.form.SelectList=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){a.tag="SELECT";a.height=a.height||this.HEIGHT;a.width=a.width||this.WIDTH;SUI.form.SelectList.initializeBase(this,a);this.border(null);if(a.name)this.el().name=a.name;a.options&&this.options(a.options)},HEIGHT:20,WIDTH:150,options:function(a){if(this.el().options.length)this.el().options.length=0;for(var b=0;b<a.length;b++){var c=void 0!==a[b].value?a[b].value:b;this.el().options[this.el().options.length]=new Option(a[b].text,
c,!1,a[b].checked||!1)}}});SUI.form.Label=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){a.tag="LABEL";a.height=a.height||this.HEIGHT;SUI.form.Label.initializeBase(this,a);this.forBox(a.forBox||null);this.el().innerHTML=a.title||"";this.el().style.overflow="hidden";this.el().style.whiteSpace="nowrap";var b=this;SUI.browser.addEventListener(this.el(),"mouseover",function(a){b._setTitleOnOverflow()||SUI.browser.noPropagation(a)})},HEIGHT:20,TOP_PATCH:2,forBox:function(a){return void 0!==a?(this._forBox=a)&&null:this._forBox},
display:function(){SUI.form.Label.parentMethod(this,"display");this.el().style.top=this.TOP_PATCH+parseInt(this.el().style.top,10)+"px"},layOut:function(){this._forBox&&this.el().setAttribute("for",this._forBox.el().id);SUI.form.Label.parentMethod(this,"layOut")},_forBox:null,_lTop:0,_setTitleOnOverflow:function(){var a=this.el().clientWidth-this.el().scrollWidth;this.el().title=0<=a?"":this.el().innerHTML.replace(/<[^>]+>/g,"")}});SUI.dialog.OKCancelDialog=SUI.defineClass({baseClass:SUI.Window,initializer:function(a){a.height=a.height||this.HEIGHT;a.width=a.width||this.WIDTH;a.resizable=a.resizable||!1;SUI.dialog.OKCancelDialog.initializeBase(this,a);this.splitLayout=new SUI.SplitLayout({south:{height:this.BUTTON_BAR_HEIGHT}});this.clientPanel=new SUI.Panel({minHeight:20,minWidth:100,padding:new SUI.Padding(this.EXTRA_WINDOW_BORDER),innerBorder:new SUI.Border(this.PANEL_BORDER)});this.buttonPanel=new SUI.AnchorLayout({});this.cancelButton=
new SUI.form.Button({top:this.EXTRA_WINDOW_BORDER,right:this.EXTRA_WINDOW_BORDER,width:100,anchor:{right:!0},title:SUI.i18n.cancel});this.okButton=new SUI.form.Button({top:this.EXTRA_WINDOW_BORDER,right:112,width:100,anchor:{right:!0},title:SUI.i18n.ok});this.extraButton=new SUI.form.Button({top:this.EXTRA_WINDOW_BORDER,right:220,width:100,anchor:{right:!0},title:""});this.extraButton.el().style.display="none";this.add(this.splitLayout);this.splitLayout.add(this.clientPanel,"center");this.splitLayout.add(this.buttonPanel,
"south");this.buttonPanel.add(this.extraButton);this.buttonPanel.add(this.okButton);this.buttonPanel.add(this.cancelButton);a.clientWidth&&this.setClientWidth(a.clientWidth);a.clientHeight&&this.setClientHeight(a.clientHeight);var b=this;a.onOK&&this.addListener("onOK",a.onOK);a.onCancel&&this.addListener("onCancel",a.onCancel);a.onDataSaved&&this.addListener("onDataSaved",a.onDataSaved);this.onEnter=function(){b._handleOK()};SUI.browser.addEventListener(this.okButton.el(),"click",function(a){b._handleOK()||
SUI.browser.noPropagation(a)});this.onEsc=function(){b._handleCancel()};SUI.browser.addEventListener(this.cancelButton.el(),"click",function(a){b._handleCancel()||SUI.browser.noPropagation(a)});this.addListener("onClose",function(){this.callListener("onCancel")})},EXTRA_WINDOW_BORDER:4,PANEL_BORDER:1,BUTTON_BAR_HEIGHT:34,HEIGHT:117,WIDTH:340,addExtraButton:function(a,b){this.extraButton.el().innerHTML=a;this.extraButton.el().style.display="block";SUI.browser.addEventListener(this.extraButton.el(),
"click",function(a){b(new SUI.Event(this,a))||SUI.browser.noPropagation(a)})},formToData:function(){this.close();return null},onOK:function(){},onCancel:function(){},setClientWidth:function(a){var b=this.clientAreaPosition();this.width(a+b.left+b.right+2*(this.EXTRA_WINDOW_BORDER+this.PANEL_BORDER));this.center()},setClientHeight:function(a){var b=this.clientAreaPosition();this.height(a+b.top+b.bottom+2*(this.EXTRA_WINDOW_BORDER+this.PANEL_BORDER)+this.BUTTON_BAR_HEIGHT);this.center()},dataSaved:function(){this.callListener("onDataSaved");
this.close()},_okClicked:!1,_handleCancel:function(){this.callListener("onCancel");this.close()},_handleOK:function(){if(!this._okClicked&&!this.okButton.el().disabled){this._okClicked=!0;var a=this;setTimeout(function(){a._okClicked=!1},2E3);this.callListener("onOK",this.formToData())}}});SUI.dialog.Confirm=SUI.defineClass({baseClass:SUI.dialog.OKCancelDialog,initializer:function(a){SUI.dialog.Confirm.initializeBase(this,a);this.setClientHeight(this.ICON_SIZE+2*this.ICON_PADDING);this.text=new SUI.TextBox({left:this.ICON_SIZE+2*this.TEXT_PADDING,right:this.TEXT_PADDING,bottom:this.TEXT_PADDING,top:this.TEXT_PADDING,anchor:{right:!0,left:!0,top:!0,bottom:!0},text:a.text||SUI.i18n.dlgConfirm});this.clientPanel.add(this.text);this.caption(a.caption||SUI.i18n.dlgCaptConfirm);this._createImage(SUI.imgDir+
"/"+SUI.resource.mbQuestion)},ICON_SIZE:32,ICON_PADDING:4,TEXT_PADDING:10,image:null,show:function(){SUI.dialog.Confirm.parentMethod(this,"show");this._calcHeight();this.draw();this.okButton.el().focus()},_calcHeight:function(){this.text.el().style.overflow="hidden";this.text.el().scrollHeight>this.text.height()&&this.height(this.height()+(this.text.el().scrollHeight-this.text.height()));this.center()},_createImage:function(a){this.image=SUI.browser.createElement("IMG");this.image.style.top=this.ICON_PADDING+
"px";this.image.style.left=this.ICON_PADDING+"px";this.image.src=a;this.clientPanel.clientBox().el().appendChild(this.image)}});SUI.dialog.Alert=SUI.defineClass({baseClass:SUI.dialog.Confirm,initializer:function(a){a.text=a.text||SUI.i18n.dlgAlert;SUI.dialog.Alert.initializeBase(this,a);this.caption(a.caption||SUI.i18n.captionAlert);this.cancelButton.el().style.display="none";this.okButton.right(this.EXTRA_WINDOW_BORDER);var b=SUI.imgDir+"/"+SUI.resource.mbAlert;void 0!==a.icon&&(b="error"==a.icon?SUI.imgDir+"/"+SUI.resource.mbError:"ok"==a.icon?SUI.imgDir+"/"+SUI.resource.mbOK:a.icon);this.image.src=b}});SUI.dialog.Prompt=SUI.defineClass({baseClass:SUI.dialog.Confirm,initializer:function(a){a.text=a.text||SUI.i18n.dlgPrompt;SUI.dialog.Prompt.initializeBase(this,a);this.caption(a.caption||SUI.i18n.dlgCaptPrompt);this.inp=new SUI.form.Input({bottom:this.INPUT_MARGIN,left:this.INPUT_MARGIN,right:this.INPUT_MARGIN,anchor:{right:!0,left:!0,bottom:!0}});this.clientPanel.add(this.inp);this.height(this.height()+this.inp.height()+(1.25*this.INPUT_MARGIN|0));this.text.bottom(this.inp.height()+2*this.INPUT_MARGIN);
this.inp.el().value=a.value||"";this._enableOkButton();var b=this;SUI.browser.addEventListener(b.inp.el(),"input",function(a){b._enableOkButton()||SUI.browser.noPropagation(a)})},INPUT_MARGIN:8,formToData:function(){this.close();return this.inp.el().value},show:function(){SUI.dialog.Prompt.parentMethod(this,"show");this.inp.el().focus()},_enableOkButton:function(){this.okButton.el().disabled=""==SUI.trim(this.inp.el().value)}});SUI.dialog.Calendar=SUI.defineClass({baseClass:SUI.dialog.OKCancelDialog,initializer:function(a){SUI.dialog.Calendar.initializeBase(this,a);this.iso=void 0===a.iso?!0:a.iso;this._monthYear=this._selDate=a.date||new Date;this._type="datetime"==a.type?3:"time"==a.type?1:2;a=SUI.i18n.captionDate;if(-3==this._type)a=SUI.i18n.captionDatetime;else if(1==this._type)a=SUI.i18n.captionTime;this.caption(a);this._type&2&&this._initCalendarActions()},BORDER_WIDTH:1,BOX_WIDTH:26,BOX_HEIGHT:20,BOX_MARGIN:2,BUTTON_SIZE:22,
BUTTON_EXTRA_SIDE_MARGIN:1,DATE_MARGIN:7,HEADER_HEIGHT:23,HEADER_TEXT_TOP:3,HEADER_SPLIT_AT:0.533,SPLIT_MARGIN:10,TIME_SIDE_MARGIN:24,TIME_BOTTOM_MARGIN:5,TOP_MARGIN:1,formToData:function(){this.close();return this._selDate},show:function(){this._drawCalendar();this._setDialogSize();this.center();SUI.dialog.Calendar.parentMethod(this,"show")},_dateBox:null,_mohthYear:null,_selDate:null,_timeBox:null,_type:!0,_addHovers:function(a){SUI.browser.addEventListener(a.el(),"mouseover",function(b){a.addClass("sui-cal-day-hover")||
SUI.browser.noPropagation(b)});SUI.browser.addEventListener(a.el(),"mouseout",function(b){a.removeClass("sui-cal-day-hover")||SUI.browser.noPropagation(b)})},_addSelectDate:function(a,b){var c=this;SUI.browser.addEventListener(a.el(),"click",function(a){c._selectDate(b)||SUI.browser.noPropagation(a)})},_addSelectHour:function(a,b){var c=this;SUI.browser.addEventListener(a.el(),"click",function(a){c._selectHour(b)||SUI.browser.noPropagation(a)})},_addSelectMinutes:function(a,b){var c=this;SUI.browser.addEventListener(a.el(),
"click",function(a){c._selectMinutes(b)||SUI.browser.noPropagation(a)})},_buildDateBox:function(){var a=new SUI.Box({width:8*this.BOX_WIDTH+this.BOX_MARGIN+2*this.BUTTON_EXTRA_SIDE_MARGIN,height:this.HEADER_HEIGHT+7*this.BOX_HEIGHT+this.BUTTON_EXTRA_SIDE_MARGIN});this._drawDateNavigation(a);var b=this.BUTTON_EXTRA_SIDE_MARGIN,c=this.HEADER_HEIGHT-this.BOX_MARGIN,d=new SUI.TextBox({parent:a,text:SUI.i18n.weekShort,top:c+this.BOX_MARGIN,left:b+this.BOX_MARGIN,width:this.BOX_WIDTH-this.BOX_MARGIN,height:this.BOX_HEIGHT-
this.BOX_MARGIN,border:new SUI.Border(this.BORDER_WIDTH),padding:new SUI.Padding(0,0,0,this.BOX_MARGIN)});d.addClass("sui-cal-header");d.display();for(var b=b+this.BOX_WIDTH,e=0;e<SUI.i18n.arrDaysShort.length;e++)d=new SUI.TextBox({parent:a,text:this.iso?SUI.i18n.arrDaysShort[e]:SUI.i18n.arrDaysShort[e?e-1:6],top:c+this.BOX_MARGIN,left:b,width:this.BOX_WIDTH,height:this.BOX_HEIGHT-this.BOX_MARGIN,border:new SUI.Border(this.BORDER_WIDTH),padding:new SUI.Padding(0,0,0,this.BOX_MARGIN)}),d.addClass("sui-cal-header"),
d.display(),b+=this.BOX_WIDTH;c+=this.BOX_HEIGHT;this._drawMonthTable(a,c,this.BUTTON_EXTRA_SIDE_MARGIN);return a},_buildTimeBox:function(){var a=new SUI.Box({width:6*this.BOX_WIDTH+this.BOX_MARGIN,height:6*this.BOX_HEIGHT+2*this.HEADER_HEIGHT}),b=new SUI.TextBox({parent:a,top:this.HEADER_TEXT_TOP,width:a.width(),height:this.HEADER_HEIGHT,text:SUI.i18n.time});b.el().style.textAlign="center";var c=new SUI.Box({parent:a,top:this.HEADER_HEIGHT-this.BOX_MARGIN,width:a.width(),height:6*this.BOX_HEIGHT});
this._drawHoursTable(c);var d=this._drawMinutesTable(c,4*this.BOX_HEIGHT),e=new SUI.Box({parent:a,top:6*this.BOX_HEIGHT+this.HEADER_HEIGHT,left:0,width:a.width()-this.BOX_MARGIN,height:this.HEADER_HEIGHT});e.el().style.textAlign="right";var f=this._selDate.getMinutes(),f=f%5?f:"",g=new SUI.form.Label({title:SUI.i18n.exactMinutes+": ",parent:e});g.el().style.position="relative";var h=new SUI.form.Input({width:this.BOX_WIDTH-2*this.BOX_MARGIN,parent:e});h.el().value=f;h.el().style.position="relative";
g.forBox(h);var i=this;SUI.browser.addEventListener(h.el(),"input",function(a){i._inputMinutes(h.el().value,d)||SUI.browser.noPropagation(a)});e.display();c.display();b.display();h.display();return a},_drawCalendar:function(){if(this._type&2)this._dateBox&&this._dateBox.removeBox(),this._dateBox=this._buildDateBox(),this._dateBox.top(this.TOP_MARGIN),this._dateBox.left(this.DATE_MARGIN),this._dateBox.parent(this.clientPanel.clientBox()),this._dateBox.display();if(this._type&1)this._timeBox&&this._timeBox.removeBox(),
this._timeBox=this._buildTimeBox(),this._timeBox.top(this.TOP_MARGIN),this._timeBox.left(this._dateBox?this._dateBox.width()+this.DATE_MARGIN+this.SPLIT_MARGIN:this.TIME_SIDE_MARGIN),this._timeBox.parent(this.clientPanel.clientBox()),this._timeBox.display()},_drawDateNavigation:function(a){var b=8*this.BOX_WIDTH+this.BOX_MARGIN+2*this.BUTTON_EXTRA_SIDE_MARGIN,b={"cal.prevm":0,"cal.nextm":Math.ceil(b*this.HEADER_SPLIT_AT,10)-this.BUTTON_SIZE,"cal.prevy":Math.ceil(b*this.HEADER_SPLIT_AT,10),"cal.nexty":b-
2*this.BUTTON_SIZE,"cal.today":b-this.BUTTON_SIZE},c;for(c in b){var d=new SUI.ToolbarButton({actionId:c,left:b[c],width:this.BUTTON_SIZE,height:this.BUTTON_SIZE});d.parent(a);d.setAction(this._actionList);d.draw()}c=new SUI.TextBox({parent:a,text:SUI.i18n.arrMonths[this._monthYear.getMonth()],top:this.HEADER_TEXT_TOP,left:this.BUTTON_SIZE,width:b["cal.nextm"]-this.BUTTON_SIZE,height:this.HEADER_HEIGHT});c.el().style.textAlign="center";c.display();a=new SUI.TextBox({parent:a,text:this._monthYear.getFullYear(),
top:this.HEADER_TEXT_TOP,left:b["cal.prevy"]+this.BUTTON_SIZE,width:b["cal.nexty"]-this.BUTTON_SIZE-b["cal.prevy"],height:this.HEADER_HEIGHT});a.el().style.textAlign="center";a.display()},_drawHoursTable:function(a){for(var b=0,c=0,d=0;4>d;d++){for(var e=b=0;6>e;e++){var f=6*d+e,g="sui-cal-day";f==this._selDate.getHours()&&(g+=" sui-cal-selected");var h=new SUI.TextBox({parent:a,text:""+f,top:c+this.BOX_MARGIN,left:b+this.BOX_MARGIN,width:this.BOX_WIDTH-this.BOX_MARGIN,height:this.BOX_HEIGHT-this.BOX_MARGIN,
border:new SUI.Border(this.BORDER_WIDTH)});h.addClass(g);h.display();this._addHovers(h);this._addSelectHour(h,f);b+=this.BOX_WIDTH}c+=this.BOX_HEIGHT}},_drawMinutesTable:function(a,b){for(var c=0,d=null,e=0;2>e;e++){for(var f=c=0;6>f;f++){var g=5*(6*e+f),h="sui-cal-weekend";g==this._selDate.getMinutes()&&(h+=" sui-cal-selected");var i=new SUI.TextBox({parent:a,text:10>g?":0"+g:":"+g,top:b+this.BOX_MARGIN,left:c+this.BOX_MARGIN,width:this.BOX_WIDTH-this.BOX_MARGIN,height:this.BOX_HEIGHT-this.BOX_MARGIN,
border:new SUI.Border(this.BORDER_WIDTH)});i.addClass(h);i.display();this._addHovers(i);this._addSelectMinutes(i,g);g==this._selDate.getMinutes()&&(d=i);c+=this.BOX_WIDTH}b+=this.BOX_HEIGHT}return d},_drawMonthTable:function(a,b,c){var d=this._monthYear,e=this._getCalendar(d,this.iso),f;for(f in e){var g=c,h=new SUI.TextBox({parent:a,text:f,top:b,left:g+this.BOX_MARGIN,width:this.BOX_WIDTH-this.BOX_MARGIN,height:this.BOX_HEIGHT,border:new SUI.Border(this.BORDER_WIDTH),padding:new SUI.Padding(this.BOX_MARGIN,
0)});h.addClass("sui-cal-weekno");h.display();for(var g=g+this.BOX_WIDTH,i=0;i<e[f].length;i++){var j=e[f][i],k=j.getMonth()==d.getMonth()?"sui-cal-day":"sui-cal-otherday";if(0==j.getDay()||6==j.getDay())k+=" sui-cal-weekend";j.getDate()==this._selDate.getDate()&&j.getMonth()==this._selDate.getMonth()&&j.getFullYear()==this._selDate.getFullYear()&&(k+=" sui-cal-selected");h=new SUI.TextBox({parent:a,text:j.getDate(),top:b+this.BOX_MARGIN,left:g+this.BOX_MARGIN,width:this.BOX_WIDTH-this.BOX_MARGIN,
height:this.BOX_HEIGHT-this.BOX_MARGIN,border:new SUI.Border(this.BORDER_WIDTH)});h.addClass(k);h.display();this._addHovers(h);this._addSelectDate(h,j);g+=this.BOX_WIDTH}b+=this.BOX_HEIGHT}},_getCalendar:function(a){for(var b=a.getMonth(),a=a.getFullYear(),c=this.iso?4:1,d=new Date(a,0,c);d.getDay()!=this.iso;c--)d=new Date(a,0,c);c=2;do{c--;var e=new Date(a,b,c)}while(e.getDay()!=this.iso);var d=Math.round((e.getTime()-d.getTime())/6048E5)+1,f={};do{f[d]=[];for(var g=0;7>g;g++)f[d].push(e),c++,e=
new Date(a,b,c);d++}while(e.getMonth()==b);return f},_initCalendarActions:function(){var a=this;this._actionList=new SUI.ActionList([{actionId:"cal.prevm",icon:SUI.resource.calPrev,title:SUI.i18n.prevMonth,handler:function(){a._monthYear=new Date(a._monthYear.getFullYear(),a._monthYear.getMonth()-1,1);a._drawCalendar()}},{actionId:"cal.nextm",icon:SUI.resource.calNext,title:SUI.i18n.nextMonth,handler:function(){a._monthYear=new Date(a._monthYear.getFullYear(),a._monthYear.getMonth()+1,1);a._drawCalendar()}},
{actionId:"cal.prevy",icon:SUI.resource.calPrev,title:SUI.i18n.prevYear,handler:function(){a._monthYear=new Date(a._monthYear.getFullYear()-1,a._monthYear.getMonth(),1);a._drawCalendar()}},{actionId:"cal.nexty",icon:SUI.resource.calNext,title:SUI.i18n.nextYear,handler:function(){a._monthYear=new Date(a._monthYear.getFullYear()+1,a._monthYear.getMonth(),1);a._drawCalendar()}},{actionId:"cal.today",icon:SUI.resource.calToday,title:SUI.i18n.goToday,handler:function(){a._monthYear=a._selDate=new Date;
a._drawCalendar()}}])},_inputMinutes:function(a,b){b&&b.removeClass("sui-cal-selected");var c=parseInt(a,10);isNaN(c)&&(c=0);this._selDate.setMinutes(0>c?0:59<c?59:c)},_selectDate:function(a){this._selDate.setFullYear(a.getFullYear(),a.getMonth(),a.getDate());this._monthYear=this._selDate;this._drawCalendar()},_selectHour:function(a){this._selDate.setHours(a);this._drawCalendar()},_selectMinutes:function(a){this._selDate.setMinutes(a);this._drawCalendar()},_setDialogSize:function(){var a=0,b=0;this._dateBox&&
(a=this._dateBox.width()+2*this.DATE_MARGIN,b=this.TOP_MARGIN+this._dateBox.height()+this.DATE_MARGIN);if(this._timeBox){var c=this.TOP_MARGIN+this._timeBox.height()+this.TIME_BOTTOM_MARGIN;c>b&&(b=c);a=a?this._timeBox.left()+this._timeBox.width()+this.DATE_MARGIN+this.BUTTON_EXTRA_SIDE_MARGIN:this._timeBox.width()+2*this.TIME_SIDE_MARGIN}this.setClientWidth(a);this.setClientHeight(b)}});SUI.control.Date=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){SUI.control.Date.initializeBase(this,a);this._type=a.type||"date";this._fields=[];this.el().style.overflow="visible";var b=SUI.i18n.dateFormat;if("datetime"==this._type)b=SUI.i18n.dateFormat+" "+SUI.i18n.timeFormat;else if("time"==this._type)b=SUI.i18n.timeFormat;this._hidden=new SUI.form.Input({});this._hidden.el().type="hidden";this._hidden.el().name=a.name||this.el().id;this._hidden.parent(this);var b=this._addInputFields(b),
c=this;this._button=new SUI.ToolbarButton({parent:this,left:b+this.BUTTON_MARGIN,width:this.BUTTON_SIZE,height:this.BUTTON_SIZE,top:(this.HEIGHT-this.BUTTON_SIZE)/2,title:"",icon:"time"==this._type?SUI.resource.calTime:SUI.resource.calDate,handler:function(){(new SUI.dialog.Calendar({type:c._type,date:c._toDate(),onOK:function(a){c._setDate(a)}})).show()}});this._fields.push(this._hidden);this._fields.push(this._button);this.width(this._button.left()+this._button.width());this.height(this.HEIGHT);
a.value&&this._setValue(a.value)},BUTTON_MARGIN:7,BUTTON_SIZE:22,HEIGHT:20,WIDTH_2:20,WIDTH_4:36,WIDTH_SEP:10,display:function(){this.setDim();for(var a=0;a<this._fields.length;a++)this._fields[a].display()},firstBox:function(){return this._fields[0]},layOut:function(){for(var a=0;a<this._fields.length;a++)this._fields[a].layOut()},value:function(a){if(void 0===a)return this._getValue();if("string"===a)return this._getValue().strDate;if("date"===a)return this._getValue().date;this._setValue(a);return null},
_button:null,_day:null,_fields:null,_hidden:null,_hour:null,_min:null,_month:null,_type:"",_year:null,_addInputFields:function(a){for(var b=0,c=0;c<a.length;c++)switch(a.charAt(c)){case "d":this.day=new SUI.form.Input({parent:this,left:b,width:this.WIDTH_2});this.day.el().maxLength=2;this._fields.push(this.day);b+=this.WIDTH_2;break;case "m":this.month=new SUI.form.Input({parent:this,left:b,width:this.WIDTH_2});this.month.el().maxLength=2;this._fields.push(this.month);b+=this.WIDTH_2;break;case "y":this.year=
new SUI.form.Input({parent:this,left:b,width:this.WIDTH_4});this.year.el().maxLength=4;this._fields.push(this.year);b+=this.WIDTH_4;break;case "h":this.hour=new SUI.form.Input({parent:this,left:b,width:this.WIDTH_2});this.hour.el().maxLength=2;this._fields.push(this.hour);b+=this.WIDTH_2;break;case "i":this.min=new SUI.form.Input({parent:this,left:b,width:this.WIDTH_2});this.min.el().maxLength=2;this._fields.push(this.min);b+=this.WIDTH_2;break;default:var d=new SUI.TextBox({parent:this,text:a.charAt(c),
left:b,width:this.WIDTH_SEP,height:this.HEIGHT});d.el().style.textAlign="center";this._fields.push(d);b+=this.WIDTH_SEP}for(var e=this,c=0;c<this._fields.length;c++)this._fields[c]instanceof SUI.form.Input&&SUI.browser.addEventListener(this._fields[c].el(),"input",function(a){e._setHidden()||SUI.browser.noPropagation(a)});return b},_getValue:function(){var a={date:null,strDate:"error",type:"error"};if(this._isEmpty())a.type="empty",a.strDate="";else{var b=this._toDate();b&&(this._setHidden(),a={date:b,
strDate:this._hidden.el().value,type:this._type})}return a},_isEmpty:function(){var a="";this.year&&(a+=this.year.el().value+this.month.el().value+this.day.el().value);this.hour&&(a+=this.hour.el().value+this.min.el().value);return""===SUI.trim(a)},_setDate:function(a){if(this.year)a?(this.year.el().value=SUI.date.padZero(a.getFullYear(),4),this.day.el().value=SUI.date.padZero(a.getDate()),this.month.el().value=SUI.date.padZero(a.getMonth()+1)):this.year.el().value=this.day.el().value=this.month.el().value=
"";if(this.hour)if(a)this.hour.el().value=SUI.date.padZero(a.getHours()),this.min.el().value=SUI.date.padZero(a.getMinutes());else if(this.hour)this.hour.el().value=this.min.el().value="";this._setHidden()},_setHidden:function(){var a="error";if(this._isEmpty())a="";else{var b=this._toDate();b&&(a=SUI.date.toSqlDate(b,this.hour))}this._hidden.el().value=a},_setValue:function(a){if(!(a instanceof Date))if(null===a||""===a)a=null;else if(a=SUI.date.parseSqlDate(a),!a)throw"SUI.control.Date: _setValue called with invalid date";
this._setDate(a)},_toDate:function(){var a=new Date,b=!0;if(this.year){var c=parseInt(this.year.el().value,10),d=parseInt(this.month.el().value,10),e=parseInt(this.day.el().value,10);a.setFullYear(c,d-1,e);b=b&&a.getFullYear()===c&&a.getMonth()+1===d&&a.getDate()===e}this.hour&&(c=parseInt(this.hour.el().value,10),isNaN(c)&&(c=0),d=parseInt(this.min.el().value,10),isNaN(d)&&(d=0),a.setHours(c),a.setMinutes(d),b=b&&a.getHours()===c&&a.getMinutes()===d);return b?a:null}});SUI.control.ImageCropper=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){SUI.control.Date.initializeBase(this,a);this._outputHeight=a.outputHeight||0;this._outputWidth=a.outputWidth||0;this.el().style.backgroundImage="url("+a.image+")";this.el().style.overflow="visible";this._crop={n:null,e:null,s:null,w:null};for(var b in this._crop)this._crop[b]=new SUI.Box({parent:this}),this._crop[b].el().appendChild(document.createElement("SPAN")),this._crop[b].addClass("sui-icr-crop"),this._crop[b].el().style.cursor=
"crosshair";this._croparea=new SUI.Box({parent:this});this._croparea.el().style.overflow="visible";this._croparea.el().style.cursor="move";this._croparea.border(new SUI.Border(1));this._croparea.addClass("sui-icr-croparea");this._addDragHandler(this._croparea);this._handle={n:{cursor:"n-resize",top:"-5",left:"0"},nw:{cursor:"nw-resize",top:"-5",left:"-5"},w:{cursor:"w-resize",top:"0",left:"-5"},sw:{cursor:"sw-resize",bottom:"-5",left:"-5"},s:{cursor:"s-resize",bottom:"-5",right:"0"},se:{cursor:"se-resize",
bottom:"-5",right:"-5"},e:{cursor:"e-resize",top:"0",right:"-5"},ne:{cursor:"ne-resize",top:"-5",right:"-5"}};for(b in this._handle){a=new SUI.Box({parent:this._croparea});a.el().style.width=this.DRAGGER_SIZE+"px";a.el().style.height=this.DRAGGER_SIZE+"px";if(this._handle[b].top)a.el().style.top=this._handle[b].top+"px";if(this._handle[b].right)a.el().style.right=this._handle[b].right+"px";if(this._handle[b].left)a.el().style.left=this._handle[b].left+"px";if(this._handle[b].bottom)a.el().style.bottom=
this._handle[b].bottom+"px";a.el().style.cursor=this._handle[b].cursor;a.addClass("sui-icr-handle");a.el().appendChild(document.createElement("SPAN"));this._addDragHandler(a);this._handle[b]=a}this._rescale()},DRAGGER_SIZE:7,MIN_SIZE:16,data:function(){var a=this._outputWidth,b=this._outputHeight;if(0==a&&0==b)return null;0==a&&(a=Math.round(this._croparea.width()*b/this._croparea.height()));0==b&&(b=Math.round(this._croparea.height()*a/this._croparea.width()));return{originalWidth:this.width(),originalHeight:this.height(),
cropWidth:this._croparea.width(),cropHeight:this._croparea.height(),cropTop:this._croparea.top(),cropLeft:this._croparea.left(),newWidth:a,newHeight:b}},targetSize:function(a,b){this._outputWidth=parseInt(a,10);if(isNaN(this._outputWidth))this._outputWidth=0;this._outputHeight=parseInt(b,10);if(isNaN(this._outputHeight))this._outputHeight=0;this._rescale();this._activateHandles()},_ehDrag:null,_ehEndDrag:null,_crop:null,_dragStartPos:null,_handle:null,_outputHeight:0,_outputWidth:0,_ratio:0,_startHeight:0,
_startLeft:0,_startTop:0,_startWidth:0,_activateHandles:function(){var a="block";this._ratio&&(a="none");this._handle.n.el().style.display=a;this._handle.w.el().style.display=a;this._handle.e.el().style.display=a;this._handle.s.el().style.display=a},_addDragHandler:function(a){var b=this;SUI.browser.addEventListener(a.el(),"mousedown",function(c){b._startDrag(a,new SUI.Event(this,c))||SUI.browser.noPropagation(c)})},_drag:function(a,b){var c={x:SUI.browser.getX(b.event),y:SUI.browser.getY(b.event)};
a==this._croparea?this._moveCropArea(c):this._ratio?a==this._handle.se?this._handle_se(c):a==this._handle.ne?this._handle_ne(c):a==this._handle.nw?this._handle_nw(c):a==this._handle.sw&&this._handle_sw(c):a==this._handle.se?(this._handle_s(c),this._handle_e(c)):a==this._handle.ne?(this._handle_n(c),this._handle_e(c)):a==this._handle.nw?(this._handle_n(c),this._handle_w(c)):a==this._handle.sw?(this._handle_s(c),this._handle_w(c)):a==this._handle.e?this._handle_e(c):a==this._handle.n?this._handle_n(c):
a==this._handle.w?this._handle_w(c):a==this._handle.s&&this._handle_s(c);this._redraw()},_dx:function(a){return a.x-this._dragStartPos.x},_dy:function(a){return a.y-this._dragStartPos.y},_endDrag:function(){SUI.browser.removeEventListener(document,"mousemove",this._ehDrag);SUI.browser.removeEventListener(document,"mouseup",this._ehEndDrag)},_handle_e:function(a){this._croparea.width(this._startWidth+this._dx(a));this._croparea.width()<this.MIN_SIZE&&this._croparea.width(this.MIN_SIZE);this._croparea.left()+
this._croparea.width()>this.width()&&this._croparea.width(this.width()-this._croparea.left())},_handle_n:function(a){var b=this._croparea.top()+this._croparea.height();this._croparea.height(this._startHeight-this._dy(a));this._croparea.top(this._startTop+this._dy(a));this._croparea.height()<this.MIN_SIZE&&(this._croparea.height(this.MIN_SIZE),this._croparea.top(b-this.MIN_SIZE));0>this._croparea.top()&&(this._croparea.height(b),this._croparea.top(0))},_handle_ne:function(a){a=this._ratioSize(this._dx(a),
-this._dy(a));a.w>=this.MIN_SIZE&&a.h>=this.MIN_SIZE&&this._croparea.left()+a.w<=this.width()&&0<=this._croparea.top()+this._croparea.height()-a.h&&(this._croparea.top(this._croparea.top()+this._croparea.height()-a.h),this._croparea.width(a.w),this._croparea.height(a.h))},_handle_nw:function(a){a=this._ratioSize(-this._dx(a),-this._dy(a));a.w>=this.MIN_SIZE&&a.h>=this.MIN_SIZE&&0<=this._croparea.left()+this._croparea.width()-a.w&&0<=this._croparea.top()+this._croparea.height()-a.h&&(this._croparea.left(this._croparea.left()+
this._croparea.width()-a.w),this._croparea.top(this._croparea.top()+this._croparea.height()-a.h),this._croparea.width(a.w),this._croparea.height(a.h))},_handle_s:function(a){this._croparea.height(this._startHeight+this._dy(a));this._croparea.height()<this.MIN_SIZE&&this._croparea.height(this.MIN_SIZE);this._croparea.top()+this._croparea.height()>this.height()&&this._croparea.height(this.height()-this._croparea.top())},_handle_se:function(a){a=this._ratioSize(this._dx(a),this._dy(a));a.w>=this.MIN_SIZE&&
a.h>=this.MIN_SIZE&&this._croparea.left()+a.w<=this.width()&&this._croparea.top()+a.h<=this.height()&&(this._croparea.width(a.w),this._croparea.height(a.h))},_handle_sw:function(a){a=this._ratioSize(-this._dx(a),this._dy(a));a.w>=this.MIN_SIZE&&a.h>=this.MIN_SIZE&&0<=this._croparea.left()+this._croparea.width()-a.w&&this._croparea.top()+a.h<=this.height()&&(this._croparea.left(this._croparea.left()+this._croparea.width()-a.w),this._croparea.width(a.w),this._croparea.height(a.h))},_handle_w:function(a){var b=
this._croparea.left()+this._croparea.width();this._croparea.width(this._startWidth-this._dx(a));this._croparea.left(this._startLeft+this._dx(a));this._croparea.width()<this.MIN_SIZE&&(this._croparea.width(this.MIN_SIZE),this._croparea.left(b-this.MIN_SIZE));0>this._croparea.left()&&(this._croparea.width(b),this._croparea.left(0))},_moveCropArea:function(a){this._croparea.top(this._startTop+this._dy(a));this._croparea.left(this._startLeft+this._dx(a));0>this._croparea.top()&&this._croparea.top(0);
0>this._croparea.left()&&this._croparea.left(0);this._croparea.left()+this._croparea.width()>this.width()&&this._croparea.left(this.width()-this._croparea.width());this._croparea.top()+this._croparea.height()>this.height()&&this._croparea.top(this.height()-this._croparea.height())},_ratioSize:function(a,b){var c={w:this._startWidth+a,h:this._startHeight+b};c.w/c.h>this._ratio?c.h=Math.round(c.w/this._ratio):c.w=Math.round(c.h*this._ratio);return c},_redraw:function(){this._crop.w.left(0);this._crop.w.top(this._croparea.top());
this._crop.w.width(this._croparea.left());this._crop.w.height(this._croparea.height());this._crop.e.top(this._croparea.top());this._crop.e.left(this._croparea.width()+this._croparea.left());this._crop.e.width(this.width()-this._croparea.width()-this._croparea.left());this._crop.e.height(this._croparea.height());this._crop.n.top(0);this._crop.n.width(this.width());this._crop.n.height(this._croparea.top());this._crop.s.top(this._croparea.height()+this._croparea.top());this._crop.s.width(this.width());
this._crop.s.height(this.height()-this._croparea.height()-this._croparea.top());this._croparea.setDim();this._crop.w.setDim();this._crop.e.setDim();this._crop.n.setDim();this._crop.s.setDim();this._handle.n.el().style.left=Math.round(this._croparea.width()/2)-5+"px";this._handle.s.el().style.left=Math.round(this._croparea.width()/2)-5+"px";this._handle.e.el().style.top=Math.round(this._croparea.height()/2)-5+"px";this._handle.w.el().style.top=Math.round(this._croparea.height()/2)-5+"px"},_rescale:function(){if(0<
this._outputWidth&&0<this._outputHeight){this._ratio=this._outputWidth/this._outputHeight;var a,b;this.width()/this.height()<this._ratio?(a=Math.round(0.9*this.width()),b=Math.round(a/this._ratio)):(b=Math.round(0.9*this.height()),a=Math.round(b*this._ratio));this._croparea.width(a);this._croparea.height(b);this._croparea.left(Math.round(this.width()-a-4)/2);this._croparea.top(Math.round(this.height()-b-4)/2)}else this._ratio=0,this._croparea.width(Math.round(0.9*this.width())),this._croparea.height(Math.round(0.9*
this.height())),this._croparea.left(Math.round(0.05*this.width())),this._croparea.top(Math.round(0.05*this.height()));this._redraw()},_startDrag:function(a,b){this._startWidth=this._croparea.width();this._startHeight=this._croparea.height();this._startTop=this._croparea.top();this._startLeft=this._croparea.left();this._dragStartPos={x:SUI.browser.getX(b.event),y:SUI.browser.getY(b.event)};var c=this;SUI.browser.addEventListener(document,"mousemove",this._ehDrag=function(b){c._drag(a,new SUI.Event(this,
b))||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(document,"mouseup",this._ehEndDrag=function(a){c._endDrag(new SUI.Event(this,a))||SUI.browser.noPropagation(a)})}});SUI.control.HSVSelector=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){SUI.control.HSVSelector.initializeBase(this,a);this.width(2*this.PADDING+this.AXIS_LENGTH+this.SPLIT_WIDTH+this.HUE_BAR_WIDTH);this.height(this.AXIS_LENGTH+2*this.PADDING);this._axisRange=this.AXIS_LENGTH-this.CROSSHAIR_LINE;this._buildSatValPane();this._buildHueBar();a.onChange&&this.addListener("onChange",a.onChange);this.colorCode(a.color||"#CCCCCC")},AXIS_LENGTH:128,CROSSHAIR_LINE:1,HUE_BAR_WIDTH:20,HUE_CROSSHAIR_HEIGHT:15,
HUE_CROSSHAIR_WIDTH:26,PADDING:15,SATVAL_CROSSHAIR_SIZE:31,SPLIT_WIDTH:17,colorCode:function(a){if(void 0===a)return SUI.color.hsvToCol({h:this._hue,s:this._sat,v:this._val});a=SUI.color.colToHsv(a);this._hue=a.h;this._sat=a.s;this._val=a.v;this._hueTop();this._satTop();this._valLeft();this.display();return null},display:function(){this.setDim();this._satVal.setDim();this._hueBar.setDim();this._chSatVal.setDim();this._chHue.setDim();this._satVal.el().style.backgroundColor=SUI.color.hsvToCol({h:this._hue,
s:1,v:1})},hue:function(a){if(void 0===a)return this._hue;if(0<=a&&360>=a)this._hue=a;this._hueTop();this.display();return null},layOut:function(){this._satVal.setRect(this._satVal);this._hueBar.setRect(this._hueBar)},onChange:function(){},saturation:function(a){if(void 0===a)return this._sat;if(0<=a&&1>=a)this._sat=a;this._satTop();this.display();return null},value:function(a){if(void 0===a)return this._val;if(0<=a&&1>=a)this._val=a;this._valLeft();this.display();return null},_axisRange:0,_chHue:null,
_chSatVal:null,_hue:0,_hueBar:null,_ofsChHue:0,_ofsChSatVal:0,_sat:1,_satVal:null,_val:0,_buildHueBar:function(){this._hueBar=new SUI.Box({parent:this,width:this.HUE_BAR_WIDTH,height:this.AXIS_LENGTH,top:this.PADDING,left:this.AXIS_LENGTH+this.PADDING+this.SPLIT_WIDTH});this._hueBar.el().style.backgroundImage="url("+SUI.imgDir+"/"+SUI.resource.hsvHue+")";this._hueBar.el().style.overflow="visible";this._chHue=new SUI.Dragger({parent:this._hueBar,width:this.HUE_CROSSHAIR_WIDTH,height:this.HUE_CROSSHAIR_HEIGHT,
left:(this.HUE_BAR_WIDTH-this.HUE_CROSSHAIR_WIDTH)/2|0});this._ofsChHue=(this.CROSSHAIR_LINE-this.HUE_CROSSHAIR_HEIGHT)/2|0;this._chHue.yMin(this._ofsChHue);this._chHue.yMax(this._ofsChHue+this.AXIS_LENGTH-this.CROSSHAIR_LINE);this._chHue.direction(this._chSatVal.VERTICAL);this._chHue.el().style.backgroundImage="url("+SUI.imgDir+"/"+SUI.resource.hsvChHue+")";this._chHue.el().style.cursor="pointer";var a=this;SUI.browser.addEventListener(this._chHue.el(),"mousedown",function(b){a._startHueDrag(new SUI.Event(this,
b))||SUI.browser.noPropagation(b)})},_buildSatValPane:function(){this._satVal=new SUI.Box({parent:this,width:this.AXIS_LENGTH,height:this.AXIS_LENGTH,top:this.PADDING,left:this.PADDING});this._satVal.el().style.backgroundImage="url("+SUI.imgDir+"/"+SUI.resource.hsvSatVal+")";this._satVal.el().style.overflow="visible";this._chSatVal=new SUI.Dragger({parent:this._satVal,width:this.SATVAL_CROSSHAIR_SIZE,height:this.SATVAL_CROSSHAIR_SIZE});this._ofsChSatVal=(this.CROSSHAIR_LINE-this.SATVAL_CROSSHAIR_SIZE)/
2|0;var a=this._ofsChSatVal+this.AXIS_LENGTH-this.CROSSHAIR_LINE;this._chSatVal.xMin(this._ofsChSatVal);this._chSatVal.xMax(a);this._chSatVal.yMin(this._ofsChSatVal);this._chSatVal.yMax(a);this._chSatVal.direction(this._chSatVal.HORIZONTAL+this._chSatVal.VERTICAL);this._chSatVal.el().style.backgroundImage="url("+SUI.imgDir+"/"+SUI.resource.hsvChSatVal+")";this._chSatVal.el().style.cursor="pointer";var b=this;SUI.browser.addEventListener(this._chSatVal.el(),"mousedown",function(a){b._startSatValDrag(new SUI.Event(this,
a))||SUI.browser.noPropagation(a)})},_hueDrag:function(){this._hue=360*(this._axisRange-(this._chHue.top()-this._ofsChHue))/this._axisRange;this._satVal.el().style.backgroundColor=SUI.color.hsvToCol({h:this._hue,s:1,v:1});this.callListener("onChange",SUI.color.hsvToCol({h:this._hue,s:this._sat,v:this._val}))},_hueTop:function(){this._chHue.top(((1-this._hue/360)*this._axisRange|0)+this._ofsChHue)},_satTop:function(){this._chSatVal.top(((1-this._sat)*this._axisRange|0)+this._ofsChSatVal)},_satValDrag:function(){this._sat=
(this._axisRange-(this._chSatVal.top()-this._ofsChSatVal))/this._axisRange;this._val=(this._chSatVal.left()-this._ofsChSatVal)/this._axisRange;this.callListener("onChange",SUI.color.hsvToCol({h:this._hue,s:this._sat,v:this._val}))},_startHueDrag:function(a){var b=this;this._chHue.addListener("onDrag",function(){b._hueDrag()});this._chHue.start(a,this)},_startSatValDrag:function(a){var b=this;this._chSatVal.addListener("onDrag",function(){b._satValDrag()});this._chSatVal.start(a,this)},_valLeft:function(){this._chSatVal.left((this._val*
this._axisRange|0)+this._ofsChSatVal)}});SUI.control.HSVColorPicker=SUI.defineClass({baseClass:SUI.AnchorLayout,initializer:function(a){SUI.control.HSVColorPicker.initializeBase(this,a);this.width(this.WIDTH);this.height(this.HEIGHT);this._hsv=new SUI.control.HSVSelector({});var b=this.PADDING;this._inpHue=new SUI.form.Input({width:this.INPUT_WIDTH,right:this.PADDING,top:b,anchor:{right:!0}});this._lblHue=new SUI.form.Label({width:this.LABEL_WIDTH,left:this.LABEL_LEFT,top:b,forBox:this._inpHue,title:SUI.i18n.hsvHue});b+=this.ROW_HEIGHT;
this._inpSat=new SUI.form.Input({width:this.INPUT_WIDTH,right:this.PADDING,top:b,anchor:{right:!0}});this._lblSat=new SUI.form.Label({width:this.LABEL_WIDTH,left:this.LABEL_LEFT,top:b,forBox:this._inpSat,title:SUI.i18n.hsvSaturation});b+=this.ROW_HEIGHT;this._inpVal=new SUI.form.Input({width:this.INPUT_WIDTH,right:this.PADDING,top:b,anchor:{right:!0}});this._lblVal=new SUI.form.Label({width:this.LABEL_WIDTH,left:this.LABEL_LEFT,top:b,forBox:this._inpVal,title:SUI.i18n.hsvValue});b+=this.ROW_HEIGHT;
this._inpCode=new SUI.form.Input({width:this.COLBOX_WIDTH,right:this.PADDING,top:b,anchor:{right:!0}});this._inpCode.el().maxLength=7;this._inpCode.el().style.textAlign="right";this._inpCode.el().style.fontFamily="mono";this._lblCode=new SUI.form.Label({width:this.LABEL_WIDTH,left:this.LABEL_LEFT,top:b,forBox:this._inpCode,title:SUI.i18n.hsvCode});b+=this.ROW_HEIGHT;this._boxCol=new SUI.Box({width:this.COLBOX_WIDTH,height:this.COLBOX_HEIGHT,right:this.PADDING,top:b,anchor:{right:!0}});this._boxCol.border(new SUI.Border(1));
this._boxCol.el().style.borderColor="black";this._lblColor=new SUI.form.Label({width:this.LABEL_WIDTH,left:this.LABEL_LEFT,top:b,title:SUI.i18n.hsvColor});this._setInputs();a.onChange&&this.addListener("onChange",a.onChange);this._addEventHandlers();this.add(this._hsv);this.add(this._lblHue);this.add(this._lblSat);this.add(this._lblVal);this.add(this._lblCode);this.add(this._lblColor);this.add(this._inpHue);this.add(this._inpSat);this.add(this._inpVal);this.add(this._inpCode);this.add(this._boxCol)},
COLBOX_HEIGHT:20,COLBOX_WIDTH:64,HEIGHT:158,INPUT_WIDTH:30,LABEL_LEFT:200,LABEL_WIDTH:100,PADDING:15,ROW_HEIGHT:27,WIDTH:335,colorCode:function(a){if(void 0==a)return this._hsv.colorCode();var b=parseInt(a.substr(1),16);if(!isNaN(b)&&0<=b&&16777215>=b)this._hsv.colorCode(a),this._setInputs();else throw"SUI.control.HSVColorPicker: colorCode, invalid color";return null},onChange:function(){},_inpCode:null,_boxCol:null,_hsv:null,_lblCode:null,_lblColor:null,_lblHue:null,_lblSat:null,_lblVal:null,_inpHue:null,
_inpSat:null,_inpVal:null,_addEventHandlers:function(){var a=this;SUI.browser.addEventListener(this._inpHue.el(),"blur",function(b){a._setHue(a._inpHue.el().value)||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this._inpSat.el(),"blur",function(b){a._setSaturation(a._inpSat.el().value)&&SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this._inpVal.el(),"blur",function(b){a._setValue(a._inpVal.el().value)&&SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this._inpCode.el(),
"blur",function(b){a.colorCode(this.value);a.callListener("onChange",a._hsv.colorCode());SUI.browser.noPropagation(b)});this._hsv.addListener("onChange",function(){a._setInputs();a.callListener("onChange",a._hsv.colorCode())})},_setHue:function(a){a=parseInt(""+a,10);!isNaN(a)&&0<=a&&360>=a&&(this._hsv.hue(a),this._setInputs(),this.callListener("onChange",this._hsv.colorCode()))},_setInputs:function(){var a=this._hsv.colorCode();this._inpHue.el().value=this._hsv.hue()|0;this._inpSat.el().value=100*
this._hsv.saturation()|0;this._inpVal.el().value=100*this._hsv.value()|0;this._inpCode.el().value=a.toUpperCase();this._boxCol.el().style.backgroundColor=a},_setSaturation:function(a){a=parseInt(""+a,10);!isNaN(a)&&0<=a&&100>=a&&(this._hsv.saturation(a/100),this._setInputs(),this.callListener("onChange",this._hsv.colorCode()))},_setValue:function(a){a=parseInt(""+a,10);!isNaN(a)&&0<=a&&100>=a&&(this._hsv.value(a/100),this._setInputs(),this.callListener("onChange",this._hsv.colorCode()))}});SUI.control.ColorIntensityBar=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){SUI.control.ColorIntensityBar.initializeBase(this,a);this.width(this.AXIS_LENGTH);this.height(this.HEIGHT);this.el().style.backgroundImage="url("+SUI.imgDir+"/"+SUI.resource.rgbBar+")";this.el().style.backgroundColor="r"==a.color?"#FF0000":"g"==a.color?"#00FF00":"#0000FF";this.el().style.overflow="visible";this._axisRange=this.AXIS_LENGTH-this.CROSSHAIR_LINE;this._ofsCh=(this.CROSSHAIR_LINE-this.CROSSHAIR_WIDTH)/
2|0;this._ch=new SUI.Dragger({parent:this,width:this.CROSSHAIR_WIDTH,height:this.CROSSHAIR_HEIGHT,top:(this.HEIGHT-this.CROSSHAIR_HEIGHT)/2|0,left:this._ofsCh});this._ch.xMin(this._ofsCh);this._ch.xMax(this._ofsCh+this.AXIS_LENGTH-this.CROSSHAIR_LINE);this._ch.direction(this._ch.HORIZONTAL);this._ch.el().style.backgroundImage="url("+SUI.imgDir+"/"+SUI.resource.rgbCh+")";this._ch.el().style.cursor="pointer";var b=this;SUI.browser.addEventListener(this._ch.el(),"mousedown",function(a){b._startDrag(new SUI.Event(this,
a))||SUI.browser.noPropagation(a)});a.onChange&&this.addListener("onChange",a.onChange)},AXIS_LENGTH:256,CROSSHAIR_LINE:1,HEIGHT:20,CROSSHAIR_WIDTH:15,CROSSHAIR_HEIGHT:26,display:function(){this.setDim();this._ch.setDim()},onChange:function(){},value:function(a){if(void 0===a)return this._val;this._val=a;this._ch.left((this._val*this._axisRange|0)+this._ofsCh);this.display();return null},_axisRange:0,_ch:null,_ofsCh:0,_val:0,_drag:function(){this._val=(this._ch.left()-this._ofsCh)/this._axisRange;
this.callListener("onChange",this._val)},_startDrag:function(a){var b=this;this._ch.addListener("onDrag",function(){b._drag()});this._ch.start(a,this)}});SUI.control.RGBColorPicker=SUI.defineClass({baseClass:SUI.AnchorLayout,initializer:function(a){SUI.control.RGBColorPicker.initializeBase(this,a);this.width(this.WIDTH);this.height(this.HEIGHT);var b=this,c=this.PADDING;this._red=new SUI.control.ColorIntensityBar({top:c,right:this.PADDING,anchor:{right:!0},color:"r",onChange:function(){b._setColor();b.callListener("onChange",b._color)}});this._lblRed=new SUI.form.Label({width:this.LABEL_WIDTH,left:this.PADDING,top:c,title:SUI.i18n.rgbRed});c+=this.ROW_HEIGHT;
this._green=new SUI.control.ColorIntensityBar({top:c,right:this.PADDING,anchor:{right:!0},color:"g",onChange:function(){b._setColor();b.callListener("onChange",b._color)}});this._lblGreen=new SUI.form.Label({width:this.LABEL_WIDTH,left:this.PADDING,top:c,title:SUI.i18n.rgbGreen});c+=this.ROW_HEIGHT;this._blue=new SUI.control.ColorIntensityBar({top:c,right:this.PADDING,anchor:{right:!0},color:"b",onChange:function(){b._setColor();b.callListener("onChange",b._color)}});this._lblBlue=new SUI.form.Label({width:this.LABEL_WIDTH,
left:this.PADDING,top:c,title:SUI.i18n.rgbBlue});c+=this.ROW_HEIGHT;this._inpCode=new SUI.form.Input({width:this.COLBOX_WIDTH,right:this.PADDING,top:c,anchor:{right:!0}});this._inpCode.el().maxLength=7;this._inpCode.el().style.textAlign="right";this._inpCode.el().style.fontFamily="mono";this._lblCode=new SUI.form.Label({width:this.LABEL_WIDTH,left:this.LABEL_LEFT,top:c,forBox:this._inpCode,title:SUI.i18n.hsvCode});SUI.browser.addEventListener(this._inpCode.el(),"blur",function(a){b.colorCode(this.value);
b.callListener("onChange",b._color);SUI.browser.noPropagation(a)});c+=this.ROW_HEIGHT;this._boxCol=new SUI.Box({width:this.COLBOX_WIDTH,height:this.COLBOX_HEIGHT,right:this.PADDING,top:c,anchor:{right:!0}});this._boxCol.border(new SUI.Border(1));this._boxCol.el().style.borderColor="black";this._lblColor=new SUI.form.Label({width:this.LABEL_WIDTH,left:this.LABEL_LEFT,top:c,title:SUI.i18n.hsvColor});a.onChange&&this.addListener("onChange",a.onChange);this.add(this._lblRed);this.add(this._lblGreen);
this.add(this._lblBlue);this.add(this._lblCode);this.add(this._lblColor);this.add(this._red);this.add(this._green);this.add(this._blue);this.add(this._inpCode);this.add(this._boxCol);this.colorCode(this._color)},COLBOX_HEIGHT:20,COLBOX_WIDTH:64,HEIGHT:158,LABEL_LEFT:200,LABEL_WIDTH:100,PADDING:15,ROW_HEIGHT:27,WIDTH:335,colorCode:function(a){if(void 0==a)return this._hsv.colorCode();var b=parseInt(a.substr(1),16);if(!isNaN(b)&&0<=b&&16777215>=b)a=SUI.color.colToRgb(a),this._red.value(a.r),this._green.value(a.g),
this._blue.value(a.b),this._setColor();else throw"SUI.control.RGBColorPicker: colorCode, invalid color";return null},_blue:null,_color:"#CCCCCC",_boxCol:null,_green:null,_inpCode:null,_lblBlue:null,_lblCode:null,_lblColor:null,_lblGreen:null,_lblRed:null,_red:null,_setColor:function(){this._color=SUI.color.rgbToCol({r:this._red.value(),g:this._green.value(),b:this._blue.value()});this._inpCode.el().value=this._color.toUpperCase();this._boxCol.el().style.backgroundColor=this._color}});SUI.control.ColorTablePicker=SUI.defineClass({baseClass:SUI.AnchorLayout,initializer:function(a){SUI.control.ColorTablePicker.initializeBase(this,a);this.width(this.WIDTH);this.height(this.HEIGHT);var b=this._buildColorTable(a.table||["#FFF","#B00","#000"],180-this.PADDING,this.HEIGHT-2*this.PADDING,a.rows||1,a.columns||3);b.style.marginTop=this.PADDING+"px";b.style.marginLeft=this.PADDING+"px";this.el().appendChild(b);b=this.PADDING;b+=3*this.ROW_HEIGHT;this._boxCode=new SUI.TextBox({width:this.COLBOX_WIDTH,
right:this.PADDING,height:this.COLBOX_HEIGHT,top:b+2,anchor:{right:!0}});this._boxCode.el().style.textAlign="right";this._boxCode.el().style.fontFamily="mono";this._lblCode=new SUI.form.Label({width:this.LABEL_WIDTH,left:this.LABEL_LEFT,top:b,title:SUI.i18n.hsvCode});b+=this.ROW_HEIGHT;this._boxCol=new SUI.Box({width:this.COLBOX_WIDTH,height:this.COLBOX_HEIGHT,right:this.PADDING,top:b,anchor:{right:!0}});this._boxCol.border(new SUI.Border(1));this._boxCol.el().style.borderColor="black";this._lblColor=
new SUI.form.Label({width:this.LABEL_WIDTH,left:this.LABEL_LEFT,top:b,title:SUI.i18n.hsvColor});a.onChange&&this.addListener("onChange",a.onChange);this.add(this._lblCode);this.add(this._lblColor);this.add(this._boxCode);this.add(this._boxCol);this.colorCode(this._color)},COLBOX_HEIGHT:20,COLBOX_WIDTH:64,HEIGHT:158,LABEL_LEFT:200,LABEL_WIDTH:100,PADDING:15,ROW_HEIGHT:27,WIDTH:335,colorCode:function(a){if(void 0==a)return this._color;this._color=SUI.color.colToCol(a);this._boxCode.text(this._color.toUpperCase());
this._boxCol.el().style.backgroundColor=this._color;return null},_boxCol:null,_boxCode:null,_color:"#CCCCCC",_lblCode:null,_lblColor:null,_buildColorTable:function(a,b,c,d,e){var f=this,g=document.createElement("TABLE");g.cellSpacing=0;g.cols=a[0].length;g.width=b;g.height=c;g.style.width=b+"px";g.style.height=c+"px";g.style.borderTop="solid black 1px";g.style.borderLeft="solid black 1px";for(b=0;b<d;b++){c=document.createElement("TR");g.appendChild(c);for(var h=0;h<e;h++){var i=document.createElement("TD");
c.appendChild(i);i.appendChild(document.createElement("SPAN"));i.style.cursor="pointer";i.style.backgroundColor=a[e*b+h];i.style.borderBottom="solid black 1px";i.style.borderRight="solid black 1px";SUI.browser.addEventListener(i,"click",function(a){f._selTableColor(new SUI.Event(this,a))||SUI.browser.noPropagation(a)})}}return g},_selTableColor:function(a){this.colorCode(a.elListener.style.backgroundColor);this.callListener("onChange",this._color)}});SUI.control.PasteData=SUI.defineClass({initializer:function(a){this._editor=a.editor},finishPaste:function(){if(this._intercepting&&!this._finishing)this._finishing=!0,SUI.browser.isIE?this._finishPasteIE():this._finishPaste(),this._finishing=this._intercepting=!1},interceptPaste:function(){if("html"!==this._pasteMethod){if(!this._intercepting)this._intercepting=!0,SUI.browser.isIE?this._interceptPasteIE():this._interceptPaste();return!1}return!0},pasteMethod:function(a){return void 0!==a?(this._pasteMethod=
a)&&null:this._pasteMethod},_div:null,_editor:null,_finishing:!1,_intercepting:!1,_pasteMethod:"filtered",_saveRange:null,_scrollTop1:0,_scrollTop2:0,_tagFilter:{P:[],H1:[],H2:[],H3:[],H4:[],H5:[],H6:[],BR:[],HR:[],IMG:["src","align","title","alt"],A:["href","title"],B:[],U:[],I:[],SPAN:["lang"],STRONG:[],EM:[],SMALL:[],BIG:[],CODE:[],PRE:[],TABLE:["summary","cellspacing"],TD:["id","headers","axis"],TH:["id","headers","axis"],TR:[],THEAD:[],TBODY:[],TFOOT:[],CAPTION:[],LI:[],UL:[],OL:[],DD:[],DT:[],
DL:[]},_blockTags:{P:1,H1:1,H2:1,H3:1,H4:1,H5:1,H6:1,BR:1,HR:1,PRE:1,TABLE:1,TR:1,CAPTION:1,LI:1,DD:1,DT:1},_createPasteDiv:function(){this._div=SUI.browser.createElement();SUI.style.removeClass(this._div,"no-select");SUI.style.setRect(this._div,10,-110,100,100);this._div.style.overflow="hidden";this._div.style.backgroundColor="#FFFFBB";this._div.contentEditable=!0;this._editor._editWin.frames.parent.document.body.appendChild(this._div)},_filter:function(a,b){var c=document.createElement("DIV"),d=
document.createElement("DIV");c.innerHTML=a;this._filterTags(c,d);if("filtered"==b)return d.innerHTML;c={res:""};this._toText(d,c,!1);a=c.res.replace(/[\r\n][\s\r\n]*/g,"<P>");a=a.replace(/\s*<P>\s*/g,"<P>");return a.replace(/\s+/g," ")},_filterClass:function(a,b){if(b)for(var c=b.split(" "),d=0;d<c.length;d++)c[d]&&("sys_"==c[d].substr(0,4)||"scrivo"==c[d].substr(0,6))&&SUI.style.addClass(a,c[d])},_filterTags:function(a,b){var c={SCRIPT:!0,HEAD:!0,LINK:!0,STYLE:!0,META:!0,TITLE:!0};if(1!=a.nodeType)3==
a.nodeType&&b.appendChild(document.createTextNode(a.nodeValue));else{var d=this._tagFilter[a.tagName];if(d){if("A"==a.tagName&&""!=a.name){if(SUI.browser.isIE&&8>=SUI.browser.version)var e=document.createElement("<A name='"+a.name+"'></A>");else e=document.createElement(a.tagName),e.name=a.name;SUI.style.addClass(e,"sys_anchor")}else e=document.createElement(a.tagName);for(var f=0;f<d.length;f++){var g=a.getAttribute(d[f]);g&&(""!=g||"alt"==d[f])&&e.setAttribute(d[f],g)}this._filterClass(e,a.className);
b.appendChild(e);b=e}for(f=0;f<a.childNodes.length;f++)c[a.childNodes[f].tagName]||this._filterTags(a.childNodes[f],b)}},_toText:function(a,b,c){c&&(b.res+="\n");if(1!=a.nodeType)3==a.nodeType&&(b.res+=a.nodeValue.replace(/\r?\n/g," "));else for(c=0;c<a.childNodes.length;c++)this._toText(a.childNodes[c],b,this._blockTags[a.childNodes[c].tagName])},_finishPaste:function(){var a=this._filter(this._div.innerHTML,this._pasteMethod);this._editor._editWin.frames.parent.document.body.removeChild(this._div);
this._div=null;if(SUI.browser.isGecko){this._editor._editDoc.body.contentEditable=!1;this._editor._editDoc.body.contentEditable=!0;var b=this._editor._getSelection();b.removeAllRanges();b.addRange(this._saveRange);this._saveRange=null}try{this._editor._execCommand("insertHtml",a)}catch(c){alert(c.message)}this._editor._editDoc.body.focus()},_finishPasteIE:function(){var a=this._filter(this._div.innerHTML,this._pasteMethod);this._editor._editWin.frames.parent.document.body.removeChild(this._div);this._div=
null;var b=this._editor._ieRestoreBookmark(this._saveRange);this._saveRange=null;b&&b.pasteHTML(a)},_interceptPaste:function(){this._saveRange=this._editor._getCurrentRange();this._saveRange=this._editor._editWin.getSelection().getRangeAt(0);this._createPasteDiv();var a=this;SUI.browser.addEventListener(this._div,"paste",function(){setTimeout(function(){a.finishPaste()})});this._div.focus();this._editor._editWin.frames.parent.document.createRange().selectNode(this._div)},_interceptPasteIE:function(){this._saveRange=
this._editor._ieSaveBookmark();this._createPasteDiv();var a=this;SUI.browser.addEventListener(this._div,"blur",function(){a.finishPaste()});a=this;SUI.browser.addEventListener(this._div,"paste",function(){setTimeout(function(){a._editor._editDoc.body.focus()})});this._div.focus();var b=this._editor._editWin.frames.parent.document.body.createTextRange();b.moveToElementText(this._div);b.select()}});SUI.control.BaseHTMLEditControl=SUI.defineClass({baseClass:SUI.Box,initializer:function(a){SUI.control.BaseHTMLEditControl.initializeBase(this,a);var b=this;if(void 0!==a.ieStrictMode)this._ieStrictMode=a.ieStrictMode;a.onLoad&&this.addListener("onLoad",a.onLoad);a.onCommandExecuted&&this.addListener("onCommandExecuted",a.onCommandExecuted);a.onContextMenu&&this.addListener("onContextMenu",a.onContextMenu);a.onFocus&&this.addListener("onFocus",a.onFocus);a.onKeyDown&&this.addListener("onKeyDown",
a.onKeyDown);a.onSelectionChange&&this.addListener("onSelectionChange",a.onSelectionChange);this.iframe=SUI.browser.createElement("IFRAME");this.iframe.frameBorder=0;SUI.browser.addEventListener(this.iframe,"load",function(a){b._onLoadIframe(new SUI.Event(this,a))||SUI.browser.noPropagation(a)});SUI.browser.isIE&&SUI.browser.addEventListener(this.iframe,"blur",function(){b.bmk=b.tmpBmk});SUI.style.addClass(this.iframe,"sui-scrivo-he");a='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.1 Strict//EN">\n';
SUI.browser.isIE&&!this._ieStrictMode&&(a="");var c='<meta http-equiv="content-type" content="text/html; charset=UTF-8">';SUI.browser.isIE&&9>SUI.browser.version&&(c="");this.iframe.src="javascript: '"+a+"<html><head>"+c+'<base href="'+SCRIVO_BASE_DIR+'/"></head><body spellcheck="false"></body></html>\'';this.el().appendChild(this.iframe);this._pasteData=new SUI.control.PasteData({editor:this})},focus:function(){if(this._canFocus&&!this._pasteData._intercepting)if(SUI.browser.isIE){if(this._focussedElement?
this._focussedElement.focus():this._editDoc.body.focus(),!this.focussed&&this.bmk)this.focussed=!0,this._ieRestoreBookmark(this.bmk),this.bmk=null}else this._editDoc.body.focus()},getCurrentBlockFormat:function(){var a=this._blockFormats[this._editDoc.queryCommandValue("FormatBlock")];return void 0===a?"":a},getDocument:function(){return this._editDoc},getSelectedElement:function(){return this._getParentElementSelection(this._getSelection())},getValue:function(){if(!this._editDoc)throw new ReferenceError("getValue failed because the editor was not fully loaded yet");
for(var a=0;a<this._editableElements.length;a++)this._editableElements[a].contentEditable=!1;for(var b=this._editDoc.body.innerHTML,a=0;a<this._editableElements.length;a++)this._editableElements[a].contentEditable=!0;return b},ieStrictMode:function(){return this._ieStrictMode},initBlockFormats:function(a){if(!this._blockFormats)if(this._blockFormats={},SUI.browser.isIE){this._blockFormats[""]="";var b=SUI.browser.createElement();b.unselectable=!1;SUI.style.setRect(b,10,-110,100,100);b.contentEditable=
!0;document.body.appendChild(b);for(var c=1;c<a.length;c++){try{var d=document.createElement(a[c].value);d.innerHTML="dummy"}catch(e){continue}b.appendChild(d);try{b.focus()}catch(f){}document.execCommand("SelectAll",!1,null);this._blockFormats[document.queryCommandValue("FormatBlock")]=a[c].value;b.removeChild(b.firstChild)}document.body.removeChild(b)}else for(c=1;c<a.length;c++)this._blockFormats[a[c].value.toLowerCase()]=a[c].value},layOut:function(){SUI.control.BaseHTMLEditControl.parentMethod(this,
"layOut");SUI.style.setRect(this.iframe,0,0,this.width(),this.height())},onCommandExecuted:function(){},onContextMenu:function(){},onFocus:function(){},onKeyDown:function(){},onLoad:function(){},onSelectionChange:function(){},pasteMethod:function(a){return this._pasteData.pasteMethod(a)},resetIframe:function(){if(SUI.browser.isGekco)this._editDoc=null,this.el().removeChild(this.iframe),this.el().appendChild(this.iframe);else if(this._editDoc)this._editDoc.body.innerHTML=""},geckoForceOnloadEvent:function(){!this._loaded&&
SUI.browser.isGecko&&(this.el().removeChild(this.iframe),this.el().appendChild(this.iframe))},setCSS:function(a,b,c){if(this._editDoc){b=b||"";""!=b&&SUI.style.addClass(this._editDoc.body,b);for(var d=this._editDoc.getElementsByTagName("head")[0],e=d.getElementsByTagName("LINK"),f=0;f<e.length;f++)d.removeChild(e[f]);if(c)for(f=0;f<c.length;f++)e=this._editDoc.createElement("LINK"),e.type="text/css",e.rel="stylesheet",e.href=c[f],d.appendChild(e);(e=this._editDoc.getElementById("scrivo_styles"))&&
d.removeChild(e);f=(a?a:"")+"\n"+this._createSystemCSS();e=this._editDoc.createElement("STYLE");e.type="text/css";e.id="scrivo_styles";SUI.browser.isIE?e.styleSheet.cssText=f:e.appendChild(this._editDoc.createTextNode(f));d.appendChild(e)}else{this._tmpStoreStyleSheet=[];for(var f=0;f<arguments.length;f++)this._tmpStoreStyleSheet.push(arguments[f]);for(;3>f;f++)this._tmpStoreStyleSheet.push(null)}},setEditableElementIds:function(a){this._editableElementIds=a},setValue:function(a){this._editDoc?(this._setContentEditable(!1),
this._editDoc.body.innerHTML=a,this._setContentEditable(!0),SUI.browser.isGecko&&this._initGecko(),this._webKitImgFix(),this.callListener("onLoad")):this._tmpStore=a},_blockFormats:null,_canFocus:!0,_editableElementIds:[],_editableElements:[],_editDoc:null,_editWin:null,_focussedElement:null,_ieDoBeforePaste:!0,_ieStrictMode:!0,_lastSel:{cllps:null,elem:null,cnt:0},_loaded:!1,_pasteData:null,_scrivoDir:"scrivo",_tmpStore:null,_tmpStoreStyleSheet:null,_undoState:0,_createSystemCSS:function(){return'.sys_language {\n  border: solid gray 1px;\n  background-color: #FFFFEE;\n  padding-left: 18px;\n  padding-right: 2px;\n  background-image: url("'+
SUI.imgDir+"/"+SUI.resource.ecLang+'");\n  background-repeat: no-repeat;\n}\n.sys_abbr {\n  border: solid gray 1px;\n  background-color: #FFFFEE;\n  padding-left: 18px;\n  padding-right: 2px;\n  background-image: url("'+SUI.imgDir+"/"+SUI.resource.ecAbbr+'");\n  background-repeat: no-repeat;\n}\n.sys_anchor {\n  border: solid gray 1px;\n  background-color: #FFFFEE;\n  padding-left: 18px;\n  padding-right: 2px;\n  background-image: url("'+SUI.imgDir+"/"+SUI.resource.ecAnchor+'");\n  background-repeat: no-repeat;\n}\ntable tr .sys_table_head {\n  background-color: #DD0000;\n  color: #FFFF00;\n}\ntable tr .sys_table_axis {\n  background-color: #00CC00;\n  color: #FFFF00;\n}\ntable tr .sys_show_cell {\n  border-bottom: dashed #C0C0C0 1px;\n  border-right: dashed #C0C0C0 1px;\n}\n.sys_spell {  border-bottom: solid #D00000 2px;\n}\n.sys_spell_suggestions {\n  border-bottom: dashed #D00000 2px;\n}\n.sys_spell_compoundword {\n  border-bottom: dashed #00D000 2px;\n}\n'},
_execCommand:function(a,b){this.focus();if(SUI.browser.isIE){var c=this._editDoc.selection.createRange();"None"==this._editDoc.selection.type?this._editDoc.execCommand(a,!1,b):c.execCommand(a,!1,b)}else this._editDoc.execCommand(a,!1,b)},_spanFix:function(){for(var a=this._editDoc.getElementsByTagName("SPAN"),b=a.length-1;0<=b;b--){var c=a[b].style.fontFamily;if(c){var d="'"==c.charAt(0)||'"'==c.charAt(0)?1:0;if("s_"==c.substr(d,2))a[b].style.fontSize=c.replace("s_","").replace("P","%"),a[b].style.fontFamily=
""}}},_fontFix:function(){for(var a=this._editDoc.getElementsByTagName("FONT"),b=a.length-1;0<=b;b--){var c=a[b].getAttribute("face");if(c){var d="'"==c.charAt(0)||'"'==c.charAt(0)?1:0;switch(c.substr(d,2)){case "f_":d=this._editDoc.createElement("SPAN");d.innerHTML=a[b].innerHTML;d.style.fontFamily=c.replace("f_","");this._replaceNode(a[b],d);break;case "s_":d=this._editDoc.createElement("SPAN"),d.innerHTML=a[b].innerHTML,d.style.fontSize=c.replace("s_","").replace("P","%"),this._replaceNode(a[b],
d)}}else if(c=a[b].getAttribute("color"))d=this._editDoc.createElement("SPAN"),d.innerHTML=a[b].innerHTML,d.style.color=c,this._replaceNode(a[b],d)}},_getCurrentRange:function(a){a||(a=this._getSelection());if(a){if(SUI.browser.isIE)return a.createRange();if(a.rangeCount&&a.getRangeAt)return a.getRangeAt(0)}return null},_getParentElementSelection:function(a){SUI.browser.isIE&&"None"==a.type&&this.focus();var b=this._getCurrentRange(a);if(b){if(SUI.browser.isIE)return"Control"==a.type?9>SUI.browser.version?
b.commonParentElement():b.item(0):b.parentElement();for(a=b.commonAncestorContainer;1!=a.nodeType&&9!=a.nodeType;)a=a.parentNode;return a}return null},_getSelection:function(){return this._editDoc.selection?this._editDoc.selection:this._editWin.getSelection()},_ieEvent:function(a){return SUI.browser.isIE&&9>SUI.browser.version?this._editWin.event:a},_ieFind:function(a,b,c,d){var e=0;c&&(e+=1);d&&(e+=2);b&&(e+=4);b=this._editDoc.selection.createRange();b.collapse(c);(a=b.findText(a,1E7,e))&&b.select();
return a},_ieRestoreBookmark:function(a){var b=null;if(a)if("Range"===a.type)b=a.value;else if("Bookmark"===a.type)b=this._editDoc.body.createTextRange(),b.moveToBookmark(a.value);else{for(b=this._editDoc.body.createControlRange();b.length;)b.remove(0);b.add(a.value)}b&&b.select();return b},_ieSaveBookmark:function(a){var b=null,c=this._editDoc.selection.createRange();"Control"===this._editDoc.selection.type?b={type:"Control",value:c.item(0)}:a?c.getBookmark&&(b={type:"Bookmark",value:c.getBookmark()}):
b={type:"Range",value:c};return b},_initGecko:function(){this._canFocus=!1;this._execCommand("enableInlineTableEditing",!1);this._execCommand("enableObjectResizing",!1);this._execCommand("insertbronreturn",!1);this._execCommand("styleWithCSS",!1);this._canFocus=!0;if(this._editDoc.body.firstChild&&1==this._editDoc.body.firstChild.nodeType&&this._editDoc.body.firstChild.getAttribute("_moz_editor_bogus_node")&&(this._editDoc.body.removeChild(this._editDoc.body.firstChild),1>=this._editDoc.body.innerHTMLlength))this._editDoc.body.innerHTML=
"<p>&nbsp;</p>"},_initIE:function(){var a=this;this.focussed=null;9>SUI.browser.version&&SUI.browser.addEventListener(this._editDoc,"selectionchange",function(b){a.focussed&&(b=a._ieEvent(b),a._onSelectionChangeIE(new SUI.Event(this,b))||SUI.browser.noPropagation(b))});this.tmpBmk=this.bmk=null;SUI.browser.addEventListener(this._editDoc.body,"beforedeactivate",function(b){b=a._ieEvent(b);if(!b.toElement){if(9>SUI.browser.version)a.focussed=!1;a.tmpBmk=a._ieSaveBookmark()}});SUI.browser.addEventListener(this._editDoc.body,
"beforeactivate",function(){a.focussed=!0;a._ieRestoreBookmark(a.bmk);a.bmk=null});if(!this._editDoc.body.innerHTML)this._editDoc.body.innerHTML="<p></p>"},_initWebKit:function(){this._editDoc.body.innerHTML||this.setValue("<p><br></p>")},_onContextMenu:function(a){this.callListener("onContextMenu",SUI.browser.getX(a.event),SUI.browser.getY(a.event));SUI.browser.isIE?a.event.returnValue=!1:a.event.preventDefault()},_onFocus:function(a){SUI.browser.isIE&&this._editDoc.selection.createRange().select();
this.callListener("onFocus",a)},_onKeyDown:function(a){SUI.browser.isWebKit&&13==a.event.keyCode&&a.event.shiftKey&&(this._execCommand("insertLineBreak"),a.event.preventDefault());!SUI.browser.isIE&&a.event.ctrlKey&&86===a.event.keyCode&&this._pasteData.interceptPaste();this.callListener("onKeyDown",a);if(SUI.browser.isIE&&8==a.event.keyCode&&"Control"===this._editDoc.selection.type)this._execCommand("delete"),a.event.returnValue=!1},_onKeyUp:function(a){SUI.browser.isWebKit&&13==a.event.keyCode&&
this._webKitNoDivOnEnterFix();var b=(this._editDoc.queryCommandEnabled("Undo")?1:0)+(this._editDoc.queryCommandEnabled("Redo")?2:0);if(this._undoState!==b)this._undoState=b,this.callListener("onCommandExecuted");(!0==a.event.ctrlKey||48>a.event.keyCode||90<a.event.keyCode)&&this._onSelectionChange(a)},_onLoadIframe:function(){var a=this;this._editDoc=(this._editWin=this.iframe.contentWindow)||this.iframe.contentDocument;if(this._editDoc.document)this._editDoc=this._editDoc.document;if(SUI.browser.isIE&&
9>SUI.browser.version)this._editDoc.charset="UTF-8";this._setContentEditable(!0);if(SUI.browser.isGecko)this._initGecko();else if(SUI.browser.isWebKit)this._initWebKit();else if(SUI.browser.isIE)this._initIE();else if(!this._editDoc.body.innerHTML)this._editDoc.body.innerHTML="<p>&nbsp;</p>";SUI.browser.addEventListener(this._editDoc,"mouseup",function(b){b=a._ieEvent(b);a._onMouseUp(new SUI.Event(this,b))||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this._editWin,"focus",function(b){b=
a._ieEvent(b);a._onFocus(new SUI.Event(this,b))||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this._editDoc,"keydown",function(b){b=a._ieEvent(b);a._onKeyDown(new SUI.Event(this,b))||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this._editDoc,"keyup",function(b){b=a._ieEvent(b);a._onKeyUp(new SUI.Event(this,b))||SUI.browser.noPropagation(b)});SUI.browser.addEventListener(this._editDoc,"contextmenu",function(b){b=a._ieEvent(b);a._onContextMenu(new SUI.Event(this,b))||SUI.browser.noPropagation(b)});
SUI.browser.isIE?SUI.browser.addEventListener(this._editDoc.body,"beforepaste",function(b){b=a._ieEvent(b);a._ieDoBeforePaste&&(a._pasteData.interceptPaste()||SUI.browser.noPropagation(b))}):SUI.browser.isWebKit&&SUI.browser.addEventListener(this._editDoc.body,"paste",function(b){if(a._pasteData._div){b=a._ieEvent(b);if(0<b.clipboardData.items.length){for(var c=!1,d=0;d<b.clipboardData.types.length;d++)"text/html"===b.clipboardData.types[d]&&(c=!0);a._pasteData._div.innerHTML=b.clipboardData.getData(c?
"text/html":"text/plain")}SUI.browser.noPropagation(b);b.preventDefault();a._pasteData.finishPaste()}});this._tmpStoreStyleSheet&&this.setCSS(this._tmpStoreStyleSheet[0],this._tmpStoreStyleSheet[1],this._tmpStoreStyleSheet[2]);this._tmpStore?this.setValue(this._tmpStore):this.callListener("onLoad");this._loaded=!0},_onMouseUp:function(a){this._onSelectionChange(a)},_onSelectionChange:function(){if(!(SUI.browser.isIE&&9>SUI.browser.version)){var a=this._getSelection(),b=this._getParentElementSelection(a);
if(null!==this._lastSel.cllps&&a.isCollapsed==this._lastSel.cllps){if(1==this._lastSel.cnt||b!=this._lastSel.elem){if(b!=this._lastSel.elem)this._lastSel.cnt=0;this._lastSel.elem=b;this.callListener("onSelectionChange")}this._lastSel.cnt++}else this._lastSel.cnt=0,this._lastSel.elem=b,this.callListener("onSelectionChange");this._lastSel.cllps=a.isCollapsed}},_onSelectionChangeIE:function(){this.callListener("onSelectionChange")},_outerHTML:function(a){if(SUI.browser.isIE)return a.outerHTML;var b=
document.createElement("DIV");b.appendChild(a.cloneNode(!0));return b.innerHTML},_rangeSelectWord:function(a){if(SUI.browser.isIE)""==a.text&&a.expand("word")&&""!=a.text&&-1!=a.text.indexOf(" ")&&a.moveEnd("character",-1);else if(a.collapsed){var b=a.startOffset;try{for(var c=b;0<=c;c--){a.setStart(a.startContainer,c);var d=a.toString();if(d.match(/\s/)){a.setStart(a.startContainer,c+1);break}}}catch(e){}try{for(c=b;100>c;c++)if(a.setEnd(a.startContainer,c),d=a.toString(),d=""+d[d.length-1],d.match(/\s/)){a.setEnd(a.startContainer,
c-1);break}}catch(f){}b=a.toString();try{0<b.length&&b[b.length-1].match(/\s/)&&a.setEnd(a.startContainer,a.startOffset+b.length-1)}catch(g){}}},_replaceNode:function(a,b){if(SUI.browser.isIE)a.parentNode.replaceChild(b,a);else{var c=this._getCurrentRange();c.selectNode(a);var d=this._getSelection();d.removeAllRanges();d.addRange(c);this._execCommand("delete");this._execCommand("inserthtml",this._outerHTML(b))}},_selectWord:function(){if(!SUI.browser.isIE){var a=this._getSelection(),b=this._getCurrentRange(a);
if(b.collapsed&&(this._rangeSelectWord(b),b.collapsed))return;a.removeAllRanges();a.addRange(b)}},_setContentEditable:function(a){for(var b=this,c=0;c<this._editableElements.length;c++)this._editableElements[c].contentEditable=!1;this._editableElements=[];this._focussedElement=null;if(a){for(c=0;c<this._editableElementIds.length;c++)if(a=this._editDoc.getElementById(this._editableElementIds[c]))this._editableElements.push(a),a.contentEditable=!0,SUI.browser.isIE&&SUI.browser.addEventListener(a,"focus",
function(){b._focussedElement=this});if(0==this._editableElements.length)this._editableElements.push(this._editDoc.body),this._editDoc.body.contentEditable=!0}},_webKitImgFix:function(){if(SUI.browser.isWebKit)for(var a=this._editDoc.getElementsByTagName("IMG"),b=0;b<a.length;b++)SUI.browser.removeEventListener(a[b],"click",this._webKitImgFixOnClick),SUI.browser.addEventListener(a[b],"click",this._webKitImgFixOnClick)},_webKitImgFixOnClick:function(){var a=this.ownerDocument.createRange();a.selectNode(this);
var b=this.ownerDocument.getSelection();b.removeAllRanges();b.addRange(a)},_webKitNoDivOnEnterFix:function(){var a=this.getSelectedElement();if("DIV"==a.tagName){var b=this._editDoc.createElement("P");b.innerHTML=a.innerHTML;a.parentNode.insertBefore(b,a);a.parentNode.removeChild(a);a=this._editDoc.createRange();a.selectNodeContents(b);a.collapse(!1);b=this._getSelection();b.removeAllRanges();b.addRange(a)}}});SUI.control.HTMLEditControl=SUI.defineClass({baseClass:SUI.control.BaseHTMLEditControl,initializer:function(a){SUI.control.HTMLEditControl.initializeBase(this,a)},commandsEnabled:function(){var a=!1,b=!1,c=!1;SUI.browser.isWebKit?(a=b=!this._getSelection().isCollapsed,c=!0):(a=this._editDoc.queryCommandEnabled("Cut"),b=this._editDoc.queryCommandEnabled("Copy"),this._ieDoBeforePaste=!1,c=this._editDoc.queryCommandEnabled("Paste"),this._ieDoBeforePaste=!0);return{cut:a,copy:b,paste:c,undo:this._editDoc.queryCommandEnabled("Undo"),
redo:this._editDoc.queryCommandEnabled("Redo"),link:this._editDoc.queryCommandEnabled("createlink"),image:this._editDoc.queryCommandEnabled("insertimage"),anchor:this._editDoc.queryCommandEnabled("createlink"),pageBreak:this._editDoc.queryCommandEnabled("inserthorizontalrule"),removeFormatting:this._editDoc.queryCommandEnabled("removeformat"),orderedList:this._editDoc.queryCommandEnabled("insertorderedlist"),unorderedList:this._editDoc.queryCommandEnabled("insertunorderedlist"),indent:this._editDoc.queryCommandEnabled("indent"),
deIndent:this._editDoc.queryCommandEnabled("outdent")}},commandStates:function(){return{bold:this._editDoc.queryCommandState("Bold"),underline:this._editDoc.queryCommandState("Underline"),italic:this._editDoc.queryCommandState("Italic"),alignLeft:this._editDoc.queryCommandState("justifyleft"),alignCenter:this._editDoc.queryCommandState("justifyCenter"),alignRight:this._editDoc.queryCommandState("justifyRight"),insertUnorderedList:this._editDoc.queryCommandState("insertUnorderedList"),insertOrderedList:this._editDoc.queryCommandState("insertOrderedList")}},
doBackColor:function(a){if(SUI.browser.isIE){var b=this;setTimeout(function(){b._execCommand("BackColor",a);b._onCommandExecuted()},10)}else this._selectWord(),this._execCommand("styleWithCSS",!0),this._execCommand("HiliteColor",a),this._execCommand("styleWithCSS",!1),this._onCommandExecuted()},doBold:function(){this._selectWord();this._execCommand("Bold");this._onCommandExecuted()},doFind:function(a,b,c,d){this.focus();b=b?!0:!1;c=c?!0:!1;d=d?!0:!1;a=SUI.browser.isIE?this._ieFind(a,b,c,d):this._editWin.find(a,
b,c,!1,d,!1,!1);this._onCommandExecuted();return a?!0:!1},doFontName:function(a){this._selectWord();SUI.browser.isIE?(this._execCommand("FontName","f_"+a),this._fontFix()):(this._execCommand("styleWithCSS",!0),this._execCommand("FontName",a),this._execCommand("styleWithCSS",!1));this._onCommandExecuted()},doFontSize:function(a){this._selectWord();a="s_"+a.replace("%","P");SUI.browser.isIE?(this._execCommand("FontName",a),this._fontFix()):(this._execCommand("styleWithCSS",!0),this._execCommand("FontName",
a),this._execCommand("styleWithCSS",!1),this._spanFix());this._onCommandExecuted()},doForeColor:function(a){this._selectWord();if(SUI.browser.isIE){var b=this;setTimeout(function(){b._execCommand("ForeColor",a);b._fontFix();b._onCommandExecuted()},10)}else this._execCommand("styleWithCSS",!0),this._execCommand("ForeColor",a),this._execCommand("styleWithCSS",!1),this._onCommandExecuted()},doFormatBlock:function(a){this._execCommand("FormatBlock","<"+a+">");this._onCommandExecuted()},doGetAbbr:function(){for(var a=
this.getSelectedElement();null!=a&&9!=a.nodeType;){if(1==a.nodeType&&"ACRONYM"==a.tagName)return a;a=a.parentNode}return null},doGetLang:function(){for(var a=this.getSelectedElement();null!=a&&9!=a.nodeType;){if(1==a.nodeType&&"SPAN"==a.tagName&&""!=a.lang&&null!=a.lang)return a;a=a.parentNode}return null},doGetLink:function(){for(var a=this.getSelectedElement();null!=a&&9!=a.nodeType;){if(1==a.nodeType&&"A"==a.tagName)return a;a=a.parentNode}return null},doGetImg:function(){var a=null;if(SUI.browser.isIE){var b=
this._getSelection();if("None"!=b.type&&"Text"!=b.type)for(a=b.createRange().item(0);null!=a&&"IMG"!=a.tagName;)a=a.parentNode}else for(var b=this._getCurrentRange().cloneContents(),c=0;c<b.childNodes.length;c++){var d=b.childNodes[c];if(1==d.nodeType&&"IMG"==d.tagName){a=d;break}}return a},doIndent:function(){this._execCommand("Indent");this._onCommandExecuted()},doInsertAbbr:function(a){this.doInsertInlineElement("ACRONYM",{"class":"sys_abbr",title:a})},doInsertAnchor:function(a){a=a.replace(/[\s]+/g,
"_");this.doInsertInlineElement("A",{name:a,"class":"sys_anchor"})},doInsertHorizontalRule:function(){this._execCommand("InsertHorizontalRule");this._onCommandExecuted()},doInsertHTML:function(a){if(SUI.browser.isIE){var b=this;setTimeout(function(){b.focus();var c=b._getCurrentRange();c.collapse(!0);c.select();c.pasteHTML(a);b._onCommandExecuted()},10)}else this._execCommand("inserthtml",a),this._onCommandExecuted()},doInsertImg:function(a){if(SUI.browser.isIE){var b=this;setTimeout(function(){b.focus();
var c=b._getCurrentRange();c.pasteHTML(a.outerHTML);c.select();b._onCommandExecuted()},10)}else this.focus(),this.doUpdateImg(a),this._webKitImgFix(),this._onCommandExecuted()},doInsertInlineElement:function(a,b){if(SUI.browser.isIE){var c=this;setTimeout(function(){c.focus();var d=c._editDoc.createElement(a);SUI.browser.setAttributes(d,b);var e=c._getSelection(),f=c._getCurrentRange(e);"None"==e.type&&(c._rangeSelectWord(f),f.select());if(!(""==f.text||"None"==e.type))"Text"==e.type?d.innerHTML=
f.htmlText:(el=9>SUI.browser.version?f.commonParentElement():f.item(0),d.innerHTML=el.innerHTML),f.pasteHTML(d.outerHTML),c._onCommandExecuted()},10)}else{this.focus();var d=this._editDoc.createElement(a);SUI.browser.setAttributes(d,b);var e=this._getSelection(),f=this._getCurrentRange(e);f.collapsed&&this._rangeSelectWord(f);if(!f.collapsed)d.innerHTML=this._outerHTML(f.cloneContents()),d=this._outerHTML(d),e.removeAllRanges(),e.addRange(f),this._execCommand("inserthtml",d),this._onCommandExecuted()}},
doInsertLang:function(a){this.doInsertInlineElement("SPAN",{"class":"sys_language",lang:a})},doInsertLink:function(a){if(SUI.browser.isIE){var b=this;setTimeout(function(){b.focus();var c=b._editDoc.selection,d=b._getCurrentRange(c);"None"==c.type&&(b._rangeSelectWord(d),d.select());if(!(""==d.text||"None"==c.type)){if("Text"==c.type||"None"==c.type){b._execCommand("CreateLink",a.href);c=d.parentElement();if("A"!=c.tagName)c=c.firstChild;"A"==c.tagName&&(SUI.browser.setAttributes(c,a),d.collapse(!1))}else c=
b._editDoc.createElement("A"),SUI.browser.setAttributes(c,a),el=9>SUI.browser.version?d.commonParentElement():d.item(0),el.parentElement.replaceChild(c,el),c.appendChild(el);b._onCommandExecuted()}},10)}else this.focus(),this.doInsertInlineElement("A",a)},doInsertNode:function(a){this.doInsertHTML(this._outerHTML(a));this._onCommandExecuted()},doInsertOrderedList:function(){this._execCommand("InsertOrderedList");this._onCommandExecuted()},doInsertUnorderedList:function(){this._execCommand("InsertUnorderedList");
this._onCommandExecuted()},doItalic:function(){this._selectWord();this._execCommand("Italic");this._onCommandExecuted()},doJustifyCenter:function(){this._execCommand("JustifyCenter");this._onCommandExecuted()},doJustifyLeft:function(){this._execCommand("JustifyLeft");this._onCommandExecuted()},doJustifyRight:function(){this._execCommand("JustifyRight");this._onCommandExecuted()},doOutdent:function(){this._execCommand("Outdent");this._onCommandExecuted()},doRedo:function(){this._execCommand("Redo");
this._onCommandExecuted()},doRemoveAnchor:function(a){a.href?this.doUpdateInlineElement(a,{name:null,"class":""}):this.doRemoveNode(a)},doRemoveFormat:function(){if(SUI.browser.isIE){this._execCommand("RemoveFormat");for(var a=this._editDoc.selection.createRange(),b=this._editDoc.body.createTextRange(),c=this._editDoc.body.getElementsByTagName("*"),d=c.length-1;0<=d;d--)b.moveToElementText(c[d]),1==b.compareEndPoints("StartToStart",a)&&-1==b.compareEndPoints("StartToEnd",a)&&c[d].removeAttribute("style")}else this._execCommand("RemoveFormat");
this._onCommandExecuted()},doRemoveLink:function(a){this.doRemoveNode(a);a.name&&this.doInsertAnchor(a.name)},doRemoveNode:function(a){if(SUI.browser.isIE)a.removeNode(!1);else{var b=this._getCurrentRange();b.selectNode(a);var c=this._getSelection();c.removeAllRanges();c.addRange(b);this._execCommand("delete",!1);this._execCommand("inserthtml",a.innerHTML)}this._onCommandExecuted()},doReplace:function(a){if(SUI.browser.isIE){this.focus();var b=this._getCurrentRange();if(""!=b.text)b.text=a}else""!=
this._getCurrentRange().toString()&&this._execCommand("inserthtml",a);this._onCommandExecuted()},doReplaceAll:function(a,b,c,d,e){var f=0;this.focus();c=c?!0:!1;d=!1;e=e?!0:!1;if(SUI.browser.isIE){var g=this._getCurrentRange();g.expand("textedit");g.collapse(!0);for(g.select();this._ieFind(a,c,d,e);)f++,this.doReplace(b)}else{var h=this._getSelection(),g=this._editDoc.createRange();g.selectNode(this._editDoc.body);g.collapse(!0);h.removeAllRanges();for(h.addRange(g);this._editWin.find(a,c,d,!1,e,
!1,!1);)f++,this.doReplace(b)}this._onCommandExecuted();return f},doSelectAll:function(){this._execCommand("SelectAll");this._onCommandExecuted()},doUnderline:function(){this._selectWord();this._execCommand("Underline");this._onCommandExecuted()},doUndo:function(){this._execCommand("Undo");this._onCommandExecuted()},doUpdateAbbr:function(a,b){this.doUpdateInlineElement(a,{title:b})},doUpdateAnchor:function(a,b){b=b.replace(/[\s]+/g,"_");this.doUpdateInlineElement(a,{name:b,"class":"sys_anchor"})},
doUpdateImg:function(a){SUI.browser.isIE?this.focus():(this._execCommand("inserthtml",this._outerHTML(a)),this._webKitImgFix());this._onCommandExecuted()},doUpdateInlineElement:function(a,b){if(SUI.browser.isIE)this.focus(),SUI.browser.setAttributes(a,b);else{var c=this._editDoc.createRange();c.selectNode(a);var d=c.cloneContents();SUI.browser.setAttributes(d.childNodes[0],b);var e=this._getSelection();e.removeAllRanges();c.selectNode(a);e.addRange(c);this._execCommand("inserthtml",this._outerHTML(d))}this._onCommandExecuted()},
doUpdateLang:function(a,b){this.doUpdateInlineElement(a,{lang:b})},doUpdateLink:function(a,b){this.doUpdateInlineElement(a,b)},_onCommandExecuted:function(){this._undoState=(this._editDoc.queryCommandEnabled("Undo")?1:0)+(this._editDoc.queryCommandEnabled("Redo")?2:0);this.callListener("onCommandExecuted")}});
